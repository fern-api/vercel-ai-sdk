import { A as At$1, E, d as ka$1, N as Na$1, r as ra$1, a as ae, s as sa$1, i as ia$1, U, o as oa$1, k as kr$1, u as ue, W as W$1, p as pa$1, C, f as ua$1, I as Ia$1, g as Ea$1, H as He$1, v as ve$1, Y as Y$1, h as la$1, w as wa, j as da$1, m as ga, n as ca$1, q as aa$1, t as fa, y as ma$1, _ as _a$1, z as na$1, B as ya, D as ba, F as ha, G as va } from './index17.mjs';
import { z } from 'zod';

var Ta=typeof globalThis=="object"?globalThis:global,ye$1="1.9.0",Qt=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function _a(e){var t=new Set([e]),r=new Set,a=e.match(Qt);if(!a)return function(){return  false};var s={major:+a[1],minor:+a[2],patch:+a[3],prerelease:a[4]};if(s.prerelease!=null)return function(c){return c===e};function n(l){return r.add(l),false}function o(l){return t.add(l),true}return function(c){if(t.has(c))return  true;if(r.has(c))return  false;var u=c.match(Qt);if(!u)return n(c);var d={major:+u[1],minor:+u[2],patch:+u[3],prerelease:u[4]};return d.prerelease!=null||s.major!==d.major?n(c):s.major===0?s.minor===d.minor&&s.patch<=d.patch?o(c):n(c):s.minor<=d.minor?o(c):n(c)}}var Ia=_a(ye$1),Ra=ye$1.split(".")[0],ke$1=Symbol.for("opentelemetry.js.api."+Ra),De$1=Ta;function Rt(e,t,r,a){var s;a===void 0&&(a=false);var n=De$1[ke$1]=(s=De$1[ke$1])!==null&&s!==void 0?s:{version:ye$1};if(!a&&n[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(o.stack||o.message),false}if(n.version!==ye$1){var o=new Error("@opentelemetry/api: Registration of version v"+n.version+" for "+e+" does not match previously registered API v"+ye$1);return r.error(o.stack||o.message),false}return n[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+ye$1+"."),true}function qe$1(e){var t,r,a=(t=De$1[ke$1])===null||t===void 0?void 0:t.version;if(!(!a||!Ia(a)))return (r=De$1[ke$1])===null||r===void 0?void 0:r[e]}function Ct(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+ye$1+".");var r=De$1[ke$1];r&&delete r[e];}var Ca=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),s,n=[],o;try{for(;(t===void 0||t-- >0)&&!(s=a.next()).done;)n.push(s.value);}catch(l){o={error:l};}finally{try{s&&!s.done&&(r=a.return)&&r.call(a);}finally{if(o)throw o.error}}return n},Pa=function(e,t,r){if(arguments.length===2)for(var a=0,s=t.length,n;a<s;a++)(n||!(a in t))&&(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},Ea=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger";}return e.prototype.debug=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ne$1("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ne$1("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ne$1("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ne$1("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ne$1("verbose",this._namespace,t)},e}();function Ne$1(e,t,r){var a=qe$1("diag");if(a)return r.unshift(t),a[e].apply(a,Pa([],Ca(r),false))}var W;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL";})(W||(W={}));function ja(e,t){e<W.NONE?e=W.NONE:e>W.ALL&&(e=W.ALL),t=t||{};function r(a,s){var n=t[a];return typeof n=="function"&&e>=s?n.bind(t):function(){}}return {error:r("error",W.ERROR),warn:r("warn",W.WARN),info:r("info",W.INFO),debug:r("debug",W.DEBUG),verbose:r("verbose",W.VERBOSE)}}var Aa=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),s,n=[],o;try{for(;(t===void 0||t-- >0)&&!(s=a.next()).done;)n.push(s.value);}catch(l){o={error:l};}finally{try{s&&!s.done&&(r=a.return)&&r.call(a);}finally{if(o)throw o.error}}return n},Ma=function(e,t,r){if(arguments.length===2)for(var a=0,s=t.length,n;a<s;a++)(n||!(a in t))&&(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},Na="diag",Ye$1=function(){function e(){function t(s){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var l=qe$1("diag");if(l)return l[s].apply(l,Ma([],Aa(n),false))}}var r=this,a=function(s,n){var o,l,c;if(n===void 0&&(n={logLevel:W.INFO}),s===r){var u=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((o=u.stack)!==null&&o!==void 0?o:u.message),false}typeof n=="number"&&(n={logLevel:n});var d=qe$1("diag"),m=ja((l=n.logLevel)!==null&&l!==void 0?l:W.INFO,s);if(d&&!n.suppressOverrideMessage){var v=(c=new Error().stack)!==null&&c!==void 0?c:"<failed to generate stacktrace>";d.warn("Current logger will be overwritten from "+v),m.warn("Current logger will overwrite one already registered from "+v);}return Rt("diag",m,r,true)};r.setLogger=a,r.disable=function(){Ct(Na,r);},r.createComponentLogger=function(s){return new Ea(s)},r.verbose=t("verbose"),r.debug=t("debug"),r.info=t("info"),r.warn=t("warn"),r.error=t("error");}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function Oa(e){return Symbol.for(e)}var ka=function(){function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(a){return r._currentContext.get(a)},r.setValue=function(a,s){var n=new e(r._currentContext);return n._currentContext.set(a,s),n},r.deleteValue=function(a){var s=new e(r._currentContext);return s._currentContext.delete(a),s};}return e}(),Da=new ka,qa=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),s,n=[],o;try{for(;(t===void 0||t-- >0)&&!(s=a.next()).done;)n.push(s.value);}catch(l){o={error:l};}finally{try{s&&!s.done&&(r=a.return)&&r.call(a);}finally{if(o)throw o.error}}return n},Ua=function(e,t,r){if(arguments.length===2)for(var a=0,s=t.length,n;a<s;a++)(n||!(a in t))&&(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},$a=function(){function e(){}return e.prototype.active=function(){return Da},e.prototype.with=function(t,r,a){for(var s=[],n=3;n<arguments.length;n++)s[n-3]=arguments[n];return r.call.apply(r,Ua([a],qa(s),false))},e.prototype.bind=function(t,r){return r},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),Fa=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),s,n=[],o;try{for(;(t===void 0||t-- >0)&&!(s=a.next()).done;)n.push(s.value);}catch(l){o={error:l};}finally{try{s&&!s.done&&(r=a.return)&&r.call(a);}finally{if(o)throw o.error}}return n},Ja=function(e,t,r){if(arguments.length===2)for(var a=0,s=t.length,n;a<s;a++)(n||!(a in t))&&(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},lt$1="context",Ba=new $a,ur=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return Rt(lt$1,t,Ye$1.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,r,a){for(var s,n=[],o=3;o<arguments.length;o++)n[o-3]=arguments[o];return (s=this._getContextManager()).with.apply(s,Ja([t,r,a],Fa(n),false))},e.prototype.bind=function(t,r){return this._getContextManager().bind(t,r)},e.prototype._getContextManager=function(){return qe$1(lt$1)||Ba},e.prototype.disable=function(){this._getContextManager().disable(),Ct(lt$1,Ye$1.instance());},e}(),ht;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED";})(ht||(ht={}));var cr="0000000000000000",pr="00000000000000000000000000000000",Ga={traceId:pr,spanId:cr,traceFlags:ht.NONE},Oe$1=function(){function e(t){t===void 0&&(t=Ga),this._spanContext=t;}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,r){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,r){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return  false},e.prototype.recordException=function(t,r){},e}(),Pt=Oa("OpenTelemetry Context Key SPAN");function Et(e){return e.getValue(Pt)||void 0}function La(){return Et(ur.getInstance().active())}function jt(e,t){return e.setValue(Pt,t)}function Wa(e){return e.deleteValue(Pt)}function Va(e,t){return jt(e,new Oe$1(t))}function dr(e){var t;return (t=Et(e))===null||t===void 0?void 0:t.spanContext()}var za=/^([0-9a-f]{32})$/i,Xa=/^[0-9a-f]{16}$/i;function Ha(e){return za.test(e)&&e!==pr}function Ka(e){return Xa.test(e)&&e!==cr}function mr(e){return Ha(e.traceId)&&Ka(e.spanId)}function Ya(e){return new Oe$1(e)}var ut=ur.getInstance(),fr=function(){function e(){}return e.prototype.startSpan=function(t,r,a){a===void 0&&(a=ut.active());var s=!!r?.root;if(s)return new Oe$1;var n=a&&dr(a);return Qa(n)&&mr(n)?new Oe$1(n):new Oe$1},e.prototype.startActiveSpan=function(t,r,a,s){var n,o,l;if(!(arguments.length<2)){arguments.length===2?l=r:arguments.length===3?(n=r,l=a):(n=r,o=a,l=s);var c=o??ut.active(),u=this.startSpan(t,n,c),d=jt(c,u);return ut.with(d,l,void 0,u)}},e}();function Qa(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var Za=new fr,en=function(){function e(t,r,a,s){this._provider=t,this.name=r,this.version=a,this.options=s;}return e.prototype.startSpan=function(t,r,a){return this._getTracer().startSpan(t,r,a)},e.prototype.startActiveSpan=function(t,r,a,s){var n=this._getTracer();return Reflect.apply(n.startActiveSpan,n,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):Za},e}(),tn=function(){function e(){}return e.prototype.getTracer=function(t,r,a){return new fr},e}(),rn=new tn,Zt=function(){function e(){}return e.prototype.getTracer=function(t,r,a){var s;return (s=this.getDelegateTracer(t,r,a))!==null&&s!==void 0?s:new en(this,t,r,a)},e.prototype.getDelegate=function(){var t;return (t=this._delegate)!==null&&t!==void 0?t:rn},e.prototype.setDelegate=function(t){this._delegate=t;},e.prototype.getDelegateTracer=function(t,r,a){var s;return (s=this._delegate)===null||s===void 0?void 0:s.getTracer(t,r,a)},e}(),Qe$1;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR";})(Qe$1||(Qe$1={}));var ct="trace",an=function(){function e(){this._proxyTracerProvider=new Zt,this.wrapSpanContext=Ya,this.isSpanContextValid=mr,this.deleteSpan=Wa,this.getSpan=Et,this.getActiveSpan=La,this.getSpanContext=dr,this.setSpan=jt,this.setSpanContext=Va;}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var r=Rt(ct,this._proxyTracerProvider,Ye$1.instance());return r&&this._proxyTracerProvider.setDelegate(t),r},e.prototype.getTracerProvider=function(){return qe$1(ct)||this._proxyTracerProvider},e.prototype.getTracer=function(t,r){return this.getTracerProvider().getTracer(t,r)},e.prototype.disable=function(){Ct(ct,Ye$1.instance()),this._proxyTracerProvider=new Zt;},e}(),nn=an.getInstance(),sn=Object.defineProperty,At=(e,t)=>{for(var r in t)sn(e,r,{get:t[r],enumerable:true});};function on({execute:e,onError:t=()=>"An error occurred."}){let r;const a=[],s=new ReadableStream({start(l){r=l;}});function n(l){try{r.enqueue(l);}catch{}}try{const l=e({write(c){n(c);},writeData(c){n(ka$1("data",[c]));},writeMessageAnnotation(c){n(ka$1("message_annotations",[c]));},writeSource(c){n(ka$1("source",c));},merge(c){a.push((async()=>{const u=c.getReader();for(;;){const{done:d,value:m}=await u.read();if(d)break;n(m);}})().catch(u=>{n(ka$1("error",t(u)));}));},onError:t});l&&a.push(l.catch(c=>{n(ka$1("error",t(c)));}));}catch(l){n(ka$1("error",t(l)));}return new Promise(async l=>{for(;a.length>0;)await a.shift();l();}).finally(()=>{try{r.close();}catch{}}),s}function Ce$1(e,{contentType:t,dataStreamVersion:r}){const a=new Headers(e??{});return a.has("Content-Type")||a.set("Content-Type",t),r!==void 0&&a.set("X-Vercel-AI-Data-Stream",r),a}function to({status:e,statusText:t,headers:r,execute:a,onError:s}){return new Response(on({execute:a,onError:s}).pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:Ce$1(r,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function gt(e,{contentType:t,dataStreamVersion:r}){const a={};if(e!=null)for(const[s,n]of Object.entries(e))a[s]=n;return a["Content-Type"]==null&&(a["Content-Type"]=t),r!==void 0&&(a["X-Vercel-AI-Data-Stream"]=r),a}function vt({response:e,status:t,statusText:r,headers:a,stream:s}){e.writeHead(t??200,r,a);const n=s.getReader();(async()=>{try{for(;;){const{done:l,value:c}=await n.read();if(l)break;e.write(c);}}catch(l){throw l}finally{e.end();}})();}var hr="AI_InvalidArgumentError",gr=`vercel.ai.error.${hr}`,ln=Symbol.for(gr),vr,R=class extends E{constructor({parameter:e,value:t,message:r}){super({name:hr,message:`Invalid argument for parameter ${e}: ${r}`}),this[vr]=true,this.parameter=e,this.value=t;}static isInstance(e){return E.hasMarker(e,gr)}};vr=ln;var yr="AI_RetryError",wr=`vercel.ai.error.${yr}`,un=Symbol.for(wr),br,er=class extends E{constructor({message:e,reason:t,errors:r}){super({name:yr,message:e}),this[br]=true,this.reason=t,this.errors=r,this.lastError=r[r.length-1];}static isInstance(e){return E.hasMarker(e,wr)}};br=un;var cn=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>xr(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function xr(e,{maxRetries:t,delayInMs:r,backoffFactor:a},s=[]){try{return await e()}catch(n){if(W$1(n)||t===0)throw n;const o=pa$1(n),l=[...s,n],c=l.length;if(c>t)throw new er({message:`Failed after ${c} attempts. Last error: ${o}`,reason:"maxRetriesExceeded",errors:l});if(n instanceof Error&&C.isInstance(n)&&n.isRetryable===true&&c<=t)return await ua$1(r),xr(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},l);throw c===1?n:new er({message:`Failed after ${c} attempts with non-retryable error: '${o}'`,reason:"errorNotRetryable",errors:l})}}function Sr({maxRetries:e}){if(e!=null){if(!Number.isInteger(e))throw new R({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new R({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const t=e??2;return {maxRetries:t,retry:cn({maxRetries:t})}}function Ue$1({operationId:e,telemetry:t}){return {"operation.name":`${e}${t?.functionId!=null?` ${t.functionId}`:""}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function Tr({model:e,settings:t,telemetry:r,headers:a}){var s;return {"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((n,[o,l])=>(n[`ai.settings.${o}`]=l,n),{}),...Object.entries((s=r?.metadata)!=null?s:{}).reduce((n,[o,l])=>(n[`ai.telemetry.metadata.${o}`]=l,n),{}),...Object.entries(a??{}).reduce((n,[o,l])=>(l!==void 0&&(n[`ai.request.headers.${o}`]=l),n),{})}}var pn={startSpan(){return Xe$1},startActiveSpan(e,t,r,a){if(typeof t=="function")return t(Xe$1);if(typeof r=="function")return r(Xe$1);if(typeof a=="function")return a(Xe$1)}},Xe$1={spanContext(){return dn},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return  false},recordException(){return this}},dn={traceId:"",spanId:"",traceFlags:0};function _r({isEnabled:e=false,tracer:t}={}){return e?t||nn.getTracer("ai"):pn}function $e$1({name:e,tracer:t,attributes:r,fn:a,endWhenDone:s=true}){return t.startActiveSpan(e,{attributes:r},async n=>{try{const o=await a(n);return s&&n.end(),o}catch(o){try{o instanceof Error?(n.recordException({name:o.name,message:o.message,stack:o.stack}),n.setStatus({code:Qe$1.ERROR,message:o.message})):n.setStatus({code:Qe$1.ERROR});}finally{n.end();}throw o}})}function Z$1({telemetry:e,attributes:t}){return e?.isEnabled!==true?{}:Object.entries(t).reduce((r,[a,s])=>{if(s===void 0)return r;if(typeof s=="object"&&"input"in s&&typeof s.input=="function"){if(e?.recordInputs===false)return r;const n=s.input();return n===void 0?r:{...r,[a]:n}}if(typeof s=="object"&&"output"in s&&typeof s.output=="function"){if(e?.recordOutputs===false)return r;const n=s.output();return n===void 0?r:{...r,[a]:n}}return {...r,[a]:s}},{})}var mn=class{constructor({data:e,mimeType:t}){const r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mimeType=t;}get base64(){return this.base64Data==null&&(this.base64Data=Ea$1(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=Ia$1(this.base64Data)),this.uint8ArrayData}},fn=class extends mn{constructor(e){super(e),this.type="file";}},hn=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],gn=e=>{const t=typeof e=="string"?Ia$1(e):e,r=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(r+10)};function vn(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?gn(e):e}function yn({data:e,signatures:t}){const r=vn(e);for(const a of t)if(typeof r=="string"?r.startsWith(a.base64Prefix):r.length>=a.bytesPrefix.length&&a.bytesPrefix.every((s,n)=>r[n]===s))return a.mimeType}var Ir="AI_NoObjectGeneratedError",Rr=`vercel.ai.error.${Ir}`,wn=Symbol.for(Rr),Cr,Ze$1=class Ze extends E{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:s,finishReason:n}){super({name:Ir,message:e,cause:t}),this[Cr]=true,this.text=r,this.response=a,this.usage=s,this.finishReason=n;}static isInstance(e){return E.hasMarker(e,Rr)}};Cr=wn;var Pr="AI_DownloadError",Er=`vercel.ai.error.${Pr}`,bn=Symbol.for(Er),jr,pt$1=class pt extends E{constructor({url:e,statusCode:t,statusText:r,cause:a,message:s=a==null?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:Pr,message:s,cause:a}),this[jr]=true,this.url=e,this.statusCode=t,this.statusText=r;}static isInstance(e){return E.hasMarker(e,Er)}};jr=bn;async function xn({url:e}){var t;const r=e.toString();try{const a=await fetch(r);if(!a.ok)throw new pt$1({url:r,statusCode:a.status,statusText:a.statusText});return {data:new Uint8Array(await a.arrayBuffer()),mimeType:(t=a.headers.get("content-type"))!=null?t:void 0}}catch(a){throw pt$1.isInstance(a)?a:new pt$1({url:r,cause:a})}}var Ar="AI_InvalidDataContentError",Mr=`vercel.ai.error.${Ar}`,Sn=Symbol.for(Mr),Nr,tr=class extends E{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:Ar,message:r,cause:t}),this[Nr]=true,this.content=e;}static isInstance(e){return E.hasMarker(e,Mr)}};Nr=Sn;var Or=z.union([z.string(),z.instanceof(Uint8Array),z.instanceof(ArrayBuffer),z.custom(e=>{var t,r;return (r=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?r:false},{message:"Must be a Buffer"})]);function Mt(e){return typeof e=="string"?e:e instanceof ArrayBuffer?Ea$1(new Uint8Array(e)):Ea$1(e)}function et$1(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return Ia$1(e)}catch(t){throw new tr({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new tr({content:e})}function Tn(e){try{return new TextDecoder().decode(e)}catch{throw new Error("Error decoding Uint8Array to text")}}var kr="AI_InvalidMessageRoleError",Dr=`vercel.ai.error.${kr}`,_n=Symbol.for(Dr),qr,In=class extends E{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:kr,message:t}),this[qr]=true,this.role=e;}static isInstance(e){return E.hasMarker(e,Dr)}};qr=_n;function Rn(e){try{const[t,r]=e.split(",");return {mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch{return {mimeType:void 0,base64Content:void 0}}}async function yt({prompt:e,modelSupportsImageUrls:t=true,modelSupportsUrl:r=()=>false,downloadImplementation:a=xn}){const s=await Pn(e.messages,a,t,r);return [...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(n=>Cn(n,s))]}function Cn(e,t){var r,a,s,n,o,l;const c=e.role;switch(c){case "system":return {role:"system",content:e.content,providerMetadata:(r=e.providerOptions)!=null?r:e.experimental_providerMetadata};case "user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:(a=e.providerOptions)!=null?a:e.experimental_providerMetadata}:{role:"user",content:e.content.map(u=>En(u,t)).filter(u=>u.type!=="text"||u.text!==""),providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata};case "assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter(u=>u.type!=="text"||u.text!=="").map(u=>{var d;const m=(d=u.providerOptions)!=null?d:u.experimental_providerMetadata;switch(u.type){case "file":return {type:"file",data:u.data instanceof URL?u.data:Mt(u.data),filename:u.filename,mimeType:u.mimeType,providerMetadata:m};case "reasoning":return {type:"reasoning",text:u.text,signature:u.signature,providerMetadata:m};case "redacted-reasoning":return {type:"redacted-reasoning",data:u.data,providerMetadata:m};case "text":return {type:"text",text:u.text,providerMetadata:m};case "tool-call":return {type:"tool-call",toolCallId:u.toolCallId,toolName:u.toolName,args:u.args,providerMetadata:m}}}),providerMetadata:(o=e.providerOptions)!=null?o:e.experimental_providerMetadata};case "tool":return {role:"tool",content:e.content.map(u=>{var d;return {type:"tool-result",toolCallId:u.toolCallId,toolName:u.toolName,result:u.result,content:u.experimental_content,isError:u.isError,providerMetadata:(d=u.providerOptions)!=null?d:u.experimental_providerMetadata}}),providerMetadata:(l=e.providerOptions)!=null?l:e.experimental_providerMetadata};default:{const u=c;throw new In({role:u})}}}async function Pn(e,t,r,a){const s=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").filter(o=>!(o.type==="image"&&r===true)).map(o=>o.type==="image"?o.image:o.data).map(o=>typeof o=="string"&&(o.startsWith("http:")||o.startsWith("https:"))?new URL(o):o).filter(o=>o instanceof URL).filter(o=>!a(o)),n=await Promise.all(s.map(async o=>({url:o,data:await t({url:o})})));return Object.fromEntries(n.map(({url:o,data:l})=>[o.toString(),l]))}function En(e,t){var r,a,s,n;if(e.type==="text")return {type:"text",text:e.text,providerMetadata:(r=e.providerOptions)!=null?r:e.experimental_providerMetadata};let o=e.mimeType,l,c,u;const d=e.type;switch(d){case "image":l=e.image;break;case "file":l=e.data;break;default:throw new Error(`Unsupported part type: ${d}`)}try{c=typeof l=="string"?new URL(l):l;}catch{c=l;}if(c instanceof URL)if(c.protocol==="data:"){const{mimeType:m,base64Content:v}=Rn(c.toString());if(m==null||v==null)throw new Error(`Invalid data URL format in part ${d}`);o=m,u=et$1(v);}else {const m=t[c.toString()];m?(u=m.data,o??(o=m.mimeType)):u=c;}else u=et$1(c);switch(d){case "image":return u instanceof Uint8Array&&(o=(a=yn({data:u,signatures:hn}))!=null?a:o),{type:"image",image:u,mimeType:o,providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata};case "file":{if(o==null)throw new Error("Mime type is missing for file part");return {type:"file",data:u instanceof Uint8Array?Mt(u):u,filename:e.filename,mimeType:o,providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata}}}}function wt({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:s,frequencyPenalty:n,stopSequences:o,seed:l}){if(e!=null){if(!Number.isInteger(e))throw new R({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new R({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new R({parameter:"temperature",value:t,message:"temperature must be a number"});if(r!=null&&typeof r!="number")throw new R({parameter:"topP",value:r,message:"topP must be a number"});if(a!=null&&typeof a!="number")throw new R({parameter:"topK",value:a,message:"topK must be a number"});if(s!=null&&typeof s!="number")throw new R({parameter:"presencePenalty",value:s,message:"presencePenalty must be a number"});if(n!=null&&typeof n!="number")throw new R({parameter:"frequencyPenalty",value:n,message:"frequencyPenalty must be a number"});if(l!=null&&!Number.isInteger(l))throw new R({parameter:"seed",value:l,message:"seed must be an integer"});return {maxTokens:e,temperature:t??0,topP:r,topK:a,presencePenalty:s,frequencyPenalty:n,stopSequences:o!=null&&o.length>0?o:void 0,seed:l}}function rr(e){var t,r,a;const s=[];for(const n of e){let o;try{o=new URL(n.url);}catch{throw new Error(`Invalid URL: ${n.url}`)}switch(o.protocol){case "http:":case "https:":{if((t=n.contentType)!=null&&t.startsWith("image/"))s.push({type:"image",image:o});else {if(!n.contentType)throw new Error("If the attachment is not an image, it must specify a content type");s.push({type:"file",data:o,mimeType:n.contentType});}break}case "data:":{let l,c,u;try{[l,c]=n.url.split(","),u=l.split(";")[0].split(":")[1];}catch{throw new Error(`Error processing data URL: ${n.url}`)}if(u==null||c==null)throw new Error(`Invalid data URL format: ${n.url}`);if((r=n.contentType)!=null&&r.startsWith("image/"))s.push({type:"image",image:et$1(c)});else if((a=n.contentType)!=null&&a.startsWith("text/"))s.push({type:"text",text:Tn(et$1(c))});else {if(!n.contentType)throw new Error("If the attachment is not an image or text, it must specify a content type");s.push({type:"file",data:c,mimeType:n.contentType});}break}default:throw new Error(`Unsupported URL protocol: ${o.protocol}`)}}return s}var Ur="AI_MessageConversionError",$r=`vercel.ai.error.${Ur}`,jn=Symbol.for($r),Fr,dt=class extends E{constructor({originalMessage:e,message:t}){super({name:Ur,message:t}),this[Fr]=true,this.originalMessage=e;}static isInstance(e){return E.hasMarker(e,$r)}};Fr=jn;function An(e,t){var r,a;const s=(r=t?.tools)!=null?r:{},n=[];for(let o=0;o<e.length;o++){const l=e[o],c=o===e.length-1,{role:u,content:d,experimental_attachments:m}=l;switch(u){case "system":{n.push({role:"system",content:d});break}case "user":{if(l.parts==null)n.push({role:"user",content:m?[{type:"text",text:d},...rr(m)]:d});else {const v=l.parts.filter(b=>b.type==="text").map(b=>({type:"text",text:b.text}));n.push({role:"user",content:m?[...v,...rr(m)]:v});}break}case "assistant":{if(l.parts!=null){let x=function(){const y=[];for(const h of f)switch(h.type){case "file":case "text":{y.push(h);break}case "reasoning":{for(const P of h.details)switch(P.type){case "text":y.push({type:"reasoning",text:P.text,signature:P.signature});break;case "redacted":y.push({type:"redacted-reasoning",data:P.data});break}break}case "tool-invocation":y.push({type:"tool-call",toolCallId:h.toolInvocation.toolCallId,toolName:h.toolInvocation.toolName,args:h.toolInvocation.args});break;default:{const P=h;throw new Error(`Unsupported part: ${P}`)}}n.push({role:"assistant",content:y});const N=f.filter(h=>h.type==="tool-invocation").map(h=>h.toolInvocation);N.length>0&&n.push({role:"tool",content:N.map(h=>{if(!("result"in h))throw new dt({originalMessage:l,message:"ToolInvocation must have a result: "+JSON.stringify(h)});const{toolCallId:P,toolName:k,result:D}=h,O=s[k];return O?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:P,toolName:k,result:O.experimental_toToolResultContent(D),experimental_content:O.experimental_toToolResultContent(D)}:{type:"tool-result",toolCallId:P,toolName:k,result:D}})}),f=[],w=false,C++;},C=0,w=false,f=[];for(const y of l.parts)switch(y.type){case "text":{w&&x(),f.push(y);break}case "file":case "reasoning":{f.push(y);break}case "tool-invocation":{((a=y.toolInvocation.step)!=null?a:0)!==C&&x(),f.push(y),w=true;break}}x();break}const v=l.toolInvocations;if(v==null||v.length===0){n.push({role:"assistant",content:d});break}const b=v.reduce((x,C)=>{var w;return Math.max(x,(w=C.step)!=null?w:0)},0);for(let x=0;x<=b;x++){const C=v.filter(w=>{var f;return ((f=w.step)!=null?f:0)===x});C.length!==0&&(n.push({role:"assistant",content:[...c&&d&&x===0?[{type:"text",text:d}]:[],...C.map(({toolCallId:w,toolName:f,args:y})=>({type:"tool-call",toolCallId:w,toolName:f,args:y}))]}),n.push({role:"tool",content:C.map(w=>{if(!("result"in w))throw new dt({originalMessage:l,message:"ToolInvocation must have a result: "+JSON.stringify(w)});const{toolCallId:f,toolName:y,result:N}=w,h=s[y];return h?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:f,toolName:y,result:h.experimental_toToolResultContent(N),experimental_content:h.experimental_toToolResultContent(N)}:{type:"tool-result",toolCallId:f,toolName:y,result:N}})}));}d&&!c&&n.push({role:"assistant",content:d});break}case "data":break;default:{const v=u;throw new dt({originalMessage:l,message:`Unsupported role: ${v}`})}}}return n}var bt=z.lazy(()=>z.union([z.null(),z.string(),z.number(),z.boolean(),z.record(z.string(),bt),z.array(bt)])),j=z.record(z.string(),z.record(z.string(),bt)),Mn=z.array(z.union([z.object({type:z.literal("text"),text:z.string()}),z.object({type:z.literal("image"),data:z.string(),mimeType:z.string().optional()})])),Jr=z.object({type:z.literal("text"),text:z.string(),providerOptions:j.optional(),experimental_providerMetadata:j.optional()}),Nn=z.object({type:z.literal("image"),image:z.union([Or,z.instanceof(URL)]),mimeType:z.string().optional(),providerOptions:j.optional(),experimental_providerMetadata:j.optional()}),Br=z.object({type:z.literal("file"),data:z.union([Or,z.instanceof(URL)]),filename:z.string().optional(),mimeType:z.string(),providerOptions:j.optional(),experimental_providerMetadata:j.optional()}),On=z.object({type:z.literal("reasoning"),text:z.string(),providerOptions:j.optional(),experimental_providerMetadata:j.optional()}),kn=z.object({type:z.literal("redacted-reasoning"),data:z.string(),providerOptions:j.optional(),experimental_providerMetadata:j.optional()}),Dn=z.object({type:z.literal("tool-call"),toolCallId:z.string(),toolName:z.string(),args:z.unknown(),providerOptions:j.optional(),experimental_providerMetadata:j.optional()}),qn=z.object({type:z.literal("tool-result"),toolCallId:z.string(),toolName:z.string(),result:z.unknown(),content:Mn.optional(),isError:z.boolean().optional(),providerOptions:j.optional(),experimental_providerMetadata:j.optional()}),Un=z.object({role:z.literal("system"),content:z.string(),providerOptions:j.optional(),experimental_providerMetadata:j.optional()}),$n=z.object({role:z.literal("user"),content:z.union([z.string(),z.array(z.union([Jr,Nn,Br]))]),providerOptions:j.optional(),experimental_providerMetadata:j.optional()}),Fn=z.object({role:z.literal("assistant"),content:z.union([z.string(),z.array(z.union([Jr,Br,On,kn,Dn]))]),providerOptions:j.optional(),experimental_providerMetadata:j.optional()}),Jn=z.object({role:z.literal("tool"),content:z.array(qn),providerOptions:j.optional(),experimental_providerMetadata:j.optional()}),Bn=z.union([Un,$n,Fn,Jn]);function xt({prompt:e,tools:t}){if(e.prompt==null&&e.messages==null)throw new ra$1({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new ra$1({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new ra$1({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new ra$1({prompt:e,message:"prompt must be a string"});return {type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(e.messages!=null){const a=Gn(e.messages)==="ui-messages"?An(e.messages,{tools:t}):e.messages;if(a.length===0)throw new ra$1({prompt:e,message:"messages must not be empty"});const s=ae({value:a,schema:z.array(Bn)});if(!s.success)throw new ra$1({prompt:e,message:["message must be a CoreMessage or a UI message",`Validation error: ${s.error.message}`].join(`
`),cause:s.error});return {type:"messages",messages:a,system:e.system}}throw new Error("unreachable")}function Gn(e){if(!Array.isArray(e))throw new ra$1({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received non-array value: ${JSON.stringify(e)}`].join(`
`),cause:e});if(e.length===0)return "messages";const t=e.map(Ln);if(t.some(a=>a==="has-ui-specific-parts"))return "ui-messages";const r=t.findIndex(a=>a!=="has-core-specific-parts"&&a!=="message");if(r===-1)return "messages";throw new ra$1({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received message of type: "${t[r]}" at index ${r}`,`messages[${r}]: ${JSON.stringify(e[r])}`].join(`
`),cause:e})}function Ln(e){return typeof e=="object"&&e!==null&&(e.role==="function"||e.role==="data"||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":typeof e=="object"&&e!==null&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":typeof e=="object"&&e!==null&&"role"in e&&"content"in e&&typeof e.content=="string"&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function Gr({promptTokens:e,completionTokens:t}){return {promptTokens:e,completionTokens:t,totalTokens:e+t}}function Wn(e,t){return {promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}var Vn="JSON schema:",zn="You MUST answer with a JSON object that matches the JSON schema above.",Xn="You MUST answer with JSON.";function St({prompt:e,schema:t,schemaPrefix:r=t!=null?Vn:void 0,schemaSuffix:a=t!=null?zn:Xn}){return [e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,r,t!=null?JSON.stringify(t):void 0,a].filter(s=>s!=null).join(`
`)}function we$1(e){const t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{const r=t.getReader();return {async next(){const{done:a,value:s}=await r.read();return a?{done:true,value:void 0}:{done:false,value:s}}}},t}var Hn={type:"no-schema",jsonSchema:void 0,validatePartialResult({value:e,textDelta:t}){return {success:true,value:{partial:e,textDelta:t}}},validateFinalResult(e,t){return e===void 0?{success:false,error:new Ze$1({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:true,value:e}},createElementStream(){throw new sa$1({functionality:"element streams in no-schema mode"})}},Kn=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult({value:t,textDelta:r}){return {success:true,value:{partial:t,textDelta:r}}},validateFinalResult(t){return ae({value:t,schema:e})},createElementStream(){throw new sa$1({functionality:"element streams in object mode"})}}),Yn=e=>{const{$schema:t,...r}=e.jsonSchema;return {type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:r}},required:["elements"],additionalProperties:false},validatePartialResult({value:a,latestObject:s,isFirstDelta:n,isFinalDelta:o}){var l;if(!ia$1(a)||!oa$1(a.elements))return {success:false,error:new U({value:a,cause:"value must be an object that contains an array of elements"})};const c=a.elements,u=[];for(let v=0;v<c.length;v++){const b=c[v],x=ae({value:b,schema:e});if(!(v===c.length-1&&!o)){if(!x.success)return x;u.push(x.value);}}const d=(l=s?.length)!=null?l:0;let m="";return n&&(m+="["),d>0&&(m+=","),m+=u.slice(d).map(v=>JSON.stringify(v)).join(","),o&&(m+="]"),{success:true,value:{partial:u,textDelta:m}}},validateFinalResult(a){if(!ia$1(a)||!oa$1(a.elements))return {success:false,error:new U({value:a,cause:"value must be an object that contains an array of elements"})};const s=a.elements;for(const n of s){const o=ae({value:n,schema:e});if(!o.success)return o}return {success:true,value:s}},createElementStream(a){let s=0;return we$1(a.pipeThrough(new TransformStream({transform(n,o){switch(n.type){case "object":{const l=n.object;for(;s<l.length;s++)o.enqueue(l[s]);break}case "text-delta":case "finish":case "error":break;default:{const l=n;throw new Error(`Unsupported chunk type: ${l}`)}}}})))}}},Qn=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:false},validateFinalResult(t){if(!ia$1(t)||typeof t.result!="string")return {success:false,error:new U({value:t,cause:'value must be an object that contains a string in the "result" property.'})};const r=t.result;return e.includes(r)?{success:true,value:r}:{success:false,error:new U({value:t,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new sa$1({functionality:"partial results in enum mode"})},createElementStream(){throw new sa$1({functionality:"element streams in enum mode"})}});function Zn({output:e,schema:t,enumValues:r}){switch(e){case "object":return Kn(Na$1(t));case "array":return Yn(Na$1(t));case "enum":return Qn(r);case "no-schema":return Hn;default:{const a=e;throw new Error(`Unsupported output: ${a}`)}}}function es({output:e,mode:t,schema:r,schemaName:a,schemaDescription:s,enumValues:n}){if(e!=null&&e!=="object"&&e!=="array"&&e!=="enum"&&e!=="no-schema")throw new R({parameter:"output",value:e,message:"Invalid output type."});if(e==="no-schema"){if(t==="auto"||t==="tool")throw new R({parameter:"mode",value:t,message:'Mode must be "json" for no-schema output.'});if(r!=null)throw new R({parameter:"schema",value:r,message:"Schema is not supported for no-schema output."});if(s!=null)throw new R({parameter:"schemaDescription",value:s,message:"Schema description is not supported for no-schema output."});if(a!=null)throw new R({parameter:"schemaName",value:a,message:"Schema name is not supported for no-schema output."});if(n!=null)throw new R({parameter:"enumValues",value:n,message:"Enum values are not supported for no-schema output."})}if(e==="object"){if(r==null)throw new R({parameter:"schema",value:r,message:"Schema is required for object output."});if(n!=null)throw new R({parameter:"enumValues",value:n,message:"Enum values are not supported for object output."})}if(e==="array"){if(r==null)throw new R({parameter:"schema",value:r,message:"Element schema is required for array output."});if(n!=null)throw new R({parameter:"enumValues",value:n,message:"Enum values are not supported for array output."})}if(e==="enum"){if(r!=null)throw new R({parameter:"schema",value:r,message:"Schema is not supported for enum output."});if(s!=null)throw new R({parameter:"schemaDescription",value:s,message:"Schema description is not supported for enum output."});if(a!=null)throw new R({parameter:"schemaName",value:a,message:"Schema name is not supported for enum output."});if(n==null)throw new R({parameter:"enumValues",value:n,message:"Enum values are required for enum output."});for(const o of n)if(typeof o!="string")throw new R({parameter:"enumValues",value:o,message:"Enum values must be strings."})}}function Lr(e){const t=e.map(r=>({...r,content:typeof r.content=="string"?r.content:r.content.map(ts)}));return JSON.stringify(t)}function ts(e){return e.type==="image"?{...e,image:e.image instanceof Uint8Array?Mt(e.image):e.image}:e}At$1({prefix:"aiobj",size:24});var M=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0;}get value(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&t(this.status.error),this._resolve=e,this._reject=t;}),this.promise)}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&((t=this._resolve)==null||t.call(this,e));}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&((t=this._reject)==null||t.call(this,e));}};function ar(){let e,t;return {promise:new Promise((a,s)=>{e=a,t=s;}),resolve:e,reject:t}}function Wr(){let e=[],t=null,r=false,a=ar();const s=async()=>{if(r&&e.length===0){t?.close();return}if(e.length===0)return a=ar(),await a.promise,s();try{const{value:n,done:o}=await e[0].read();o?(e.shift(),e.length>0?await s():r&&t?.close()):t?.enqueue(n);}catch(n){t?.error(n),e.shift(),r&&e.length===0&&t?.close();}};return {stream:new ReadableStream({start(n){t=n;},pull:s,async cancel(){for(const n of e)await n.cancel();e=[],r=true;}}),addStream:n=>{if(r)throw new Error("Cannot add inner stream: outer stream is closed");e.push(n.getReader()),a.resolve();},close:()=>{r=true,a.resolve(),e.length===0&&t?.close();},terminate:()=>{r=true,a.resolve(),e.forEach(n=>n.cancel()),e=[],t?.close();}}}function Vr(){var e,t;return (t=(e=globalThis?.performance)==null?void 0:e.now())!=null?t:Date.now()}var rs=At$1({prefix:"aiobj",size:24});function ro({model:e,schema:t,schemaName:r,schemaDescription:a,mode:s,output:n="object",system:o,prompt:l,messages:c,maxRetries:u,abortSignal:d,headers:m,experimental_telemetry:v,experimental_providerMetadata:b,providerOptions:x=b,onError:C,onFinish:w,_internal:{generateId:f=rs,currentDate:y=()=>new Date,now:N=Vr}={},...h}){es({output:n,mode:s,schema:t,schemaName:r,schemaDescription:a});const P=Zn({output:n,schema:t});return P.type==="no-schema"&&s===void 0&&(s="json"),new as({model:e,telemetry:v,headers:m,settings:h,maxRetries:u,abortSignal:d,outputStrategy:P,system:o,prompt:l,messages:c,schemaName:r,schemaDescription:a,providerOptions:x,mode:s,onError:C,onFinish:w,generateId:f,currentDate:y,now:N})}var as=class{constructor({model:e,headers:t,telemetry:r,settings:a,maxRetries:s,abortSignal:n,outputStrategy:o,system:l,prompt:c,messages:u,schemaName:d,schemaDescription:m,providerOptions:v,mode:b,onError:x,onFinish:C,generateId:w,currentDate:f,now:y}){this.objectPromise=new M,this.usagePromise=new M,this.providerMetadataPromise=new M,this.warningsPromise=new M,this.requestPromise=new M,this.responsePromise=new M;const{maxRetries:N,retry:h}=Sr({maxRetries:s}),P=Tr({model:e,telemetry:r,headers:t,settings:{...a,maxRetries:N}}),k=_r(r),D=this,O=Wr(),de=new TransformStream({transform(F,V){V.enqueue(F),F.type==="error"&&x?.({error:F.error});}});this.baseStream=O.stream.pipeThrough(de),$e$1({name:"ai.streamObject",attributes:Z$1({telemetry:r,attributes:{...Ue$1({operationId:"ai.streamObject",telemetry:r}),...P,"ai.prompt":{input:()=>JSON.stringify({system:l,prompt:c,messages:u})},"ai.schema":o.jsonSchema!=null?{input:()=>JSON.stringify(o.jsonSchema)}:void 0,"ai.schema.name":d,"ai.schema.description":m,"ai.settings.output":o.type,"ai.settings.mode":b}}),tracer:k,endWhenDone:!1,fn:async F=>{var V,ae;(b==="auto"||b==null)&&(b=e.defaultObjectGenerationMode);let ee,ne;switch(b){case "json":{const S=xt({prompt:{system:o.jsonSchema==null?St({prompt:l}):e.supportsStructuredOutputs?l:St({prompt:l,schema:o.jsonSchema}),prompt:c,messages:u},tools:void 0});ee={mode:{type:"object-json",schema:o.jsonSchema,name:d,description:m},...wt(a),inputFormat:S.type,prompt:await yt({prompt:S,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(V=e.supportsUrl)==null?void 0:V.bind(e)}),providerMetadata:v,abortSignal:n,headers:t},ne={transform:(T,_)=>{switch(T.type){case "text-delta":_.enqueue(T.textDelta);break;case "response-metadata":case "finish":case "error":_.enqueue(T);break}}};break}case "tool":{const S=xt({prompt:{system:l,prompt:c,messages:u},tools:void 0});ee={mode:{type:"object-tool",tool:{type:"function",name:d??"json",description:m??"Respond with a JSON object.",parameters:o.jsonSchema}},...wt(a),inputFormat:S.type,prompt:await yt({prompt:S,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(ae=e.supportsUrl)==null?void 0:ae.bind(e)}),providerMetadata:v,abortSignal:n,headers:t},ne={transform(T,_){switch(T.type){case "tool-call-delta":_.enqueue(T.argsTextDelta);break;case "response-metadata":case "finish":case "error":_.enqueue(T);break}}};break}case void 0:throw new Error("Model does not have a default object generation mode.");default:{const S=b;throw new Error(`Unsupported mode: ${S}`)}}const{result:{stream:se,warnings:be,rawResponse:J,request:xe},doStreamSpan:me,startTimestampMs:oe}=await h(()=>$e$1({name:"ai.streamObject.doStream",attributes:Z$1({telemetry:r,attributes:{...Ue$1({operationId:"ai.streamObject.doStream",telemetry:r}),...P,"ai.prompt.format":{input:()=>ee.inputFormat},"ai.prompt.messages":{input:()=>Lr(ee.prompt)},"ai.settings.mode":b,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":a.frequencyPenalty,"gen_ai.request.max_tokens":a.maxTokens,"gen_ai.request.presence_penalty":a.presencePenalty,"gen_ai.request.temperature":a.temperature,"gen_ai.request.top_k":a.topK,"gen_ai.request.top_p":a.topP}}),tracer:k,endWhenDone:!1,fn:async S=>({startTimestampMs:y(),doStreamSpan:S,result:await e.doStream(ee)})}));D.requestPromise.resolve(xe??{});let U,K,ie,te,Se,z="",re="",q={id:w(),timestamp:f(),modelId:e.modelId},le,ue$1,Je=!0,Be=!0;const Ee=se.pipeThrough(new TransformStream(ne)).pipeThrough(new TransformStream({async transform(S,T){var _,B,G;if(Je){const p=y()-oe;Je=!1,me.addEvent("ai.stream.firstChunk",{"ai.stream.msToFirstChunk":p}),me.setAttributes({"ai.stream.msToFirstChunk":p});}if(typeof S=="string"){z+=S,re+=S;const{value:p,state:$}=kr$1(z);if(p!==void 0&&!ue(le,p)){const L=o.validatePartialResult({value:p,textDelta:re,latestObject:ue$1,isFirstDelta:Be,isFinalDelta:$==="successful-parse"});L.success&&!ue(ue$1,L.value.partial)&&(le=p,ue$1=L.value.partial,T.enqueue({type:"object",object:ue$1}),T.enqueue({type:"text-delta",textDelta:L.value.textDelta}),re="",Be=!1);}return}switch(S.type){case "response-metadata":{q={id:(_=S.id)!=null?_:q.id,timestamp:(B=S.timestamp)!=null?B:q.timestamp,modelId:(G=S.modelId)!=null?G:q.modelId};break}case "finish":{re!==""&&T.enqueue({type:"text-delta",textDelta:re}),K=S.finishReason,U=Gr(S.usage),ie=S.providerMetadata,T.enqueue({...S,usage:U,response:q}),D.usagePromise.resolve(U),D.providerMetadataPromise.resolve(ie),D.responsePromise.resolve({...q,headers:J?.headers});const p=o.validateFinalResult(le,{text:z,response:q,usage:U});p.success?(te=p.value,D.objectPromise.resolve(te)):(Se=new Ze$1({message:"No object generated: response did not match schema.",cause:p.error,text:z,response:q,usage:U,finishReason:K}),D.objectPromise.reject(Se));break}default:{T.enqueue(S);break}}},async flush(S){try{const T=U??{promptTokens:NaN,completionTokens:NaN,totalTokens:NaN};me.setAttributes(Z$1({telemetry:r,attributes:{"ai.response.finishReason":K,"ai.response.object":{output:()=>JSON.stringify(te)},"ai.response.id":q.id,"ai.response.model":q.modelId,"ai.response.timestamp":q.timestamp.toISOString(),"ai.usage.promptTokens":T.promptTokens,"ai.usage.completionTokens":T.completionTokens,"gen_ai.response.finish_reasons":[K],"gen_ai.response.id":q.id,"gen_ai.response.model":q.modelId,"gen_ai.usage.input_tokens":T.promptTokens,"gen_ai.usage.output_tokens":T.completionTokens}})),me.end(),F.setAttributes(Z$1({telemetry:r,attributes:{"ai.usage.promptTokens":T.promptTokens,"ai.usage.completionTokens":T.completionTokens,"ai.response.object":{output:()=>JSON.stringify(te)}}})),await C?.({usage:T,object:te,error:Se,response:{...q,headers:J?.headers},warnings:be,providerMetadata:ie,experimental_providerMetadata:ie});}catch(T){S.enqueue({type:"error",error:T});}finally{F.end();}}}));O.addStream(Ee);}}).catch(F=>{O.addStream(new ReadableStream({start(V){V.enqueue({type:"error",error:F}),V.close();}}));}).finally(()=>{O.close();}),this.outputStrategy=o;}get object(){return this.objectPromise.value}get usage(){return this.usagePromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get warnings(){return this.warningsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get partialObjectStream(){return we$1(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case "object":t.enqueue(e.object);break;case "text-delta":case "finish":case "error":break;default:{const r=e;throw new Error(`Unsupported chunk type: ${r}`)}}}})))}get elementStream(){return this.outputStrategy.createElementStream(this.baseStream)}get textStream(){return we$1(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case "text-delta":t.enqueue(e.textDelta);break;case "object":case "finish":case "error":break;default:{const r=e;throw new Error(`Unsupported chunk type: ${r}`)}}}})))}get fullStream(){return we$1(this.baseStream)}pipeTextStreamToResponse(e,t){vt({response:e,status:t?.status,statusText:t?.statusText,headers:gt(t?.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)});}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:(t=e?.status)!=null?t:200,headers:Ce$1(e?.headers,{contentType:"text/plain; charset=utf-8"})})}},zr="AI_NoOutputSpecifiedError",Xr=`vercel.ai.error.${zr}`,ns=Symbol.for(Xr),Hr,ss=class extends E{constructor({message:e="No output specified."}={}){super({name:zr,message:e}),this[Hr]=true;}static isInstance(e){return E.hasMarker(e,Xr)}};Hr=ns;var Kr="AI_ToolExecutionError",Yr=`vercel.ai.error.${Kr}`,os=Symbol.for(Yr),Qr,is=class extends E{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:a,message:s=`Error executing tool ${t}: ${ve$1(a)}`}){super({name:Kr,message:s,cause:a}),this[Qr]=true,this.toolArgs=e,this.toolName=t,this.toolCallId=r;}static isInstance(e){return E.hasMarker(e,Yr)}};Qr=os;function ls(e){return e!=null&&Object.keys(e).length>0}function us({tools:e,toolChoice:t,activeTools:r}){return ls(e)?{tools:(r!=null?Object.entries(e).filter(([s])=>r.includes(s)):Object.entries(e)).map(([s,n])=>{const o=n.type;switch(o){case void 0:case "function":return {type:"function",name:s,description:n.description,parameters:Na$1(n.parameters).jsonSchema};case "provider-defined":return {type:"provider-defined",name:s,id:n.id,args:n.args};default:{const l=o;throw new Error(`Unsupported tool type: ${l}`)}}}),toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var cs=/^([\s\S]*?)(\s+)(\S*)$/;function ps(e){const t=e.match(cs);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}var Zr="AI_InvalidToolArgumentsError",ea=`vercel.ai.error.${Zr}`,ds=Symbol.for(ea),ta,ra=class extends E{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${ve$1(r)}`}){super({name:Zr,message:a,cause:r}),this[ta]=true,this.toolArgs=e,this.toolName=t;}static isInstance(e){return E.hasMarker(e,ea)}};ta=ds;var aa="AI_NoSuchToolError",na=`vercel.ai.error.${aa}`,ms=Symbol.for(na),sa,Tt=class extends E{constructor({toolName:e,availableTools:t=void 0,message:r=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:aa,message:r}),this[sa]=true,this.toolName=e,this.availableTools=t;}static isInstance(e){return E.hasMarker(e,na)}};sa=ms;var oa="AI_ToolCallRepairError",ia=`vercel.ai.error.${oa}`,fs=Symbol.for(ia),la,hs=class extends E{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${ve$1(e)}`}){super({name:oa,message:r,cause:e}),this[la]=true,this.originalError=t;}static isInstance(e){return E.hasMarker(e,ia)}};la=fs;async function gs({toolCall:e,tools:t,repairToolCall:r,system:a,messages:s}){if(t==null)throw new Tt({toolName:e.toolName});try{return await nr({toolCall:e,tools:t})}catch(n){if(r==null||!(Tt.isInstance(n)||ra.isInstance(n)))throw n;let o=null;try{o=await r({toolCall:e,tools:t,parameterSchema:({toolName:l})=>Na$1(t[l].parameters).jsonSchema,system:a,messages:s,error:n});}catch(l){throw new hs({cause:l,originalError:n})}if(o==null)throw n;return await nr({toolCall:o,tools:t})}}async function nr({toolCall:e,tools:t}){const r=e.toolName,a=t[r];if(a==null)throw new Tt({toolName:e.toolName,availableTools:Object.keys(t)});const s=Na$1(a.parameters),n=e.args.trim()===""?ae({value:{},schema:s}):Y$1({text:e.args,schema:s});if(n.success===false)throw new ra({toolName:r,toolArgs:e.args,cause:n.error});return {type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:n.value}}function vs(e){const t=e.filter(r=>r.type==="text").map(r=>r.text).join("");return t.length>0?t:void 0}function sr({text:e="",files:t,reasoning:r,tools:a,toolCalls:s,toolResults:n,messageId:o,generateMessageId:l}){const c=[],u=[];return r.length>0&&u.push(...r.map(d=>d.type==="text"?{...d,type:"reasoning"}:{...d,type:"redacted-reasoning"})),t.length>0&&u.push(...t.map(d=>({type:"file",data:d.base64,mimeType:d.mimeType}))),e.length>0&&u.push({type:"text",text:e}),s.length>0&&u.push(...s),u.length>0&&c.push({role:"assistant",content:u,id:o}),n.length>0&&c.push({role:"tool",id:l(),content:n.map(d=>{const m=a[d.toolName];return m?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:d.toolCallId,toolName:d.toolName,result:m.experimental_toToolResultContent(d.result),experimental_content:m.experimental_toToolResultContent(d.result)}:{type:"tool-result",toolCallId:d.toolCallId,toolName:d.toolName,result:d.result}})}),c}At$1({prefix:"aitxt",size:24});At$1({prefix:"msg",size:24});var ys={};At(ys,{object:()=>Ss,text:()=>xs});var ua="AI_InvalidStreamPartError",ca=`vercel.ai.error.${ua}`,ws=Symbol.for(ca),pa,bs=class extends E{constructor({chunk:e,message:t}){super({name:ua,message:t}),this[pa]=true,this.chunk=e;}static isInstance(e){return E.hasMarker(e,ca)}};pa=ws;var xs=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:e}){return e},parsePartial({text:e}){return {partial:e}},parseOutput({text:e}){return e}}),Ss=({schema:e})=>{const t=Na$1(e);return {type:"object",responseFormat:({model:r})=>({type:"json",schema:r.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt({system:r,model:a}){return a.supportsStructuredOutputs?r:St({prompt:r,schema:t.jsonSchema})},parsePartial({text:r}){const a=kr$1(r);switch(a.state){case "failed-parse":case "undefined-input":return;case "repaired-parse":case "successful-parse":return {partial:a.value};default:{const s=a.state;throw new Error(`Unsupported parse state: ${s}`)}}},parseOutput({text:r},a){const s=Y$1({text:r});if(!s.success)throw new Ze$1({message:"No object generated: could not parse the response.",cause:s.error,text:r,response:a.response,usage:a.usage,finishReason:a.finishReason});const n=ae({value:s.value,schema:t});if(!n.success)throw new Ze$1({message:"No object generated: response did not match schema.",cause:n.error,text:r,response:a.response,usage:a.usage,finishReason:a.finishReason});return n.value}}};function Ts(e){return e===void 0?[]:Array.isArray(e)?e:[e]}async function _s({stream:e,onError:t}){const r=e.getReader();try{for(;;){const{done:a}=await r.read();if(a)break}}catch(a){t?.(a);}finally{r.releaseLock();}}function Nt(e,t){const r=e.getReader(),a=t.getReader();let s,n,o=false,l=false;async function c(d){try{s==null&&(s=r.read());const m=await s;s=void 0,m.done?d.close():d.enqueue(m.value);}catch(m){d.error(m);}}async function u(d){try{n==null&&(n=a.read());const m=await n;n=void 0,m.done?d.close():d.enqueue(m.value);}catch(m){d.error(m);}}return new ReadableStream({async pull(d){try{if(o){await u(d);return}if(l){await c(d);return}s==null&&(s=r.read()),n==null&&(n=a.read());const{result:m,reader:v}=await Promise.race([s.then(b=>({result:b,reader:r})),n.then(b=>({result:b,reader:a}))]);m.done||d.enqueue(m.value),v===r?(s=void 0,m.done&&(await u(d),o=!0)):(n=void 0,m.done&&(l=!0,await c(d)));}catch(m){d.error(m);}},cancel(){r.cancel(),a.cancel();}})}function Is({tools:e,generatorStream:t,toolCallStreaming:r,tracer:a,telemetry:s,system:n,messages:o,abortSignal:l,repairToolCall:c}){let u=null;const d=new ReadableStream({start(f){u=f;}}),m={},v=new Set;let b=false,x;function C(){b&&v.size===0&&(x!=null&&u.enqueue(x),u.close());}const w=new TransformStream({async transform(f,y){const N=f.type;switch(N){case "text-delta":case "reasoning":case "reasoning-signature":case "redacted-reasoning":case "source":case "response-metadata":case "error":{y.enqueue(f);break}case "file":{y.enqueue(new fn({data:f.data,mimeType:f.mimeType}));break}case "tool-call-delta":{r&&(m[f.toolCallId]||(y.enqueue({type:"tool-call-streaming-start",toolCallId:f.toolCallId,toolName:f.toolName}),m[f.toolCallId]=true),y.enqueue({type:"tool-call-delta",toolCallId:f.toolCallId,toolName:f.toolName,argsTextDelta:f.argsTextDelta}));break}case "tool-call":{try{const h=await gs({toolCall:f,tools:e,repairToolCall:c,system:n,messages:o});y.enqueue(h);const P=e[h.toolName];if(P.execute!=null){const k=He$1();v.add(k),$e$1({name:"ai.toolCall",attributes:Z$1({telemetry:s,attributes:{...Ue$1({operationId:"ai.toolCall",telemetry:s}),"ai.toolCall.name":h.toolName,"ai.toolCall.id":h.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(h.args)}}}),tracer:a,fn:async D=>P.execute(h.args,{toolCallId:h.toolCallId,messages:o,abortSignal:l}).then(O=>{u.enqueue({...h,type:"tool-result",result:O}),v.delete(k),C();try{D.setAttributes(Z$1({telemetry:s,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(O)}}}));}catch{}},O=>{u.enqueue({type:"error",error:new is({toolCallId:h.toolCallId,toolName:h.toolName,toolArgs:h.args,cause:O})}),v.delete(k),C();})});}}catch(h){u.enqueue({type:"error",error:h});}break}case "finish":{x={type:"finish",finishReason:f.finishReason,logprobs:f.logprobs,usage:Gr(f.usage),experimental_providerMetadata:f.providerMetadata};break}default:{const h=N;throw new Error(`Unhandled chunk type: ${h}`)}}},flush(){b=true,C();}});return new ReadableStream({async start(f){return Promise.all([t.pipeThrough(w).pipeTo(new WritableStream({write(y){f.enqueue(y);},close(){}})),d.pipeTo(new WritableStream({write(y){f.enqueue(y);},close(){f.close();}}))])}})}var Rs=At$1({prefix:"aitxt",size:24}),Cs=At$1({prefix:"msg",size:24});function ao({model:e,tools:t,toolChoice:r,system:a,prompt:s,messages:n,maxRetries:o,abortSignal:l,headers:c,maxSteps:u=1,experimental_generateMessageId:d=Cs,experimental_output:m,experimental_continueSteps:v=false,experimental_telemetry:b,experimental_providerMetadata:x,providerOptions:C=x,experimental_toolCallStreaming:w=false,toolCallStreaming:f=w,experimental_activeTools:y,experimental_repairToolCall:N,experimental_transform:h,onChunk:P,onError:k,onFinish:D,onStepFinish:O,_internal:{now:de=Vr,generateId:F=Rs,currentDate:V=()=>new Date}={},...ae}){return new Es({model:e,telemetry:b,headers:c,settings:ae,maxRetries:o,abortSignal:l,system:a,prompt:s,messages:n,tools:t,toolChoice:r,toolCallStreaming:f,transforms:Ts(h),activeTools:y,repairToolCall:N,maxSteps:u,output:m,continueSteps:v,providerOptions:C,onChunk:P,onError:k,onFinish:D,onStepFinish:O,now:de,currentDate:V,generateId:F,generateMessageId:d})}function Ps(e){if(!e)return new TransformStream({transform(n,o){o.enqueue({part:n,partialOutput:void 0});}});let t="",r="",a="";function s({controller:n,partialOutput:o=void 0}){n.enqueue({part:{type:"text-delta",textDelta:r},partialOutput:o}),r="";}return new TransformStream({transform(n,o){if(n.type==="step-finish"&&s({controller:o}),n.type!=="text-delta"){o.enqueue({part:n,partialOutput:void 0});return}t+=n.textDelta,r+=n.textDelta;const l=e.parsePartial({text:t});if(l!=null){const c=JSON.stringify(l.partial);c!==a&&(s({controller:o,partialOutput:l.partial}),a=c);}},flush(n){r.length>0&&s({controller:n});}})}var Es=class{constructor({model:e,telemetry:t,headers:r,settings:a,maxRetries:s,abortSignal:n,system:o,prompt:l,messages:c,tools:u,toolChoice:d,toolCallStreaming:m,transforms:v,activeTools:b,repairToolCall:x,maxSteps:C,output:w,continueSteps:f,providerOptions:y,now:N,currentDate:h,generateId:P,generateMessageId:k,onChunk:D,onError:O,onFinish:de,onStepFinish:F}){this.warningsPromise=new M,this.usagePromise=new M,this.finishReasonPromise=new M,this.providerMetadataPromise=new M,this.textPromise=new M,this.reasoningPromise=new M,this.reasoningDetailsPromise=new M,this.sourcesPromise=new M,this.filesPromise=new M,this.toolCallsPromise=new M,this.toolResultsPromise=new M,this.requestPromise=new M,this.responsePromise=new M,this.stepsPromise=new M;var V;if(C<1)throw new R({parameter:"maxSteps",value:C,message:"maxSteps must be at least 1"});this.output=w;let ae="",ee="",ne="",se=[],be=[],J,xe=[];const me=[],oe={id:P(),timestamp:h(),modelId:e.modelId,messages:[]};let U=[],K=[],ie,te,Se="initial";const z=[];let re;const q=new TransformStream({async transform(B,G){G.enqueue(B);const{part:p}=B;if((p.type==="text-delta"||p.type==="reasoning"||p.type==="source"||p.type==="tool-call"||p.type==="tool-result"||p.type==="tool-call-streaming-start"||p.type==="tool-call-delta")&&await D?.({chunk:p}),p.type==="error"&&await O?.({error:p.error}),p.type==="text-delta"&&(ae+=p.textDelta,ee+=p.textDelta,ne+=p.textDelta),p.type==="reasoning"&&(J==null?(J={type:"text",text:p.textDelta},se.push(J)):J.text+=p.textDelta),p.type==="reasoning-signature"){if(J==null)throw new E({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});J.signature=p.signature,J=void 0;}if(p.type==="redacted-reasoning"&&se.push({type:"redacted",data:p.data}),p.type==="file"&&be.push(p),p.type==="source"&&(me.push(p.source),xe.push(p.source)),p.type==="tool-call"&&U.push(p),p.type==="tool-result"&&K.push(p),p.type==="step-finish"){const $=sr({text:ee,files:be,reasoning:se,tools:u??{},toolCalls:U,toolResults:K,messageId:p.messageId,generateMessageId:k}),L=z.length;let X="done";L+1<C&&(f&&p.finishReason==="length"&&U.length===0?X="continue":U.length>0&&K.length===U.length&&(X="tool-result"));const Ge={stepType:Se,text:ae,reasoning:vs(se),reasoningDetails:se,files:be,sources:xe,toolCalls:U,toolResults:K,finishReason:p.finishReason,usage:p.usage,warnings:p.warnings,logprobs:p.logprobs,request:p.request,response:{...p.response,messages:[...oe.messages,...$]},providerMetadata:p.experimental_providerMetadata,experimental_providerMetadata:p.experimental_providerMetadata,isContinued:p.isContinued};await F?.(Ge),z.push(Ge),U=[],K=[],ae="",xe=[],se=[],be=[],J=void 0,X!=="done"&&(Se=X),X!=="continue"&&(oe.messages.push(...$),ee="");}p.type==="finish"&&(oe.id=p.response.id,oe.timestamp=p.response.timestamp,oe.modelId=p.response.modelId,oe.headers=p.response.headers,te=p.usage,ie=p.finishReason);},async flush(B){var G;try{if(z.length===0)return;const p=z[z.length-1];_.warningsPromise.resolve(p.warnings),_.requestPromise.resolve(p.request),_.responsePromise.resolve(p.response),_.toolCallsPromise.resolve(p.toolCalls),_.toolResultsPromise.resolve(p.toolResults),_.providerMetadataPromise.resolve(p.experimental_providerMetadata),_.reasoningPromise.resolve(p.reasoning),_.reasoningDetailsPromise.resolve(p.reasoningDetails);const $=ie??"unknown",L=te??{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};_.finishReasonPromise.resolve($),_.usagePromise.resolve(L),_.textPromise.resolve(ne),_.sourcesPromise.resolve(me),_.filesPromise.resolve(p.files),_.stepsPromise.resolve(z),await de?.({finishReason:$,logprobs:void 0,usage:L,text:ne,reasoning:p.reasoning,reasoningDetails:p.reasoningDetails,files:p.files,sources:p.sources,toolCalls:p.toolCalls,toolResults:p.toolResults,request:(G=p.request)!=null?G:{},response:p.response,warnings:p.warnings,providerMetadata:p.providerMetadata,experimental_providerMetadata:p.experimental_providerMetadata,steps:z}),re.setAttributes(Z$1({telemetry:t,attributes:{"ai.response.finishReason":$,"ai.response.text":{output:()=>ne},"ai.response.toolCalls":{output:()=>{var X;return (X=p.toolCalls)!=null&&X.length?JSON.stringify(p.toolCalls):void 0}},"ai.usage.promptTokens":L.promptTokens,"ai.usage.completionTokens":L.completionTokens}}));}catch(p){B.error(p);}finally{re.end();}}}),le=Wr();this.addStream=le.addStream,this.closeStream=le.close;let ue=le.stream;for(const B of v)ue=ue.pipeThrough(B({tools:u,stopStream(){le.terminate();}}));this.baseStream=ue.pipeThrough(Ps(w)).pipeThrough(q);const{maxRetries:Je,retry:Be}=Sr({maxRetries:s}),Ee=_r(t),S=Tr({model:e,telemetry:t,headers:r,settings:{...a,maxRetries:Je}}),T=xt({prompt:{system:(V=w?.injectIntoSystemPrompt({system:o,model:e}))!=null?V:o,prompt:l,messages:c},tools:u}),_=this;$e$1({name:"ai.streamText",attributes:Z$1({telemetry:t,attributes:{...Ue$1({operationId:"ai.streamText",telemetry:t}),...S,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:l,messages:c})},"ai.settings.maxSteps":C}}),tracer:Ee,endWhenDone:!1,fn:async B=>{re=B;async function G({currentStep:p,responseMessages:$,usage:L,stepType:X,previousStepText:Ge,hasLeadingWhitespace:fa,messageId:Le}){var qt;const rt=$.length===0?T.type:"messages",Ut=[...T.messages,...$],$t=await yt({prompt:{type:rt,system:T.system,messages:Ut},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(qt=e.supportsUrl)==null?void 0:qt.bind(e)}),We={type:"regular",...us({tools:u,toolChoice:d,activeTools:b})},{result:{stream:ha,warnings:at,rawResponse:Ve,request:Ft},doStreamSpan:Te,startTimestampMs:Jt}=await Be(()=>$e$1({name:"ai.streamText.doStream",attributes:Z$1({telemetry:t,attributes:{...Ue$1({operationId:"ai.streamText.doStream",telemetry:t}),...S,"ai.prompt.format":{input:()=>rt},"ai.prompt.messages":{input:()=>Lr($t)},"ai.prompt.tools":{input:()=>{var g;return (g=We.tools)==null?void 0:g.map(A=>JSON.stringify(A))}},"ai.prompt.toolChoice":{input:()=>We.toolChoice!=null?JSON.stringify(We.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":a.frequencyPenalty,"gen_ai.request.max_tokens":a.maxTokens,"gen_ai.request.presence_penalty":a.presencePenalty,"gen_ai.request.stop_sequences":a.stopSequences,"gen_ai.request.temperature":a.temperature,"gen_ai.request.top_k":a.topK,"gen_ai.request.top_p":a.topP}}),tracer:Ee,endWhenDone:!1,fn:async g=>({startTimestampMs:N(),doStreamSpan:g,result:await e.doStream({mode:We,...wt(a),inputFormat:rt,responseFormat:w?.responseFormat({model:e}),prompt:$t,providerMetadata:y,abortSignal:n,headers:r})})})),ga=Is({tools:u,generatorStream:ha,toolCallStreaming:m,tracer:Ee,telemetry:t,system:o,messages:Ut,repairToolCall:x,abortSignal:n}),Bt=Ft??{},fe=[],nt=[],st=[],Gt=[];let he,ge="unknown",ce={promptTokens:0,completionTokens:0,totalTokens:0},je,Lt=!0,Ae="",Wt=X==="continue"?Ge:"",ot,H={id:P(),timestamp:h(),modelId:e.modelId},_e="",Vt=!1,zt=!0,Xt=!1;async function it({controller:g,chunk:A}){g.enqueue(A),Ae+=A.textDelta,Wt+=A.textDelta,Vt=!0,Xt=A.textDelta.trimEnd()!==A.textDelta;}_.addStream(ga.pipeThrough(new TransformStream({async transform(g,A){var Y,Me,ve;if(Lt){const Q=N()-Jt;Lt=!1,Te.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":Q}),Te.setAttributes({"ai.response.msToFirstChunk":Q}),A.enqueue({type:"step-start",messageId:Le,request:Bt,warnings:at??[]});}if(g.type==="text-delta"&&g.textDelta.length===0)return;const Ht=g.type;switch(Ht){case "text-delta":{if(f){const Q=zt&&fa?g.textDelta.trimStart():g.textDelta;if(Q.length===0)break;zt=!1,_e+=Q;const ze=ps(_e);ze!=null&&(_e=ze.suffix,await it({controller:A,chunk:{type:"text-delta",textDelta:ze.prefix+ze.whitespace}}));}else await it({controller:A,chunk:g});break}case "reasoning":{A.enqueue(g),he==null?(he={type:"text",text:g.textDelta},st.push(he)):he.text+=g.textDelta;break}case "reasoning-signature":{if(A.enqueue(g),he==null)throw new bs({chunk:g,message:"reasoning-signature without reasoning"});he.signature=g.signature,he=void 0;break}case "redacted-reasoning":{A.enqueue(g),st.push({type:"redacted",data:g.data});break}case "tool-call":{A.enqueue(g),fe.push(g);break}case "tool-result":{A.enqueue(g),nt.push(g);break}case "response-metadata":{H={id:(Y=g.id)!=null?Y:H.id,timestamp:(Me=g.timestamp)!=null?Me:H.timestamp,modelId:(ve=g.modelId)!=null?ve:H.modelId};break}case "finish":{ce=g.usage,ge=g.finishReason,je=g.experimental_providerMetadata,ot=g.logprobs;const Q=N()-Jt;Te.addEvent("ai.stream.finish"),Te.setAttributes({"ai.response.msToFinish":Q,"ai.response.avgCompletionTokensPerSecond":1e3*ce.completionTokens/Q});break}case "file":{Gt.push(g),A.enqueue(g);break}case "source":case "tool-call-streaming-start":case "tool-call-delta":{A.enqueue(g);break}case "error":{A.enqueue(g),ge="error";break}default:{const Q=Ht;throw new Error(`Unknown chunk type: ${Q}`)}}},async flush(g){const A=fe.length>0?JSON.stringify(fe):void 0;let Y="done";p+1<C&&(f&&ge==="length"&&fe.length===0?Y="continue":fe.length>0&&nt.length===fe.length&&(Y="tool-result")),f&&_e.length>0&&(Y!=="continue"||X==="continue"&&!Vt)&&(await it({controller:g,chunk:{type:"text-delta",textDelta:_e}}),_e="");try{Te.setAttributes(Z$1({telemetry:t,attributes:{"ai.response.finishReason":ge,"ai.response.text":{output:()=>Ae},"ai.response.toolCalls":{output:()=>A},"ai.response.id":H.id,"ai.response.model":H.modelId,"ai.response.timestamp":H.timestamp.toISOString(),"ai.usage.promptTokens":ce.promptTokens,"ai.usage.completionTokens":ce.completionTokens,"gen_ai.response.finish_reasons":[ge],"gen_ai.response.id":H.id,"gen_ai.response.model":H.modelId,"gen_ai.usage.input_tokens":ce.promptTokens,"gen_ai.usage.output_tokens":ce.completionTokens}}));}catch{}finally{Te.end();}g.enqueue({type:"step-finish",finishReason:ge,usage:ce,providerMetadata:je,experimental_providerMetadata:je,logprobs:ot,request:Bt,response:{...H,headers:Ve?.headers},warnings:at,isContinued:Y==="continue",messageId:Le});const Me=Wn(L,ce);if(Y==="done")g.enqueue({type:"finish",finishReason:ge,usage:Me,providerMetadata:je,experimental_providerMetadata:je,logprobs:ot,response:{...H,headers:Ve?.headers}}),_.closeStream();else {if(X==="continue"){const ve=$[$.length-1];typeof ve.content=="string"?ve.content+=Ae:ve.content.push({text:Ae,type:"text"});}else $.push(...sr({text:Ae,files:Gt,reasoning:st,tools:u??{},toolCalls:fe,toolResults:nt,messageId:Le,generateMessageId:k}));await G({currentStep:p+1,responseMessages:$,usage:Me,stepType:Y,previousStepText:Wt,hasLeadingWhitespace:Xt,messageId:Y==="continue"?Le:k()});}}})));}await G({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:k()});}}).catch(B=>{_.addStream(new ReadableStream({start(G){G.enqueue({type:"error",error:B}),G.close();}})),_.closeStream();});}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get files(){return this.filesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){const[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return we$1(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type==="text-delta"&&t.enqueue(e.textDelta);}})))}get fullStream(){return we$1(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e);}})))}async consumeStream(e){var t;try{await _s({stream:this.fullStream,onError:e?.onError});}catch(r){(t=e?.onError)==null||t.call(e,r);}}get experimental_partialOutputStream(){if(this.output==null)throw new ss;return we$1(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e);}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=true,sendReasoning:r=false,sendSources:a=false,experimental_sendFinish:s=true}){return this.fullStream.pipeThrough(new TransformStream({transform:async(n,o)=>{const l=n.type;switch(l){case "text-delta":{o.enqueue(ka$1("text",n.textDelta));break}case "reasoning":{r&&o.enqueue(ka$1("reasoning",n.textDelta));break}case "redacted-reasoning":{r&&o.enqueue(ka$1("redacted_reasoning",{data:n.data}));break}case "reasoning-signature":{r&&o.enqueue(ka$1("reasoning_signature",{signature:n.signature}));break}case "file":{o.enqueue(ka$1("file",{mimeType:n.mimeType,data:n.base64}));break}case "source":{a&&o.enqueue(ka$1("source",n.source));break}case "tool-call-streaming-start":{o.enqueue(ka$1("tool_call_streaming_start",{toolCallId:n.toolCallId,toolName:n.toolName}));break}case "tool-call-delta":{o.enqueue(ka$1("tool_call_delta",{toolCallId:n.toolCallId,argsTextDelta:n.argsTextDelta}));break}case "tool-call":{o.enqueue(ka$1("tool_call",{toolCallId:n.toolCallId,toolName:n.toolName,args:n.args}));break}case "tool-result":{o.enqueue(ka$1("tool_result",{toolCallId:n.toolCallId,result:n.result}));break}case "error":{o.enqueue(ka$1("error",e(n.error)));break}case "step-start":{o.enqueue(ka$1("start_step",{messageId:n.messageId}));break}case "step-finish":{o.enqueue(ka$1("finish_step",{finishReason:n.finishReason,usage:t?{promptTokens:n.usage.promptTokens,completionTokens:n.usage.completionTokens}:void 0,isContinued:n.isContinued}));break}case "finish":{s&&o.enqueue(ka$1("finish_message",{finishReason:n.finishReason,usage:t?{promptTokens:n.usage.promptTokens,completionTokens:n.usage.completionTokens}:void 0}));break}default:{const c=l;throw new Error(`Unknown chunk type: ${c}`)}}}}))}pipeDataStreamToResponse(e,{status:t,statusText:r,headers:a,data:s,getErrorMessage:n,sendUsage:o,sendReasoning:l,sendSources:c,experimental_sendFinish:u}={}){vt({response:e,status:t,statusText:r,headers:gt(a,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:s,getErrorMessage:n,sendUsage:o,sendReasoning:l,sendSources:c,experimental_sendFinish:u})});}pipeTextStreamToResponse(e,t){vt({response:e,status:t?.status,statusText:t?.statusText,headers:gt(t?.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)});}toDataStream(e){const t=this.toDataStreamInternal({getErrorMessage:e?.getErrorMessage,sendUsage:e?.sendUsage,sendReasoning:e?.sendReasoning,sendSources:e?.sendSources,experimental_sendFinish:e?.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return e?.data?Nt(e?.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:t?.sendUsage,sendReasoning:t?.sendReasoning,sendSources:t?.sendSources,experimental_sendFinish:t?.experimental_sendFinish}));}toDataStreamResponse({headers:e,status:t,statusText:r,data:a,getErrorMessage:s,sendUsage:n,sendReasoning:o,sendSources:l,experimental_sendFinish:c}={}){return new Response(this.toDataStream({data:a,getErrorMessage:s,sendUsage:n,sendReasoning:o,sendSources:l,experimental_sendFinish:c}),{status:t,statusText:r,headers:Ce$1(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:(t=e?.status)!=null?t:200,headers:Ce$1(e?.headers,{contentType:"text/plain; charset=utf-8"})})}},js=z.object({name:z.string(),version:z.string()}).passthrough(),Ot=z.object({_meta:z.optional(z.object({}).passthrough())}).passthrough(),Fe$1=Ot,As=z.object({method:z.string(),params:z.optional(Ot)}),Ms=z.object({experimental:z.optional(z.object({}).passthrough()),logging:z.optional(z.object({}).passthrough()),prompts:z.optional(z.object({listChanged:z.optional(z.boolean())}).passthrough()),resources:z.optional(z.object({subscribe:z.optional(z.boolean()),listChanged:z.optional(z.boolean())}).passthrough()),tools:z.optional(z.object({listChanged:z.optional(z.boolean())}).passthrough())}).passthrough();Fe$1.extend({protocolVersion:z.string(),capabilities:Ms,serverInfo:js,instructions:z.optional(z.string())});var Ns=Fe$1.extend({nextCursor:z.optional(z.string())}),Os=z.object({name:z.string(),description:z.optional(z.string()),inputSchema:z.object({type:z.literal("object"),properties:z.optional(z.object({}).passthrough())}).passthrough()}).passthrough();Ns.extend({tools:z.array(Os)});var ks=z.object({type:z.literal("text"),text:z.string()}).passthrough(),Ds=z.object({type:z.literal("image"),data:z.string().base64(),mimeType:z.string()}).passthrough(),da=z.object({uri:z.string(),mimeType:z.optional(z.string())}).passthrough(),qs=da.extend({text:z.string()}),Us=da.extend({blob:z.string().base64()}),$s=z.object({type:z.literal("resource"),resource:z.union([qs,Us])}).passthrough();Fe$1.extend({content:z.array(z.union([ks,Ds,$s])),isError:z.boolean().default(false).optional()}).or(Fe$1.extend({toolResult:z.unknown()}));var tt$1="2.0",Fs=z.object({jsonrpc:z.literal(tt$1),id:z.union([z.string(),z.number().int()])}).merge(As).strict(),Js=z.object({jsonrpc:z.literal(tt$1),id:z.union([z.string(),z.number().int()]),result:Fe$1}).strict(),Bs=z.object({jsonrpc:z.literal(tt$1),id:z.union([z.string(),z.number().int()]),error:z.object({code:z.number().int(),message:z.string(),data:z.optional(z.unknown())})}).strict(),Gs=z.object({jsonrpc:z.literal(tt$1)}).merge(z.object({method:z.string(),params:z.optional(Ot)})).strict();z.union([Fs,Gs,Js,Bs]);var Ls={};At(Ls,{mergeIntoDataStream:()=>zs,toDataStream:()=>Ws,toDataStreamResponse:()=>Vs});function ma(e={}){const t=new TextEncoder;let r="";return new TransformStream({async start(){e.onStart&&await e.onStart();},async transform(a,s){s.enqueue(t.encode(a)),r+=a,e.onToken&&await e.onToken(a),e.onText&&typeof a=="string"&&await e.onText(a);},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r);}})}function kt(e,t){return e.pipeThrough(new TransformStream({transform:async(r,a)=>{var s;if(typeof r=="string"){a.enqueue(r);return}if("event"in r){r.event==="on_chat_model_stream"&&or((s=r.data)==null?void 0:s.chunk,a);return}or(r,a);}})).pipeThrough(ma(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(r,a)=>{a.enqueue(ka$1("text",r));}}))}function Ws(e,t){return kt(e,t).pipeThrough(new TextEncoderStream)}function Vs(e,t){var r;const a=kt(e,t?.callbacks).pipeThrough(new TextEncoderStream),s=t?.data,n=t?.init,o=s?Nt(s.stream,a):a;return new Response(o,{status:(r=n?.status)!=null?r:200,statusText:n?.statusText,headers:Ce$1(n?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function zs(e,t){t.dataStream.merge(kt(e,t.callbacks));}function or(e,t){if(typeof e.content=="string")t.enqueue(e.content);else {const r=e.content;for(const a of r)a.type==="text"&&t.enqueue(a.text);}}var Xs={};At(Xs,{mergeIntoDataStream:()=>Ys,toDataStream:()=>Hs,toDataStreamResponse:()=>Ks});function Dt(e,t){const r=Qs();return la$1(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(a,s){s.enqueue(r(a.delta));}})).pipeThrough(ma(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(a,s)=>{s.enqueue(ka$1("text",a));}}))}function Hs(e,t){return Dt(e,t).pipeThrough(new TextEncoderStream)}function Ks(e,t={}){var r;const{init:a,data:s,callbacks:n}=t,o=Dt(e,n).pipeThrough(new TextEncoderStream),l=s?Nt(s.stream,o):o;return new Response(l,{status:(r=a?.status)!=null?r:200,statusText:a?.statusText,headers:Ce$1(a?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Ys(e,t){t.dataStream.merge(Dt(e,t.callbacks));}function Qs(){let e=true;return t=>(e&&(t=t.trimStart(),t&&(e=false)),t)}

function me({prompt:t,useLegacyFunctionCalling:s=false,systemMessageMode:a="system"}){const d=[],u=[];for(const{role:p,content:n}of t)switch(p){case "system":{switch(a){case "system":{d.push({role:"system",content:n});break}case "developer":{d.push({role:"developer",content:n});break}case "remove":{u.push({type:"other",message:"system messages are removed for this model"});break}default:{const o=a;throw new Error(`Unsupported system message mode: ${o}`)}}break}case "user":{if(n.length===1&&n[0].type==="text"){d.push({role:"user",content:n[0].text});break}d.push({role:"user",content:n.map((o,i)=>{var r,h,c,_;switch(o.type){case "text":return {type:"text",text:o.text};case "image":return {type:"image_url",image_url:{url:o.image instanceof URL?o.image.toString():`data:${(r=o.mimeType)!=null?r:"image/jpeg"};base64,${Ea$1(o.image)}`,detail:(c=(h=o.providerMetadata)==null?void 0:h.openai)==null?void 0:c.imageDetail}};case "file":{if(o.data instanceof URL)throw new sa$1({functionality:"'File content parts with URL data' functionality not supported."});switch(o.mimeType){case "audio/wav":return {type:"input_audio",input_audio:{data:o.data,format:"wav"}};case "audio/mp3":case "audio/mpeg":return {type:"input_audio",input_audio:{data:o.data,format:"mp3"}};case "application/pdf":return {type:"file",file:{filename:(_=o.filename)!=null?_:`part-${i}.pdf`,file_data:`data:application/pdf;base64,${o.data}`}};default:throw new sa$1({functionality:`File content part type ${o.mimeType} in user messages`})}}}})});break}case "assistant":{let o="";const i=[];for(const r of n)switch(r.type){case "text":{o+=r.text;break}case "tool-call":{i.push({id:r.toolCallId,type:"function",function:{name:r.toolName,arguments:JSON.stringify(r.args)}});break}}if(s){if(i.length>1)throw new sa$1({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});d.push({role:"assistant",content:o,function_call:i.length>0?i[0].function:void 0});}else d.push({role:"assistant",content:o,tool_calls:i.length>0?i:void 0});break}case "tool":{for(const o of n)s?d.push({role:"function",name:o.toolName,content:JSON.stringify(o.result)}):d.push({role:"tool",tool_call_id:o.toolCallId,content:JSON.stringify(o.result)});break}default:{const o=p;throw new Error(`Unsupported role: ${o}`)}}return {messages:d,warnings:u}}function Z(t){var s,a;return (a=(s=t?.content)==null?void 0:s.map(({token:d,logprob:u,top_logprobs:p})=>({token:d,logprob:u,topLogprobs:p?p.map(({token:n,logprob:o})=>({token:n,logprob:o})):[]})))!=null?a:void 0}function F(t){switch(t){case "stop":return "stop";case "length":return "length";case "content_filter":return "content-filter";case "function_call":case "tool_calls":return "tool-calls";default:return "unknown"}}var Y=z.object({error:z.object({message:z.string(),type:z.string().nullish(),param:z.any().nullish(),code:z.union([z.string(),z.number()]).nullish()})}),q=ha({errorSchema:Y,errorToMessage:t=>t.error.message});function V({id:t,model:s,created:a}){return {id:t??void 0,modelId:s??void 0,timestamp:a!=null?new Date(a*1e3):void 0}}function he({mode:t,useLegacyFunctionCalling:s=false,structuredOutputs:a}){var d;const u=(d=t.tools)!=null&&d.length?t.tools:void 0,p=[];if(u==null)return {tools:void 0,tool_choice:void 0,toolWarnings:p};const n=t.toolChoice;if(s){const r=[];for(const c of u)c.type==="provider-defined"?p.push({type:"unsupported-tool",tool:c}):r.push({name:c.name,description:c.description,parameters:c.parameters});if(n==null)return {functions:r,function_call:void 0,toolWarnings:p};switch(n.type){case "auto":case "none":case void 0:return {functions:r,function_call:void 0,toolWarnings:p};case "required":throw new sa$1({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return {functions:r,function_call:{name:n.toolName},toolWarnings:p}}}const o=[];for(const r of u)r.type==="provider-defined"?p.push({type:"unsupported-tool",tool:r}):o.push({type:"function",function:{name:r.name,description:r.description,parameters:r.parameters,strict:a?true:void 0}});if(n==null)return {tools:o,tool_choice:void 0,toolWarnings:p};const i=n.type;switch(i){case "auto":case "none":case "required":return {tools:o,tool_choice:i,toolWarnings:p};case "tool":return {tools:o,tool_choice:{type:"function",function:{name:n.toolName}},toolWarnings:p};default:{const r=i;throw new sa$1({functionality:`Unsupported tool choice type: ${r}`})}}}var fe=class{constructor(t,s,a){this.specificationVersion="v1",this.modelId=t,this.settings=s,this.config=a;}get supportsStructuredOutputs(){var t;return (t=this.settings.structuredOutputs)!=null?t:B(this.modelId)}get defaultObjectGenerationMode(){return be(this.modelId)?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return !this.settings.downloadImages}getArgs({mode:t,prompt:s,maxTokens:a,temperature:d,topP:u,topK:p,frequencyPenalty:n,presencePenalty:o,stopSequences:i,responseFormat:r,seed:h,providerMetadata:c}){var _,k,f,g,l,m,y,x;const v=t.type,j=[];p!=null&&j.push({type:"unsupported-setting",setting:"topK"}),r?.type==="json"&&r.schema!=null&&!this.supportsStructuredOutputs&&j.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const I=this.settings.useLegacyFunctionCalling;if(I&&this.settings.parallelToolCalls===true)throw new sa$1({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(I&&this.supportsStructuredOutputs)throw new sa$1({functionality:"structuredOutputs with useLegacyFunctionCalling"});const{messages:M,warnings:b}=me({prompt:s,useLegacyFunctionCalling:I,systemMessageMode:ve(this.modelId)});j.push(...b);const w={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===true||typeof this.settings.logprobs=="number"?true:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:a,temperature:d,top_p:u,frequency_penalty:n,presence_penalty:o,response_format:r?.type==="json"?this.supportsStructuredOutputs&&r.schema!=null?{type:"json_schema",json_schema:{schema:r.schema,strict:true,name:(_=r.name)!=null?_:"response",description:r.description}}:{type:"json_object"}:void 0,stop:i,seed:h,max_completion_tokens:(k=c?.openai)==null?void 0:k.maxCompletionTokens,store:(f=c?.openai)==null?void 0:f.store,metadata:(g=c?.openai)==null?void 0:g.metadata,prediction:(l=c?.openai)==null?void 0:l.prediction,reasoning_effort:(y=(m=c?.openai)==null?void 0:m.reasoningEffort)!=null?y:this.settings.reasoningEffort,messages:M};switch(B(this.modelId)?(w.temperature!=null&&(w.temperature=void 0,j.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),w.top_p!=null&&(w.top_p=void 0,j.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),w.frequency_penalty!=null&&(w.frequency_penalty=void 0,j.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),w.presence_penalty!=null&&(w.presence_penalty=void 0,j.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),w.logit_bias!=null&&(w.logit_bias=void 0,j.push({type:"other",message:"logitBias is not supported for reasoning models"})),w.logprobs!=null&&(w.logprobs=void 0,j.push({type:"other",message:"logprobs is not supported for reasoning models"})),w.top_logprobs!=null&&(w.top_logprobs=void 0,j.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),w.max_tokens!=null&&(w.max_completion_tokens==null&&(w.max_completion_tokens=w.max_tokens),w.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&w.temperature!=null&&(w.temperature=void 0,j.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),v){case "regular":{const{tools:E,tool_choice:L,functions:J,function_call:P,toolWarnings:O}=he({mode:t,useLegacyFunctionCalling:I,structuredOutputs:this.supportsStructuredOutputs});return {args:{...w,tools:E,tool_choice:L,functions:J,function_call:P},warnings:[...j,...O]}}case "object-json":return {args:{...w,response_format:this.supportsStructuredOutputs&&t.schema!=null?{type:"json_schema",json_schema:{schema:t.schema,strict:true,name:(x=t.name)!=null?x:"response",description:t.description}}:{type:"json_object"}},warnings:j};case "object-tool":return {args:I?{...w,function_call:{name:t.tool.name},functions:[{name:t.tool.name,description:t.tool.description,parameters:t.tool.parameters}]}:{...w,tool_choice:{type:"function",function:{name:t.tool.name}},tools:[{type:"function",function:{name:t.tool.name,description:t.tool.description,parameters:t.tool.parameters,strict:this.supportsStructuredOutputs?true:void 0}}]},warnings:j};default:{const E=v;throw new Error(`Unsupported type: ${E}`)}}}async doGenerate(t){var s,a,d,u,p,n,o,i;const{args:r,warnings:h}=this.getArgs(t),{responseHeaders:c,value:_,rawValue:k}=await ga({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ca$1(this.config.headers(),t.headers),body:r,failedResponseHandler:q,successfulResponseHandler:_a$1(_e),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:f,...g}=r,l=_.choices[0],m=(s=_.usage)==null?void 0:s.completion_tokens_details,y=(a=_.usage)==null?void 0:a.prompt_tokens_details,x={openai:{}};return m?.reasoning_tokens!=null&&(x.openai.reasoningTokens=m?.reasoning_tokens),m?.accepted_prediction_tokens!=null&&(x.openai.acceptedPredictionTokens=m?.accepted_prediction_tokens),m?.rejected_prediction_tokens!=null&&(x.openai.rejectedPredictionTokens=m?.rejected_prediction_tokens),y?.cached_tokens!=null&&(x.openai.cachedPromptTokens=y?.cached_tokens),{text:(d=l.message.content)!=null?d:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&l.message.function_call?[{toolCallType:"function",toolCallId:He$1(),toolName:l.message.function_call.name,args:l.message.function_call.arguments}]:(u=l.message.tool_calls)==null?void 0:u.map(v=>{var j;return {toolCallType:"function",toolCallId:(j=v.id)!=null?j:He$1(),toolName:v.function.name,args:v.function.arguments}}),finishReason:F(l.finish_reason),usage:{promptTokens:(n=(p=_.usage)==null?void 0:p.prompt_tokens)!=null?n:NaN,completionTokens:(i=(o=_.usage)==null?void 0:o.completion_tokens)!=null?i:NaN},rawCall:{rawPrompt:f,rawSettings:g},rawResponse:{headers:c,body:k},request:{body:JSON.stringify(r)},response:V(_),warnings:h,logprobs:Z(l.logprobs),providerMetadata:x}}async doStream(t){if(this.settings.simulateStreaming){const g=await this.doGenerate(t);return {stream:new ReadableStream({start(m){if(m.enqueue({type:"response-metadata",...g.response}),g.text&&m.enqueue({type:"text-delta",textDelta:g.text}),g.toolCalls)for(const y of g.toolCalls)m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:y.toolCallId,toolName:y.toolName,argsTextDelta:y.args}),m.enqueue({type:"tool-call",...y});m.enqueue({type:"finish",finishReason:g.finishReason,usage:g.usage,logprobs:g.logprobs,providerMetadata:g.providerMetadata}),m.close();}}),rawCall:g.rawCall,rawResponse:g.rawResponse,warnings:g.warnings}}const{args:s,warnings:a}=this.getArgs(t),d={...s,stream:true,stream_options:this.config.compatibility==="strict"?{include_usage:true}:void 0},{responseHeaders:u,value:p}=await ga({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ca$1(this.config.headers(),t.headers),body:d,failedResponseHandler:q,successfulResponseHandler:ba(ye),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:n,...o}=s,i=[];let r="unknown",h={promptTokens:void 0,completionTokens:void 0},c,_=true;const{useLegacyFunctionCalling:k}=this.settings,f={openai:{}};return {stream:p.pipeThrough(new TransformStream({transform(g,l){var m,y,x,v,j,I,M,b,w,E,L,J;if(!g.success){r="error",l.enqueue({type:"error",error:g.error});return}const P=g.value;if("error"in P){r="error",l.enqueue({type:"error",error:P.error});return}if(_&&(_=false,l.enqueue({type:"response-metadata",...V(P)})),P.usage!=null){const{prompt_tokens:T,completion_tokens:$,prompt_tokens_details:R,completion_tokens_details:C}=P.usage;h={promptTokens:T??void 0,completionTokens:$??void 0},C?.reasoning_tokens!=null&&(f.openai.reasoningTokens=C?.reasoning_tokens),C?.accepted_prediction_tokens!=null&&(f.openai.acceptedPredictionTokens=C?.accepted_prediction_tokens),C?.rejected_prediction_tokens!=null&&(f.openai.rejectedPredictionTokens=C?.rejected_prediction_tokens),R?.cached_tokens!=null&&(f.openai.cachedPromptTokens=R?.cached_tokens);}const O=P.choices[0];if(O?.finish_reason!=null&&(r=F(O.finish_reason)),O?.delta==null)return;const U=O.delta;U.content!=null&&l.enqueue({type:"text-delta",textDelta:U.content});const W=Z(O?.logprobs);W?.length&&(c===void 0&&(c=[]),c.push(...W));const Q=k&&U.function_call!=null?[{type:"function",id:He$1(),function:U.function_call,index:0}]:U.tool_calls;if(Q!=null)for(const T of Q){const $=T.index;if(i[$]==null){if(T.type!=="function")throw new aa$1({data:T,message:"Expected 'function' type."});if(T.id==null)throw new aa$1({data:T,message:"Expected 'id' to be a string."});if(((m=T.function)==null?void 0:m.name)==null)throw new aa$1({data:T,message:"Expected 'function.name' to be a string."});i[$]={id:T.id,type:"function",function:{name:T.function.name,arguments:(y=T.function.arguments)!=null?y:""},hasFinished:false};const C=i[$];((x=C.function)==null?void 0:x.name)!=null&&((v=C.function)==null?void 0:v.arguments)!=null&&(C.function.arguments.length>0&&l.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:C.id,toolName:C.function.name,argsTextDelta:C.function.arguments}),fa(C.function.arguments)&&(l.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(j=C.id)!=null?j:He$1(),toolName:C.function.name,args:C.function.arguments}),C.hasFinished=true));continue}const R=i[$];R.hasFinished||(((I=T.function)==null?void 0:I.arguments)!=null&&(R.function.arguments+=(b=(M=T.function)==null?void 0:M.arguments)!=null?b:""),l.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:R.id,toolName:R.function.name,argsTextDelta:(w=T.function.arguments)!=null?w:""}),((E=R.function)==null?void 0:E.name)!=null&&((L=R.function)==null?void 0:L.arguments)!=null&&fa(R.function.arguments)&&(l.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(J=R.id)!=null?J:He$1(),toolName:R.function.name,args:R.function.arguments}),R.hasFinished=true));}},flush(g){var l,m;g.enqueue({type:"finish",finishReason:r,logprobs:c,usage:{promptTokens:(l=h.promptTokens)!=null?l:NaN,completionTokens:(m=h.completionTokens)!=null?m:NaN},...f!=null?{providerMetadata:f}:{}});}})),rawCall:{rawPrompt:n,rawSettings:o},rawResponse:{headers:u},request:{body:JSON.stringify(d)},warnings:a}}},oe=z.object({prompt_tokens:z.number().nullish(),completion_tokens:z.number().nullish(),prompt_tokens_details:z.object({cached_tokens:z.number().nullish()}).nullish(),completion_tokens_details:z.object({reasoning_tokens:z.number().nullish(),accepted_prediction_tokens:z.number().nullish(),rejected_prediction_tokens:z.number().nullish()}).nullish()}).nullish(),_e=z.object({id:z.string().nullish(),created:z.number().nullish(),model:z.string().nullish(),choices:z.array(z.object({message:z.object({role:z.literal("assistant").nullish(),content:z.string().nullish(),function_call:z.object({arguments:z.string(),name:z.string()}).nullish(),tool_calls:z.array(z.object({id:z.string().nullish(),type:z.literal("function"),function:z.object({name:z.string(),arguments:z.string()})})).nullish()}),index:z.number(),logprobs:z.object({content:z.array(z.object({token:z.string(),logprob:z.number(),top_logprobs:z.array(z.object({token:z.string(),logprob:z.number()}))})).nullable()}).nullish(),finish_reason:z.string().nullish()})),usage:oe}),ye=z.union([z.object({id:z.string().nullish(),created:z.number().nullish(),model:z.string().nullish(),choices:z.array(z.object({delta:z.object({role:z.enum(["assistant"]).nullish(),content:z.string().nullish(),function_call:z.object({name:z.string().optional(),arguments:z.string().optional()}).nullish(),tool_calls:z.array(z.object({index:z.number(),id:z.string().nullish(),type:z.literal("function").nullish(),function:z.object({name:z.string().nullish(),arguments:z.string().nullish()})})).nullish()}).nullish(),logprobs:z.object({content:z.array(z.object({token:z.string(),logprob:z.number(),top_logprobs:z.array(z.object({token:z.string(),logprob:z.number()}))})).nullable()}).nullish(),finish_reason:z.string().nullish(),index:z.number()})),usage:oe}),Y]);function B(t){return t.startsWith("o")}function be(t){return t.startsWith("gpt-4o-audio-preview")}function ve(t){var s,a;return B(t)?(a=(s=we[t])==null?void 0:s.systemMessageMode)!=null?a:"developer":"system"}var we={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function ke({prompt:t,inputFormat:s,user:a="user",assistant:d="assistant"}){if(s==="prompt"&&t.length===1&&t[0].role==="user"&&t[0].content.length===1&&t[0].content[0].type==="text")return {prompt:t[0].content[0].text};let u="";t[0].role==="system"&&(u+=`${t[0].content}

`,t=t.slice(1));for(const{role:p,content:n}of t)switch(p){case "system":throw new ra$1({message:"Unexpected system message in prompt: ${content}",prompt:t});case "user":{const o=n.map(i=>{switch(i.type){case "text":return i.text;case "image":throw new sa$1({functionality:"images"})}}).join("");u+=`${a}:
${o}

`;break}case "assistant":{const o=n.map(i=>{switch(i.type){case "text":return i.text;case "tool-call":throw new sa$1({functionality:"tool-call messages"})}}).join("");u+=`${d}:
${o}

`;break}case "tool":throw new sa$1({functionality:"tool messages"});default:{const o=p;throw new Error(`Unsupported role: ${o}`)}}return u+=`${d}:
`,{prompt:u,stopSequences:[`
${a}:`]}}function ee(t){return t?.tokens.map((s,a)=>({token:s,logprob:t.token_logprobs[a],topLogprobs:t.top_logprobs?Object.entries(t.top_logprobs[a]).map(([d,u])=>({token:d,logprob:u})):[]}))}var xe=class{constructor(t,s,a){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=t,this.settings=s,this.config=a;}get provider(){return this.config.provider}getArgs({mode:t,inputFormat:s,prompt:a,maxTokens:d,temperature:u,topP:p,topK:n,frequencyPenalty:o,presencePenalty:i,stopSequences:r,responseFormat:h,seed:c}){var _;const k=t.type,f=[];n!=null&&f.push({type:"unsupported-setting",setting:"topK"}),h!=null&&h.type!=="text"&&f.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:g,stopSequences:l}=ke({prompt:a,inputFormat:s}),m=[...l??[],...r??[]],y={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:d,temperature:u,top_p:p,frequency_penalty:o,presence_penalty:i,seed:c,prompt:g,stop:m.length>0?m:void 0};switch(k){case "regular":{if((_=t.tools)!=null&&_.length)throw new sa$1({functionality:"tools"});if(t.toolChoice)throw new sa$1({functionality:"toolChoice"});return {args:y,warnings:f}}case "object-json":throw new sa$1({functionality:"object-json mode"});case "object-tool":throw new sa$1({functionality:"object-tool mode"});default:{const x=k;throw new Error(`Unsupported type: ${x}`)}}}async doGenerate(t){const{args:s,warnings:a}=this.getArgs(t),{responseHeaders:d,value:u,rawValue:p}=await ga({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:ca$1(this.config.headers(),t.headers),body:s,failedResponseHandler:q,successfulResponseHandler:_a$1(je),abortSignal:t.abortSignal,fetch:this.config.fetch}),{prompt:n,...o}=s,i=u.choices[0];return {text:i.text,usage:{promptTokens:u.usage.prompt_tokens,completionTokens:u.usage.completion_tokens},finishReason:F(i.finish_reason),logprobs:ee(i.logprobs),rawCall:{rawPrompt:n,rawSettings:o},rawResponse:{headers:d,body:p},response:V(u),warnings:a,request:{body:JSON.stringify(s)}}}async doStream(t){const{args:s,warnings:a}=this.getArgs(t),d={...s,stream:true,stream_options:this.config.compatibility==="strict"?{include_usage:true}:void 0},{responseHeaders:u,value:p}=await ga({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:ca$1(this.config.headers(),t.headers),body:d,failedResponseHandler:q,successfulResponseHandler:ba(Ce),abortSignal:t.abortSignal,fetch:this.config.fetch}),{prompt:n,...o}=s;let i="unknown",r={promptTokens:Number.NaN,completionTokens:Number.NaN},h,c=true;return {stream:p.pipeThrough(new TransformStream({transform(_,k){if(!_.success){i="error",k.enqueue({type:"error",error:_.error});return}const f=_.value;if("error"in f){i="error",k.enqueue({type:"error",error:f.error});return}c&&(c=false,k.enqueue({type:"response-metadata",...V(f)})),f.usage!=null&&(r={promptTokens:f.usage.prompt_tokens,completionTokens:f.usage.completion_tokens});const g=f.choices[0];g?.finish_reason!=null&&(i=F(g.finish_reason)),g?.text!=null&&k.enqueue({type:"text-delta",textDelta:g.text});const l=ee(g?.logprobs);l?.length&&(h===void 0&&(h=[]),h.push(...l));},flush(_){_.enqueue({type:"finish",finishReason:i,logprobs:h,usage:r});}})),rawCall:{rawPrompt:n,rawSettings:o},rawResponse:{headers:u},warnings:a,request:{body:JSON.stringify(d)}}}},je=z.object({id:z.string().nullish(),created:z.number().nullish(),model:z.string().nullish(),choices:z.array(z.object({text:z.string(),finish_reason:z.string(),logprobs:z.object({tokens:z.array(z.string()),token_logprobs:z.array(z.number()),top_logprobs:z.array(z.record(z.string(),z.number())).nullable()}).nullish()})),usage:z.object({prompt_tokens:z.number(),completion_tokens:z.number()})}),Ce=z.union([z.object({id:z.string().nullish(),created:z.number().nullish(),model:z.string().nullish(),choices:z.array(z.object({text:z.string(),finish_reason:z.string().nullish(),index:z.number(),logprobs:z.object({tokens:z.array(z.string()),token_logprobs:z.array(z.number()),top_logprobs:z.array(z.record(z.string(),z.number())).nullable()}).nullish()})),usage:z.object({prompt_tokens:z.number(),completion_tokens:z.number()}).nullish()}),Y]),Ie=class{constructor(t,s,a){this.specificationVersion="v1",this.modelId=t,this.settings=s,this.config=a;}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var t;return (t=this.settings.maxEmbeddingsPerCall)!=null?t:2048}get supportsParallelCalls(){var t;return (t=this.settings.supportsParallelCalls)!=null?t:true}async doEmbed({values:t,headers:s,abortSignal:a}){if(t.length>this.maxEmbeddingsPerCall)throw new na$1({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const{responseHeaders:d,value:u}=await ga({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:ca$1(this.config.headers(),s),body:{model:this.modelId,input:t,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:q,successfulResponseHandler:_a$1(Se),abortSignal:a,fetch:this.config.fetch});return {embeddings:u.data.map(p=>p.embedding),usage:u.usage?{tokens:u.usage.prompt_tokens}:void 0,rawResponse:{headers:d}}}},Se=z.object({data:z.array(z.object({embedding:z.array(z.number())})),usage:z.object({prompt_tokens:z.number()}).nullish()}),Te={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},Re=new Set(["gpt-image-1"]),Me=class{constructor(t,s,a){this.modelId=t,this.settings=s,this.config=a,this.specificationVersion="v1";}get maxImagesPerCall(){var t,s;return (s=(t=this.settings.maxImagesPerCall)!=null?t:Te[this.modelId])!=null?s:1}get provider(){return this.config.provider}async doGenerate({prompt:t,n:s,size:a,aspectRatio:d,seed:u,providerOptions:p,headers:n,abortSignal:o}){var i,r,h,c;const _=[];d!=null&&_.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),u!=null&&_.push({type:"unsupported-setting",setting:"seed"});const k=(h=(r=(i=this.config._internal)==null?void 0:i.currentDate)==null?void 0:r.call(i))!=null?h:new Date,{value:f,responseHeaders:g}=await ga({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:ca$1(this.config.headers(),n),body:{model:this.modelId,prompt:t,n:s,size:a,...(c=p.openai)!=null?c:{},...Re.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:q,successfulResponseHandler:_a$1(Oe),abortSignal:o,fetch:this.config.fetch});return {images:f.data.map(l=>l.b64_json),warnings:_,response:{timestamp:k,modelId:this.modelId,headers:g}}}},Oe=z.object({data:z.array(z.object({b64_json:z.string()}))}),Ae=z.object({include:z.array(z.string()).nullish(),language:z.string().nullish(),prompt:z.string().nullish(),temperature:z.number().min(0).max(1).nullish().default(0),timestampGranularities:z.array(z.enum(["word","segment"])).nullish().default(["segment"])}),te={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},qe=class{constructor(t,s){this.modelId=t,this.config=s,this.specificationVersion="v1";}get provider(){return this.config.provider}getArgs({audio:t,mediaType:s,providerOptions:a}){var d,u,p,n,o;const i=[],r=ma$1({provider:"openai",providerOptions:a,schema:Ae}),h=new FormData,c=t instanceof Uint8Array?new Blob([t]):new Blob([Ia$1(t)]);if(h.append("model",this.modelId),h.append("file",new File([c],"audio",{type:s})),r){const _={include:(d=r.include)!=null?d:void 0,language:(u=r.language)!=null?u:void 0,prompt:(p=r.prompt)!=null?p:void 0,temperature:(n=r.temperature)!=null?n:void 0,timestamp_granularities:(o=r.timestampGranularities)!=null?o:void 0};for(const k in _){const f=_[k];f!==void 0&&h.append(k,String(f));}}return {formData:h,warnings:i}}async doGenerate(t){var s,a,d,u,p,n;const o=(d=(a=(s=this.config._internal)==null?void 0:s.currentDate)==null?void 0:a.call(s))!=null?d:new Date,{formData:i,warnings:r}=this.getArgs(t),{value:h,responseHeaders:c,rawValue:_}=await ya({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:ca$1(this.config.headers(),t.headers),formData:i,failedResponseHandler:q,successfulResponseHandler:_a$1(Ne),abortSignal:t.abortSignal,fetch:this.config.fetch}),k=h.language!=null&&h.language in te?te[h.language]:void 0;return {text:h.text,segments:(p=(u=h.words)==null?void 0:u.map(f=>({text:f.word,startSecond:f.start,endSecond:f.end})))!=null?p:[],language:k,durationInSeconds:(n=h.duration)!=null?n:void 0,warnings:r,response:{timestamp:o,modelId:this.modelId,headers:c,body:_}}}},Ne=z.object({text:z.string(),language:z.string().nullish(),duration:z.number().nullish(),words:z.array(z.object({word:z.string(),start:z.number(),end:z.number()})).nullish()});function Pe({prompt:t,systemMessageMode:s}){const a=[],d=[];for(const{role:u,content:p}of t)switch(u){case "system":{switch(s){case "system":{a.push({role:"system",content:p});break}case "developer":{a.push({role:"developer",content:p});break}case "remove":{d.push({type:"other",message:"system messages are removed for this model"});break}default:{const n=s;throw new Error(`Unsupported system message mode: ${n}`)}}break}case "user":{a.push({role:"user",content:p.map((n,o)=>{var i,r,h,c;switch(n.type){case "text":return {type:"input_text",text:n.text};case "image":return {type:"input_image",image_url:n.image instanceof URL?n.image.toString():`data:${(i=n.mimeType)!=null?i:"image/jpeg"};base64,${Ea$1(n.image)}`,detail:(h=(r=n.providerMetadata)==null?void 0:r.openai)==null?void 0:h.imageDetail};case "file":{if(n.data instanceof URL)throw new sa$1({functionality:"File URLs in user messages"});switch(n.mimeType){case "application/pdf":return {type:"input_file",filename:(c=n.filename)!=null?c:`part-${o}.pdf`,file_data:`data:application/pdf;base64,${n.data}`};default:throw new sa$1({functionality:"Only PDF files are supported in user messages"})}}}})});break}case "assistant":{for(const n of p)switch(n.type){case "text":{a.push({role:"assistant",content:[{type:"output_text",text:n.text}]});break}case "tool-call":{a.push({type:"function_call",call_id:n.toolCallId,name:n.toolName,arguments:JSON.stringify(n.args)});break}}break}case "tool":{for(const n of p)a.push({type:"function_call_output",call_id:n.toolCallId,output:JSON.stringify(n.result)});break}default:{const n=u;throw new Error(`Unsupported role: ${n}`)}}return {messages:a,warnings:d}}function ne({finishReason:t,hasToolCalls:s}){switch(t){case void 0:case null:return s?"tool-calls":"stop";case "max_output_tokens":return "length";case "content_filter":return "content-filter";default:return s?"tool-calls":"unknown"}}function $e({mode:t,strict:s}){var a;const d=(a=t.tools)!=null&&a.length?t.tools:void 0,u=[];if(d==null)return {tools:void 0,tool_choice:void 0,toolWarnings:u};const p=t.toolChoice,n=[];for(const i of d)switch(i.type){case "function":n.push({type:"function",name:i.name,description:i.description,parameters:i.parameters,strict:s?true:void 0});break;case "provider-defined":switch(i.id){case "openai.web_search_preview":n.push({type:"web_search_preview",search_context_size:i.args.searchContextSize,user_location:i.args.userLocation});break;default:u.push({type:"unsupported-tool",tool:i});break}break;default:u.push({type:"unsupported-tool",tool:i});break}if(p==null)return {tools:n,tool_choice:void 0,toolWarnings:u};const o=p.type;switch(o){case "auto":case "none":case "required":return {tools:n,tool_choice:o,toolWarnings:u};case "tool":return p.toolName==="web_search_preview"?{tools:n,tool_choice:{type:"web_search_preview"},toolWarnings:u}:{tools:n,tool_choice:{type:"function",name:p.toolName},toolWarnings:u};default:{const i=o;throw new sa$1({functionality:`Unsupported tool choice type: ${i}`})}}}var De=class{constructor(t,s){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsStructuredOutputs=true,this.modelId=t,this.config=s;}get provider(){return this.config.provider}getArgs({mode:t,maxTokens:s,temperature:a,stopSequences:d,topP:u,topK:p,presencePenalty:n,frequencyPenalty:o,seed:i,prompt:r,providerMetadata:h,responseFormat:c}){var _,k,f;const g=[],l=tt(this.modelId),m=t.type;p!=null&&g.push({type:"unsupported-setting",setting:"topK"}),i!=null&&g.push({type:"unsupported-setting",setting:"seed"}),n!=null&&g.push({type:"unsupported-setting",setting:"presencePenalty"}),o!=null&&g.push({type:"unsupported-setting",setting:"frequencyPenalty"}),d!=null&&g.push({type:"unsupported-setting",setting:"stopSequences"});const{messages:y,warnings:x}=Pe({prompt:r,systemMessageMode:l.systemMessageMode});g.push(...x);const v=ma$1({provider:"openai",providerOptions:h,schema:nt}),j=(_=v?.strictSchemas)!=null?_:true,I={model:this.modelId,input:y,temperature:a,top_p:u,max_output_tokens:s,...c?.type==="json"&&{text:{format:c.schema!=null?{type:"json_schema",strict:j,name:(k=c.name)!=null?k:"response",description:c.description,schema:c.schema}:{type:"json_object"}}},metadata:v?.metadata,parallel_tool_calls:v?.parallelToolCalls,previous_response_id:v?.previousResponseId,store:v?.store,user:v?.user,instructions:v?.instructions,...l.isReasoningModel&&(v?.reasoningEffort!=null||v?.reasoningSummary!=null)&&{reasoning:{...v?.reasoningEffort!=null&&{effort:v.reasoningEffort},...v?.reasoningSummary!=null&&{summary:v.reasoningSummary}}},...l.requiredAutoTruncation&&{truncation:"auto"}};switch(l.isReasoningModel&&(I.temperature!=null&&(I.temperature=void 0,g.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),I.top_p!=null&&(I.top_p=void 0,g.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),m){case "regular":{const{tools:M,tool_choice:b,toolWarnings:w}=$e({mode:t,strict:j});return {args:{...I,tools:M,tool_choice:b},warnings:[...g,...w]}}case "object-json":return {args:{...I,text:{format:t.schema!=null?{type:"json_schema",strict:j,name:(f=t.name)!=null?f:"response",description:t.description,schema:t.schema}:{type:"json_object"}}},warnings:g};case "object-tool":return {args:{...I,tool_choice:{type:"function",name:t.tool.name},tools:[{type:"function",name:t.tool.name,description:t.tool.description,parameters:t.tool.parameters,strict:j}]},warnings:g};default:{const M=m;throw new Error(`Unsupported type: ${M}`)}}}async doGenerate(t){var s,a,d,u,p,n,o;const{args:i,warnings:r}=this.getArgs(t),{responseHeaders:h,value:c,rawValue:_}=await ga({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:ca$1(this.config.headers(),t.headers),body:i,failedResponseHandler:q,successfulResponseHandler:_a$1(z.object({id:z.string(),created_at:z.number(),model:z.string(),output:z.array(z.discriminatedUnion("type",[z.object({type:z.literal("message"),role:z.literal("assistant"),content:z.array(z.object({type:z.literal("output_text"),text:z.string(),annotations:z.array(z.object({type:z.literal("url_citation"),start_index:z.number(),end_index:z.number(),url:z.string(),title:z.string()}))}))}),z.object({type:z.literal("function_call"),call_id:z.string(),name:z.string(),arguments:z.string()}),z.object({type:z.literal("web_search_call")}),z.object({type:z.literal("computer_call")}),z.object({type:z.literal("reasoning"),summary:z.array(z.object({type:z.literal("summary_text"),text:z.string()}))})])),incomplete_details:z.object({reason:z.string()}).nullable(),usage:ie})),abortSignal:t.abortSignal,fetch:this.config.fetch}),k=c.output.filter(l=>l.type==="message").flatMap(l=>l.content).filter(l=>l.type==="output_text"),f=c.output.filter(l=>l.type==="function_call").map(l=>({toolCallType:"function",toolCallId:l.call_id,toolName:l.name,args:l.arguments})),g=(a=(s=c.output.find(l=>l.type==="reasoning"))==null?void 0:s.summary)!=null?a:null;return {text:k.map(l=>l.text).join(`
`),sources:k.flatMap(l=>l.annotations.map(m=>{var y,x,v;return {sourceType:"url",id:(v=(x=(y=this.config).generateId)==null?void 0:x.call(y))!=null?v:He$1(),url:m.url,title:m.title}})),finishReason:ne({finishReason:(d=c.incomplete_details)==null?void 0:d.reason,hasToolCalls:f.length>0}),toolCalls:f.length>0?f:void 0,reasoning:g?g.map(l=>({type:"text",text:l.text})):void 0,usage:{promptTokens:c.usage.input_tokens,completionTokens:c.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:h,body:_},request:{body:JSON.stringify(i)},response:{id:c.id,timestamp:new Date(c.created_at*1e3),modelId:c.model},providerMetadata:{openai:{responseId:c.id,cachedPromptTokens:(p=(u=c.usage.input_tokens_details)==null?void 0:u.cached_tokens)!=null?p:null,reasoningTokens:(o=(n=c.usage.output_tokens_details)==null?void 0:n.reasoning_tokens)!=null?o:null}},warnings:r}}async doStream(t){const{args:s,warnings:a}=this.getArgs(t),{responseHeaders:d,value:u}=await ga({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:ca$1(this.config.headers(),t.headers),body:{...s,stream:true},failedResponseHandler:q,successfulResponseHandler:ba(ze),abortSignal:t.abortSignal,fetch:this.config.fetch}),p=this;let n="unknown",o=NaN,i=NaN,r=null,h=null,c=null;const _={};let k=false;return {stream:u.pipeThrough(new TransformStream({transform(f,g){var l,m,y,x,v,j,I,M;if(!f.success){n="error",g.enqueue({type:"error",error:f.error});return}const b=f.value;if(Xe(b))b.item.type==="function_call"&&(_[b.output_index]={toolName:b.item.name,toolCallId:b.item.call_id},g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:b.item.call_id,toolName:b.item.name,argsTextDelta:b.item.arguments}));else if(Qe(b)){const w=_[b.output_index];w!=null&&g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:w.toolCallId,toolName:w.toolName,argsTextDelta:b.delta});}else Ye(b)?(c=b.response.id,g.enqueue({type:"response-metadata",id:b.response.id,timestamp:new Date(b.response.created_at*1e3),modelId:b.response.model})):Be(b)?g.enqueue({type:"text-delta",textDelta:b.delta}):et(b)?g.enqueue({type:"reasoning",textDelta:b.delta}):Ge(b)&&b.item.type==="function_call"?(_[b.output_index]=void 0,k=true,g.enqueue({type:"tool-call",toolCallType:"function",toolCallId:b.item.call_id,toolName:b.item.name,args:b.item.arguments})):Ke(b)?(n=ne({finishReason:(l=b.response.incomplete_details)==null?void 0:l.reason,hasToolCalls:k}),o=b.response.usage.input_tokens,i=b.response.usage.output_tokens,r=(y=(m=b.response.usage.input_tokens_details)==null?void 0:m.cached_tokens)!=null?y:r,h=(v=(x=b.response.usage.output_tokens_details)==null?void 0:x.reasoning_tokens)!=null?v:h):Ze(b)&&g.enqueue({type:"source",source:{sourceType:"url",id:(M=(I=(j=p.config).generateId)==null?void 0:I.call(j))!=null?M:He$1(),url:b.annotation.url,title:b.annotation.title}});},flush(f){f.enqueue({type:"finish",finishReason:n,usage:{promptTokens:o,completionTokens:i},...(r!=null||h!=null)&&{providerMetadata:{openai:{responseId:c,cachedPromptTokens:r,reasoningTokens:h}}}});}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:d},request:{body:JSON.stringify(s)},warnings:a}}},ie=z.object({input_tokens:z.number(),input_tokens_details:z.object({cached_tokens:z.number().nullish()}).nullish(),output_tokens:z.number(),output_tokens_details:z.object({reasoning_tokens:z.number().nullish()}).nullish()}),Ee=z.object({type:z.literal("response.output_text.delta"),delta:z.string()}),He=z.object({type:z.enum(["response.completed","response.incomplete"]),response:z.object({incomplete_details:z.object({reason:z.string()}).nullish(),usage:ie})}),Ue=z.object({type:z.literal("response.created"),response:z.object({id:z.string(),created_at:z.number(),model:z.string()})}),Le=z.object({type:z.literal("response.output_item.done"),output_index:z.number(),item:z.discriminatedUnion("type",[z.object({type:z.literal("message")}),z.object({type:z.literal("function_call"),id:z.string(),call_id:z.string(),name:z.string(),arguments:z.string(),status:z.literal("completed")})])}),Je=z.object({type:z.literal("response.function_call_arguments.delta"),item_id:z.string(),output_index:z.number(),delta:z.string()}),Fe=z.object({type:z.literal("response.output_item.added"),output_index:z.number(),item:z.discriminatedUnion("type",[z.object({type:z.literal("message")}),z.object({type:z.literal("function_call"),id:z.string(),call_id:z.string(),name:z.string(),arguments:z.string()})])}),Ve=z.object({type:z.literal("response.output_text.annotation.added"),annotation:z.object({type:z.literal("url_citation"),url:z.string(),title:z.string()})}),We=z.object({type:z.literal("response.reasoning_summary_text.delta"),item_id:z.string(),output_index:z.number(),summary_index:z.number(),delta:z.string()}),ze=z.union([Ee,He,Ue,Le,Je,Fe,Ve,We,z.object({type:z.string()}).passthrough()]);function Be(t){return t.type==="response.output_text.delta"}function Ge(t){return t.type==="response.output_item.done"}function Ke(t){return t.type==="response.completed"||t.type==="response.incomplete"}function Ye(t){return t.type==="response.created"}function Qe(t){return t.type==="response.function_call_arguments.delta"}function Xe(t){return t.type==="response.output_item.added"}function Ze(t){return t.type==="response.output_text.annotation.added"}function et(t){return t.type==="response.reasoning_summary_text.delta"}function tt(t){return t.startsWith("o")?t.startsWith("o1-mini")||t.startsWith("o1-preview")?{isReasoningModel:true,systemMessageMode:"remove",requiredAutoTruncation:false}:{isReasoningModel:true,systemMessageMode:"developer",requiredAutoTruncation:false}:{isReasoningModel:false,systemMessageMode:"system",requiredAutoTruncation:false}}var nt=z.object({metadata:z.any().nullish(),parallelToolCalls:z.boolean().nullish(),previousResponseId:z.string().nullish(),store:z.boolean().nullish(),user:z.string().nullish(),reasoningEffort:z.string().nullish(),strictSchemas:z.boolean().nullish(),instructions:z.string().nullish(),reasoningSummary:z.string().nullish()}),st=z.object({});function ot({searchContextSize:t,userLocation:s}={}){return {type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:t,userLocation:s},parameters:st}}var it={webSearchPreview:ot},at=z.object({instructions:z.string().nullish(),speed:z.number().min(.25).max(4).default(1).nullish()}),rt=class{constructor(t,s){this.modelId=t,this.config=s,this.specificationVersion="v1";}get provider(){return this.config.provider}getArgs({text:t,voice:s="alloy",outputFormat:a="mp3",speed:d,instructions:u,providerOptions:p}){const n=[],o=ma$1({provider:"openai",providerOptions:p,schema:at}),i={model:this.modelId,input:t,voice:s,response_format:"mp3",speed:d,instructions:u};if(a&&(["mp3","opus","aac","flac","wav","pcm"].includes(a)?i.response_format=a:n.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${a}. Using mp3 instead.`})),o){const r={};for(const h in r){const c=r[h];c!==void 0&&(i[h]=c);}}return {requestBody:i,warnings:n}}async doGenerate(t){var s,a,d;const u=(d=(a=(s=this.config._internal)==null?void 0:s.currentDate)==null?void 0:a.call(s))!=null?d:new Date,{requestBody:p,warnings:n}=this.getArgs(t),{value:o,responseHeaders:i,rawValue:r}=await ga({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:ca$1(this.config.headers(),t.headers),body:p,failedResponseHandler:q,successfulResponseHandler:va(),abortSignal:t.abortSignal,fetch:this.config.fetch});return {audio:o,warnings:n,request:{body:JSON.stringify(p)},response:{timestamp:u,modelId:this.modelId,headers:i,body:r}}}};function lt(t={}){var s,a,d;const u=(s=wa(t.baseURL))!=null?s:"https://api.openai.com/v1",p=(a=t.compatibility)!=null?a:"compatible",n=(d=t.name)!=null?d:"openai",o=()=>({Authorization:`Bearer ${da$1({apiKey:t.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":t.organization,"OpenAI-Project":t.project,...t.headers}),i=(m,y={})=>new fe(m,y,{provider:`${n}.chat`,url:({path:x})=>`${u}${x}`,headers:o,compatibility:p,fetch:t.fetch}),r=(m,y={})=>new xe(m,y,{provider:`${n}.completion`,url:({path:x})=>`${u}${x}`,headers:o,compatibility:p,fetch:t.fetch}),h=(m,y={})=>new Ie(m,y,{provider:`${n}.embedding`,url:({path:x})=>`${u}${x}`,headers:o,fetch:t.fetch}),c=(m,y={})=>new Me(m,y,{provider:`${n}.image`,url:({path:x})=>`${u}${x}`,headers:o,fetch:t.fetch}),_=m=>new qe(m,{provider:`${n}.transcription`,url:({path:y})=>`${u}${y}`,headers:o,fetch:t.fetch}),k=m=>new rt(m,{provider:`${n}.speech`,url:({path:y})=>`${u}${y}`,headers:o,fetch:t.fetch}),f=(m,y)=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return m==="gpt-3.5-turbo-instruct"?r(m,y):i(m,y)},g=m=>new De(m,{provider:`${n}.responses`,url:({path:y})=>`${u}${y}`,headers:o,fetch:t.fetch}),l=function(m,y){return f(m,y)};return l.languageModel=f,l.chat=i,l.completion=r,l.responses=g,l.embedding=h,l.textEmbedding=h,l.textEmbeddingModel=h,l.image=c,l.imageModel=c,l.transcription=_,l.transcriptionModel=_,l.speech=k,l.speechModel=k,l.tools=it,l}var pt=lt({compatibility:"strict"});

export { ao as a, pt as p, ro as r, to as t };
//# sourceMappingURL=index19.mjs.map
