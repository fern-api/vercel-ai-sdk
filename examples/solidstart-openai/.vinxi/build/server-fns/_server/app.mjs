import{isServer as F,getRequestEvent as T,createComponent as S,delegateEvents as ye}from"solid-js/web";import{F as ve}from"./server-fns.mjs";import{getOwner as Q,runWithOwner as Y,createMemo as L,createContext as Z,createSignal as q,createRenderEffect as be,on as N,useContext as Re,startTransition as Pe,resetErrorBoundaries as Le,batch as Se,untrack as ee,createComponent as Ae,children as Ee,Show as te,createRoot as Ce,onCleanup as ne,sharedConfig as $,Suspense as xe}from"solid-js";import"solid-js/web/storage";import"h3";import"node:async_hooks";function re(){let e=new Set;function t(n){return e.add(n),()=>e.delete(n)}let r=!1;function o(n,a){if(r)return!(r=!1);const s={to:n,options:a,defaultPrevented:!1,preventDefault:()=>s.defaultPrevented=!0};for(const i of e)i.listener({...s,from:i.location,retry:f=>{f&&(r=!0),i.navigate(n,{...a,resolve:!1})}});return!s.defaultPrevented}return{subscribe:t,confirm:o}}let M;function z(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),M=window.history.state._depth}F||z();function Oe(e){return{...e,_depth:window.history.state&&window.history.state._depth}}function Ue(e,t){let r=!1;return()=>{const o=M;z();const n=o==null?null:M-o;if(r){r=!1;return}n&&t(n)?(r=!0,window.history.go(-n)):e()}}const Fe=/^(?:[a-z0-9]+:)?\/\//i,ke=/^\/+|(\/)\/+$/g,oe="http://sr";function j(e,t=!1){const r=e.replace(ke,"$1");return r?t||/^[?#]/.test(r)?r:"/"+r:""}function D(e,t,r){if(Fe.test(t))return;const o=j(e),n=r&&j(r);let a="";return!n||t.startsWith("/")?a=o:n.toLowerCase().indexOf(o.toLowerCase())!==0?a=o+n:a=n,(a||"/")+j(t,!a)}function qe(e,t){return j(e).replace(/\/*(\*.*)?$/g,"")+j(t)}function ae(e){const t={};return e.searchParams.forEach((r,o)=>{o in t?Array.isArray(t[o])?t[o].push(r):t[o]=[t[o],r]:t[o]=r}),t}function je(e,t,r){const[o,n]=e.split("/*",2),a=o.split("/").filter(Boolean),s=a.length;return i=>{const f=i.split("/").filter(Boolean),c=f.length-s;if(c<0||c>0&&n===void 0&&!t)return null;const d={path:s?"":"/",params:{}},y=m=>r===void 0?void 0:r[m];for(let m=0;m<s;m++){const g=a[m],b=g[0]===":",u=b?f[m]:f[m].toLowerCase(),l=b?g.slice(1):g.toLowerCase();if(b&&K(u,y(l)))d.params[l]=u;else if(b||!K(u,l))return null;d.path+=`/${u}`}if(n){const m=c?f.slice(-c).join("/"):"";if(K(m,y(n)))d.params[n]=m;else return null}return d}}function K(e,t){const r=o=>o===e;return t===void 0?!0:typeof t=="string"?r(t):typeof t=="function"?t(e):Array.isArray(t)?t.some(r):t instanceof RegExp?t.test(e):!1}function Be(e){const[t,r]=e.pattern.split("/*",2),o=t.split("/").filter(Boolean);return o.reduce((n,a)=>n+(a.startsWith(":")?2:3),o.length-(r===void 0?0:1))}function se(e){const t=new Map,r=Q();return new Proxy({},{get(o,n){return t.has(n)||Y(r,()=>t.set(n,L(()=>e()[n]))),t.get(n)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(e())}})}function ie(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let r=e.slice(0,t.index),o=e.slice(t.index+t[0].length);const n=[r,r+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(o);)n.push(r+=t[1]),o=o.slice(t[0].length);return ie(o).reduce((a,s)=>[...a,...n.map(i=>i+s)],[])}const Ie=100,We=Z(),ce=Z();function _e(e,t=""){const{component:r,preload:o,load:n,children:a,info:s}=e,i=!a||Array.isArray(a)&&!a.length,f={key:e,component:r,preload:o||n,info:s};return ue(e.path).reduce((c,d)=>{for(const y of ie(d)){const m=qe(t,y);let g=i?m:m.split("/*",1)[0];g=g.split("/").map(b=>b.startsWith(":")||b.startsWith("*")?b:encodeURIComponent(b)).join("/"),c.push({...f,originalPath:d,pattern:g,matcher:je(g,!i,e.matchFilters)})}return c},[])}function De(e,t=0){return{routes:e,score:Be(e[e.length-1])*1e4-t,matcher(r){const o=[];for(let n=e.length-1;n>=0;n--){const a=e[n],s=a.matcher(r);if(!s)return null;o.unshift({...s,route:a})}return o}}}function ue(e){return Array.isArray(e)?e:[e]}function le(e,t="",r=[],o=[]){const n=ue(e);for(let a=0,s=n.length;a<s;a++){const i=n[a];if(i&&typeof i=="object"){i.hasOwnProperty("path")||(i.path="");const f=_e(i,t);for(const c of f){r.push(c);const d=Array.isArray(i.children)&&i.children.length===0;if(i.children&&!d)le(i.children,c.pattern,r,o);else{const y=De([...r],o.length);o.push(y)}r.pop()}}}return r.length?o:o.sort((a,s)=>s.score-a.score)}function B(e,t){for(let r=0,o=e.length;r<o;r++){const n=e[r].matcher(t);if(n)return n}return[]}function Te(e,t,r){const o=new URL(oe),n=L(d=>{const y=e();try{return new URL(y,o)}catch{return console.error(`Invalid path ${y}`),d}},o,{equals:(d,y)=>d.href===y.href}),a=L(()=>n().pathname),s=L(()=>n().search,!0),i=L(()=>n().hash),f=()=>"",c=N(s,()=>ae(n()));return{get pathname(){return a()},get search(){return s()},get hash(){return i()},get state(){return t()},get key(){return f()},query:r?r(c):se(c)}}let C;function $e(){return C}function Ke(e,t,r,o={}){const{signal:[n,a],utils:s={}}=e,i=s.parsePath||(h=>h),f=s.renderPath||(h=>h),c=s.beforeLeave||re(),d=D("",o.base||"");if(d===void 0)throw new Error(`${d} is not a valid base path`);d&&!n().value&&a({value:d,replace:!0,scroll:!1});const[y,m]=q(!1);let g;const b=(h,p)=>{p.value===u()&&p.state===v()||(g===void 0&&m(!0),C=h,g=p,Pe(()=>{g===p&&(l(g.value),w(g.state),Le(),F||E[1]([]))}).finally(()=>{g===p&&Se(()=>{C=void 0,h==="navigate"&&pe(g),m(!1),g=void 0})}))},[u,l]=q(n().value),[v,w]=q(n().state),A=Te(u,v,s.queryWrapper),P=[],E=q(F?we():[]),k=L(()=>typeof o.transformUrl=="function"?B(t(),o.transformUrl(A.pathname)):B(t(),A.pathname)),H=()=>{const h=k(),p={};for(let R=0;R<h.length;R++)Object.assign(p,h[R].params);return p},he=s.paramsWrapper?s.paramsWrapper(H,t):se(H),V={pattern:d,path:()=>d,outlet:()=>null,resolvePath(h){return D(d,h)}};return be(N(n,h=>b("native",h),{defer:!0})),{base:V,location:A,params:he,isRouting:y,renderPath:f,parsePath:i,navigatorFactory:me,matches:k,beforeLeave:c,preloadRoute:ge,singleFlight:o.singleFlight===void 0?!0:o.singleFlight,submissions:E};function de(h,p,R){ee(()=>{if(typeof p=="number"){p&&(s.go?s.go(p):console.warn("Router integration does not support relative routing"));return}const I=!p||p[0]==="?",{replace:W,resolve:x,scroll:_,state:O}={replace:!1,resolve:!I,scroll:!0,...R},U=x?h.resolvePath(p):D(I&&A.pathname||"",p);if(U===void 0)throw new Error(`Path '${p}' is not a routable path`);if(P.length>=Ie)throw new Error("Too many redirects");const J=u();if(U!==J||O!==v())if(F){const X=T();X&&(X.response={status:302,headers:new Headers({Location:U})}),a({value:U,replace:W,scroll:_,state:O})}else c.confirm(U,R)&&(P.push({value:J,replace:W,scroll:_,state:v()}),b("navigate",{value:U,state:O}))})}function me(h){return h=h||Re(ce)||V,(p,R)=>de(h,p,R)}function pe(h){const p=P[0];p&&(a({...h,replace:p.replace,scroll:p.scroll}),P.length=0)}function ge(h,p){const R=B(t(),h.pathname),I=C;C="preload";for(let W in R){const{route:x,params:_}=R[W];x.component&&x.component.preload&&x.component.preload();const{preload:O}=x;p&&O&&Y(r(),()=>O({params:_,location:{pathname:h.pathname,search:h.search,hash:h.hash,query:ae(h),state:null,key:""},intent:"preload"}))}C=I}function we(){const h=T();return h&&h.router&&h.router.submission?[h.router.submission]:[]}}function Me(e,t,r,o){const{base:n,location:a,params:s}=e,{pattern:i,component:f,preload:c}=o().route,d=L(()=>o().path);f&&f.preload&&f.preload();const y=c?c({params:s,location:a,intent:C||"initial"}):void 0;return{parent:t,pattern:i,path:d,outlet:()=>f?Ae(f,{params:s,location:a,data:y,get children(){return r()}}):r(),resolvePath(g){return D(n.path(),g,d())}}}const fe=e=>t=>{const{base:r}=t,o=Ee(()=>t.children),n=L(()=>le(o(),t.base||""));let a;const s=Ke(e,n,()=>a,{base:r,singleFlight:t.singleFlight,transformUrl:t.transformUrl});return e.create&&e.create(s),S(We.Provider,{value:s,get children(){return S(Ne,{routerState:s,get root(){return t.root},get preload(){return t.rootPreload||t.rootLoad},get children(){return[(a=Q())&&null,S(ze,{routerState:s,get branches(){return n()}})]}})}})};function Ne(e){const t=e.routerState.location,r=e.routerState.params,o=L(()=>e.preload&&ee(()=>{e.preload({params:r,location:t,intent:$e()||"initial"})}));return S(te,{get when(){return e.root},keyed:!0,get fallback(){return e.children},children:n=>S(n,{params:r,location:t,get data(){return o()},get children(){return e.children}})})}function ze(e){if(F){const n=T();if(n&&n.router&&n.router.dataOnly){He(n,e.routerState,e.branches);return}n&&((n.router||(n.router={})).matches||(n.router.matches=e.routerState.matches().map(({route:a,path:s,params:i})=>({path:a.originalPath,pattern:a.pattern,match:s,params:i,info:a.info}))))}const t=[];let r;const o=L(N(e.routerState.matches,(n,a,s)=>{let i=a&&n.length===a.length;const f=[];for(let c=0,d=n.length;c<d;c++){const y=a&&a[c],m=n[c];s&&y&&m.route.key===y.route.key?f[c]=s[c]:(i=!1,t[c]&&t[c](),Ce(g=>{t[c]=g,f[c]=Me(e.routerState,f[c-1]||e.routerState.base,G(()=>o()[c+1]),()=>e.routerState.matches()[c])}))}return t.splice(n.length).forEach(c=>c()),s&&i?s:(r=f[0],f)}));return G(()=>o()&&r)()}const G=e=>()=>S(te,{get when(){return e()},keyed:!0,children:t=>S(ce.Provider,{value:t,get children(){return t.outlet()}})});function He(e,t,r){const o=new URL(e.request.url),n=B(r,new URL(e.router.previousUrl||e.request.url).pathname),a=B(r,o.pathname);for(let s=0;s<a.length;s++){(!n[s]||a[s].route!==n[s].route)&&(e.router.dataOnly=!0);const{route:i,params:f}=a[s];i.preload&&i.preload({params:f,location:t.location,intent:"preload"})}}function Ve([e,t],r,o){return[e,o?n=>t(o(n)):t]}function Je(e){let t=!1;const r=n=>typeof n=="string"?{value:n}:n,o=Ve(q(r(e.get()),{equals:(n,a)=>n.value===a.value&&n.state===a.state}),void 0,n=>(!t&&e.set(n),$.registry&&!$.done&&($.done=!0),n));return e.init&&ne(e.init((n=e.get())=>{t=!0,o[1](r(n)),t=!1})),fe({signal:o,create:e.create,utils:e.utils})}function Xe(e,t,r){return e.addEventListener(t,r),()=>e.removeEventListener(t,r)}function Ge(e,t){const r=e&&document.getElementById(e);r?r.scrollIntoView():t&&window.scrollTo(0,0)}function Qe(e){const t=new URL(e);return t.pathname+t.search}function Ye(e){let t;const r={value:e.url||(t=T())&&Qe(t.request.url)||""};return fe({signal:[()=>r,o=>Object.assign(r,o)]})(e)}const Ze=new Map;function et(e=!0,t=!1,r="/_server",o){return n=>{const a=n.base.path(),s=n.navigatorFactory(n.base);let i,f;function c(u){return u.namespaceURI==="http://www.w3.org/2000/svg"}function d(u){if(u.defaultPrevented||u.button!==0||u.metaKey||u.altKey||u.ctrlKey||u.shiftKey)return;const l=u.composedPath().find(k=>k instanceof Node&&k.nodeName.toUpperCase()==="A");if(!l||t&&!l.hasAttribute("link"))return;const v=c(l),w=v?l.href.baseVal:l.href;if((v?l.target.baseVal:l.target)||!w&&!l.hasAttribute("state"))return;const P=(l.getAttribute("rel")||"").split(/\s+/);if(l.hasAttribute("download")||P&&P.includes("external"))return;const E=v?new URL(w,document.baseURI):new URL(w);if(!(E.origin!==window.location.origin||a&&E.pathname&&!E.pathname.toLowerCase().startsWith(a.toLowerCase())))return[l,E]}function y(u){const l=d(u);if(!l)return;const[v,w]=l,A=n.parsePath(w.pathname+w.search+w.hash),P=v.getAttribute("state");u.preventDefault(),s(A,{resolve:!1,replace:v.hasAttribute("replace"),scroll:!v.hasAttribute("noscroll"),state:P?JSON.parse(P):void 0})}function m(u){const l=d(u);if(!l)return;const[v,w]=l;o&&(w.pathname=o(w.pathname)),n.preloadRoute(w,v.getAttribute("preload")!=="false")}function g(u){clearTimeout(i);const l=d(u);if(!l)return f=null;const[v,w]=l;f!==v&&(o&&(w.pathname=o(w.pathname)),i=setTimeout(()=>{n.preloadRoute(w,v.getAttribute("preload")!=="false"),f=v},20))}function b(u){if(u.defaultPrevented)return;let l=u.submitter&&u.submitter.hasAttribute("formaction")?u.submitter.getAttribute("formaction"):u.target.getAttribute("action");if(!l)return;if(!l.startsWith("https://action/")){const w=new URL(l,oe);if(l=n.parsePath(w.pathname+w.search),!l.startsWith(r))return}if(u.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const v=Ze.get(l);if(v){u.preventDefault();const w=new FormData(u.target,u.submitter);v.call({r:n,f:u.target},u.target.enctype==="multipart/form-data"?w:new URLSearchParams(w))}}ye(["click","submit"]),document.addEventListener("click",y),e&&(document.addEventListener("mousemove",g,{passive:!0}),document.addEventListener("focusin",m,{passive:!0}),document.addEventListener("touchstart",m,{passive:!0})),document.addEventListener("submit",b),ne(()=>{document.removeEventListener("click",y),e&&(document.removeEventListener("mousemove",g),document.removeEventListener("focusin",m),document.removeEventListener("touchstart",m)),document.removeEventListener("submit",b)})}}function tt(e){if(F)return Ye(e);const t=()=>{const o=window.location.pathname.replace(/^\/+/,"/")+window.location.search,n=window.history.state&&window.history.state._depth&&Object.keys(window.history.state).length===1?void 0:window.history.state;return{value:o+window.location.hash,state:n}},r=re();return Je({get:t,set({value:o,replace:n,scroll:a,state:s}){n?window.history.replaceState(Oe(s),"",o):window.history.pushState(s,"",o),Ge(decodeURIComponent(window.location.hash.slice(1)),a),z()},init:o=>Xe(window,"popstate",Ue(o,n=>{if(n&&n<0)return!r.confirm(n);{const a=t();return!r.confirm(a.value,{state:a.state})}})),create:et(e.preload,e.explicitLinks,e.actionBase,e.transformUrl),utils:{go:o=>window.history.go(o),beforeLeave:r}})(e)}function ct(){return S(tt,{root:e=>S(xe,{get children(){return e.children}}),get children(){return S(ve,{})}})}export{ct as default};
