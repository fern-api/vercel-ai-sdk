import{lazy as Qe,createComponent as et,sharedConfig as $e}from"solid-js";import{ssrElement as k,escape as ue,mergeProps as tt,ssr as rt,getRequestEvent as st,isServer as it,renderToString as at}from"solid-js/web";import{provideRequestEvent as Te}from"solid-js/web/storage";import{H3Event as H,setHeader as nt,appendResponseHeader as ot,getRequestIP as lt,getResponseStatus as ct,getResponseStatusText as ut,getCookie as dt,setCookie as ht,getResponseHeader as pt,setResponseHeader as ft,removeResponseHeader as mt,getResponseHeaders as vt,getRequestURL as gt,getRequestWebStream as yt,setResponseStatus as bt,eventHandler as zt}from"h3";import{AsyncLocalStorage as St}from"node:async_hooks";var wt=(e=>(e[e.AggregateError=1]="AggregateError",e[e.ArrowFunction=2]="ArrowFunction",e[e.ErrorPrototypeStack=4]="ErrorPrototypeStack",e[e.ObjectAssign=8]="ObjectAssign",e[e.BigIntTypedArray=16]="BigIntTypedArray",e))(wt||{});function xt(e){switch(e){case'"':return'\\"';case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"\b":return"\\b";case"	":return"\\t";case"\f":return"\\f";case"<":return"\\x3C";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return}}function f(e){let t="",r=0,s;for(let i=0,a=e.length;i<a;i++)s=xt(e[i]),s&&(t+=e.slice(r,i)+s,r=i+1);return r===0?t=e:t+=e.slice(r),t}function Rt(e){switch(e){case"\\\\":return"\\";case'\\"':return'"';case"\\n":return`
`;case"\\r":return"\r";case"\\b":return"\b";case"\\t":return"	";case"\\f":return"\f";case"\\x3C":return"<";case"\\u2028":return"\u2028";case"\\u2029":return"\u2029";default:return e}}function g(e){return e.replace(/(\\\\|\\"|\\n|\\r|\\b|\\t|\\f|\\u2028|\\u2029|\\x3C)/g,Rt)}var w="__SEROVAL_REFS__",O="$R",F=`self.${O}`;function At(e){return e==null?`${F}=${F}||[]`:`(${F}=${F}||{})["${f(e)}"]=[]`}function m(e,t){if(!e)throw t}var Oe=new Map,b=new Map;function W(e){return Oe.has(e)}function Et(e){return b.has(e)}function It(e){return m(W(e),new cr(e)),Oe.get(e)}function Pt(e){return m(Et(e),new ur(e)),b.get(e)}typeof globalThis<"u"?Object.defineProperty(globalThis,w,{value:b,configurable:!0,writable:!1,enumerable:!1}):typeof window<"u"?Object.defineProperty(window,w,{value:b,configurable:!0,writable:!1,enumerable:!1}):typeof self<"u"?Object.defineProperty(self,w,{value:b,configurable:!0,writable:!1,enumerable:!1}):typeof global<"u"&&Object.defineProperty(global,w,{value:b,configurable:!0,writable:!1,enumerable:!1});function je(e,t){for(let r=0,s=t.length;r<s;r++){let i=t[r];e.has(i)||(e.add(i),i.extends&&je(e,i.extends))}}function Ce(e){if(e){let t=new Set;return je(t,e),[...t]}}var kt={0:"Symbol.asyncIterator",1:"Symbol.hasInstance",2:"Symbol.isConcatSpreadable",3:"Symbol.iterator",4:"Symbol.match",5:"Symbol.matchAll",6:"Symbol.replace",7:"Symbol.search",8:"Symbol.species",9:"Symbol.split",10:"Symbol.toPrimitive",11:"Symbol.toStringTag",12:"Symbol.unscopables"},Ve={[Symbol.asyncIterator]:0,[Symbol.hasInstance]:1,[Symbol.isConcatSpreadable]:2,[Symbol.iterator]:3,[Symbol.match]:4,[Symbol.matchAll]:5,[Symbol.replace]:6,[Symbol.search]:7,[Symbol.species]:8,[Symbol.split]:9,[Symbol.toPrimitive]:10,[Symbol.toStringTag]:11,[Symbol.unscopables]:12},Ft={0:Symbol.asyncIterator,1:Symbol.hasInstance,2:Symbol.isConcatSpreadable,3:Symbol.iterator,4:Symbol.match,5:Symbol.matchAll,6:Symbol.replace,7:Symbol.search,8:Symbol.species,9:Symbol.split,10:Symbol.toPrimitive,11:Symbol.toStringTag,12:Symbol.unscopables},$t={2:"!0",3:"!1",1:"void 0",0:"null",4:"-0",5:"1/0",6:"-1/0",7:"0/0"},Tt={2:!0,3:!1,1:void 0,0:null,4:-0,5:Number.POSITIVE_INFINITY,6:Number.NEGATIVE_INFINITY,7:Number.NaN},Ne={0:"Error",1:"EvalError",2:"RangeError",3:"ReferenceError",4:"SyntaxError",5:"TypeError",6:"URIError"},Ot={0:Error,1:EvalError,2:RangeError,3:ReferenceError,4:SyntaxError,5:TypeError,6:URIError};function v(e){return{t:2,i:void 0,s:e,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}var B=v(2),K=v(3),jt=v(1),Ct=v(0),Vt=v(4),Nt=v(5),Dt=v(6),Ut=v(7);function ie(e){return e instanceof EvalError?1:e instanceof RangeError?2:e instanceof ReferenceError?3:e instanceof SyntaxError?4:e instanceof TypeError?5:e instanceof URIError?6:0}function _t(e){let t=Ne[ie(e)];return e.name!==t?{name:e.name}:e.constructor.name!==t?{name:e.constructor.name}:{}}function de(e,t){let r=_t(e),s=Object.getOwnPropertyNames(e);for(let i=0,a=s.length,n;i<a;i++)n=s[i],n!=="name"&&n!=="message"&&(n==="stack"?t&4&&(r=r||{},r[n]=e[n]):(r=r||{},r[n]=e[n]));return r}function De(e){return Object.isFrozen(e)?3:Object.isSealed(e)?2:Object.isExtensible(e)?0:1}function Mt(e){switch(e){case Number.POSITIVE_INFINITY:return Nt;case Number.NEGATIVE_INFINITY:return Dt}return e!==e?Ut:Object.is(e,-0)?Vt:{t:0,i:void 0,s:e,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function X(e){return{t:1,i:void 0,s:f(e),l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function qt(e){return{t:3,i:void 0,s:""+e,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Lt(e){return{t:4,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Ht(e,t){return{t:5,i:e,s:t.toISOString(),l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,f:void 0,a:void 0,b:void 0,o:void 0}}function Wt(e,t){return{t:6,i:e,s:void 0,l:void 0,c:f(t.source),m:t.flags,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Bt(e,t){let r=new Uint8Array(t),s=r.length,i=new Array(s);for(let a=0;a<s;a++)i[a]=r[a];return{t:19,i:e,s:i,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Kt(e,t){return{t:17,i:e,s:Ve[t],l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function he(e,t){return{t:18,i:e,s:f(It(t)),l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Ue(e,t,r){return{t:25,i:e,s:r,l:void 0,c:f(t),m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Xt(e,t,r){return{t:9,i:e,s:void 0,l:t.length,c:void 0,m:void 0,p:void 0,e:void 0,a:r,f:void 0,b:void 0,o:De(t)}}function Gt(e,t){return{t:21,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:t,b:void 0,o:void 0}}function Jt(e,t,r){return{t:15,i:e,s:void 0,l:t.length,c:t.constructor.name,m:void 0,p:void 0,e:void 0,a:void 0,f:r,b:t.byteOffset,o:void 0}}function Yt(e,t,r){return{t:16,i:e,s:void 0,l:t.length,c:t.constructor.name,m:void 0,p:void 0,e:void 0,a:void 0,f:r,b:t.byteOffset,o:void 0}}function Zt(e,t,r){return{t:20,i:e,s:void 0,l:t.byteLength,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:r,b:t.byteOffset,o:void 0}}function Qt(e,t,r){return{t:13,i:e,s:ie(t),l:void 0,c:void 0,m:f(t.message),p:r,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function er(e,t,r){return{t:14,i:e,s:ie(t),l:void 0,c:void 0,m:f(t.message),p:r,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function tr(e,t,r){return{t:7,i:e,s:void 0,l:t,c:void 0,m:void 0,p:void 0,e:void 0,a:r,f:void 0,b:void 0,o:void 0}}function _e(e,t){return{t:28,i:void 0,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[e,t],f:void 0,b:void 0,o:void 0}}function Me(e,t){return{t:30,i:void 0,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[e,t],f:void 0,b:void 0,o:void 0}}function qe(e,t,r){return{t:31,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:r,f:t,b:void 0,o:void 0}}function rr(e,t){return{t:32,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:t,b:void 0,o:void 0}}function sr(e,t){return{t:33,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:t,b:void 0,o:void 0}}function ir(e,t){return{t:34,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:t,b:void 0,o:void 0}}var{toString:ae}=Object.prototype;function ar(e,t){return t instanceof Error?`Seroval caught an error during the ${e} process.
  
${t.name}
${t.message}

- For more information, please check the "cause" property of this error.
- If you believe this is an error in Seroval, please submit an issue at https://github.com/lxsmnsyc/seroval/issues/new`:`Seroval caught an error during the ${e} process.

"${ae.call(t)}"

For more information, please check the "cause" property of this error.`}var ne=class extends Error{constructor(t,r){super(ar(t,r)),this.cause=r}},nr=class extends ne{constructor(t){super("parsing",t)}},or=class extends ne{constructor(e){super("serialization",e)}},lr=class extends ne{constructor(e){super("deserialization",e)}},j=class extends Error{constructor(t){super(`The value ${ae.call(t)} of type "${typeof t}" cannot be parsed/serialized.
      
There are few workarounds for this problem:
- Transform the value in a way that it can be serialized.
- If the reference is present on multiple runtimes (isomorphic), you can use the Reference API to map the references.`),this.value=t}},Le=class extends Error{constructor(t){super('Unsupported node type "'+t.t+'".')}},He=class extends Error{constructor(e){super('Missing plugin for tag "'+e+'".')}},S=class extends Error{constructor(t){super('Missing "'+t+'" instance.')}},cr=class extends Error{constructor(t){super('Missing reference for the value "'+ae.call(t)+'" of type "'+typeof t+'"'),this.value=t}},ur=class extends Error{constructor(e){super('Missing reference for id "'+f(e)+'"')}},dr=class extends Error{constructor(e){super('Unknown TypedArray "'+e+'"')}},hr={},pr={},fr={0:{},1:{},2:{},3:{},4:{}};function G(){let e,t;return{promise:new Promise((r,s)=>{e=r,t=s}),resolve(r){e(r)},reject(r){t(r)}}}function mr(e){return"__SEROVAL_STREAM__"in e}function P(){let e=new Set,t=[],r=!0,s=!0;function i(o){for(let l of e.keys())l.next(o)}function a(o){for(let l of e.keys())l.throw(o)}function n(o){for(let l of e.keys())l.return(o)}return{__SEROVAL_STREAM__:!0,on(o){r&&e.add(o);for(let l=0,c=t.length;l<c;l++){let d=t[l];l===c-1&&!r?s?o.return(d):o.throw(d):o.next(d)}return()=>{r&&e.delete(o)}},next(o){r&&(t.push(o),i(o))},throw(o){r&&(t.push(o),a(o),r=!1,s=!1,e.clear())},return(o){r&&(t.push(o),n(o),r=!1,s=!0,e.clear())}}}function vr(e){let t=P(),r=e[Symbol.asyncIterator]();async function s(){try{let i=await r.next();i.done?t.return(i.value):(t.next(i.value),await s())}catch(i){t.throw(i)}}return s().catch(()=>{}),t}function gr(e){return()=>{let t=[],r=[],s=0,i=-1,a=!1;function n(){for(let l=0,c=r.length;l<c;l++)r[l].resolve({done:!0,value:void 0})}e.on({next(l){let c=r.shift();c&&c.resolve({done:!1,value:l}),t.push(l)},throw(l){let c=r.shift();c&&c.reject(l),n(),i=t.length,t.push(l),a=!0},return(l){let c=r.shift();c&&c.resolve({done:!0,value:l}),n(),i=t.length,t.push(l)}});function o(){let l=s++,c=t[l];if(l!==i)return{done:!1,value:c};if(a)throw c;return{done:!0,value:c}}return{[Symbol.asyncIterator](){return this},async next(){if(i===-1){let l=s++;if(l>=t.length){let c=G();return r.push(c),await c.promise}return{done:!1,value:t[l]}}return s>i?{done:!0,value:void 0}:o()}}}}function We(e){let t=[],r=-1,s=-1,i=e[Symbol.iterator]();for(;;)try{let a=i.next();if(t.push(a.value),a.done){s=t.length-1;break}}catch(a){r=t.length,t.push(a)}return{v:t,t:r,d:s}}function yr(e){return()=>{let t=0;return{[Symbol.iterator](){return this},next(){if(t>e.d)return{done:!0,value:void 0};let r=t++,s=e.v[r];if(r===e.t)throw s;return{done:r===e.d,value:s}}}}}var br=class{constructor(e){this.marked=new Set,this.plugins=e.plugins,this.features=31^(e.disabledFeatures||0),this.refs=e.refs||new Map}markRef(e){this.marked.add(e)}isMarked(e){return this.marked.has(e)}getIndexedValue(e){let t=this.refs.get(e);if(t!=null)return this.markRef(t),{type:1,value:Lt(t)};let r=this.refs.size;return this.refs.set(e,r),{type:0,value:r}}getReference(e){let t=this.getIndexedValue(e);return t.type===1?t:W(e)?{type:2,value:he(t.value,e)}:t}getStrictReference(e){m(W(e),new j(e));let t=this.getIndexedValue(e);return t.type===1?t.value:he(t.value,e)}parseFunction(e){return this.getStrictReference(e)}parseWellKnownSymbol(e){let t=this.getReference(e);return t.type!==0?t.value:(m(e in Ve,new j(e)),Kt(t.value,e))}parseSpecialReference(e){let t=this.getIndexedValue(fr[e]);return t.type===1?t.value:{t:26,i:t.value,s:e,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}parseIteratorFactory(){let e=this.getIndexedValue(hr);return e.type===1?e.value:{t:27,i:e.value,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:this.parseWellKnownSymbol(Symbol.iterator),b:void 0,o:void 0}}parseAsyncIteratorFactory(){let e=this.getIndexedValue(pr);return e.type===1?e.value:{t:29,i:e.value,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[this.parseSpecialReference(1),this.parseWellKnownSymbol(Symbol.asyncIterator)],f:void 0,b:void 0,o:void 0}}createObjectNode(e,t,r,s){return{t:r?11:10,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:s,e:void 0,a:void 0,f:void 0,b:void 0,o:De(t)}}createMapNode(e,t,r,s){return{t:8,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:{k:t,v:r,s},a:void 0,f:this.parseSpecialReference(0),b:void 0,o:void 0}}createPromiseConstructorNode(e){return{t:22,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:this.parseSpecialReference(1),b:void 0,o:void 0}}};function zr(e){switch(e){case"Int8Array":return Int8Array;case"Int16Array":return Int16Array;case"Int32Array":return Int32Array;case"Uint8Array":return Uint8Array;case"Uint16Array":return Uint16Array;case"Uint32Array":return Uint32Array;case"Uint8ClampedArray":return Uint8ClampedArray;case"Float32Array":return Float32Array;case"Float64Array":return Float64Array;case"BigInt64Array":return BigInt64Array;case"BigUint64Array":return BigUint64Array;default:throw new dr(e)}}function pe(e,t){switch(t){case 3:return Object.freeze(e);case 1:return Object.preventExtensions(e);case 2:return Object.seal(e);default:return e}}var Sr=class{constructor(e){this.plugins=e.plugins,this.refs=e.refs||new Map}deserializeReference(e){return this.assignIndexedValue(e.i,Pt(g(e.s)))}deserializeArray(e){let t=e.l,r=this.assignIndexedValue(e.i,new Array(t)),s;for(let i=0;i<t;i++)s=e.a[i],s&&(r[i]=this.deserialize(s));return pe(r,e.o),r}deserializeProperties(e,t){let r=e.s;if(r){let s=e.k,i=e.v;for(let a=0,n;a<r;a++)n=s[a],typeof n=="string"?t[g(n)]=this.deserialize(i[a]):t[this.deserialize(n)]=this.deserialize(i[a])}return t}deserializeObject(e){let t=this.assignIndexedValue(e.i,e.t===10?{}:Object.create(null));return this.deserializeProperties(e.p,t),pe(t,e.o),t}deserializeDate(e){return this.assignIndexedValue(e.i,new Date(e.s))}deserializeRegExp(e){return this.assignIndexedValue(e.i,new RegExp(g(e.c),e.m))}deserializeSet(e){let t=this.assignIndexedValue(e.i,new Set),r=e.a;for(let s=0,i=e.l;s<i;s++)t.add(this.deserialize(r[s]));return t}deserializeMap(e){let t=this.assignIndexedValue(e.i,new Map),r=e.e.k,s=e.e.v;for(let i=0,a=e.e.s;i<a;i++)t.set(this.deserialize(r[i]),this.deserialize(s[i]));return t}deserializeArrayBuffer(e){let t=new Uint8Array(e.s);return this.assignIndexedValue(e.i,t.buffer)}deserializeTypedArray(e){let t=zr(e.c),r=this.deserialize(e.f);return this.assignIndexedValue(e.i,new t(r,e.b,e.l))}deserializeDataView(e){let t=this.deserialize(e.f);return this.assignIndexedValue(e.i,new DataView(t,e.b,e.l))}deserializeDictionary(e,t){if(e.p){let r=this.deserializeProperties(e.p,{});Object.assign(t,r)}return t}deserializeAggregateError(e){let t=this.assignIndexedValue(e.i,new AggregateError([],g(e.m)));return this.deserializeDictionary(e,t)}deserializeError(e){let t=Ot[e.s],r=this.assignIndexedValue(e.i,new t(g(e.m)));return this.deserializeDictionary(e,r)}deserializePromise(e){let t=G(),r=this.assignIndexedValue(e.i,t),s=this.deserialize(e.f);return e.s?t.resolve(s):t.reject(s),r.promise}deserializeBoxed(e){return this.assignIndexedValue(e.i,Object(this.deserialize(e.f)))}deserializePlugin(e){let t=this.plugins;if(t){let r=g(e.c);for(let s=0,i=t.length;s<i;s++){let a=t[s];if(a.tag===r)return this.assignIndexedValue(e.i,a.deserialize(e.s,this,{id:e.i}))}}throw new He(e.c)}deserializePromiseConstructor(e){return this.assignIndexedValue(e.i,G()).promise}deserializePromiseResolve(e){let t=this.refs.get(e.i);m(t,new S("Promise")),t.resolve(this.deserialize(e.a[1]))}deserializePromiseReject(e){let t=this.refs.get(e.i);m(t,new S("Promise")),t.reject(this.deserialize(e.a[1]))}deserializeIteratorFactoryInstance(e){this.deserialize(e.a[0]);let t=this.deserialize(e.a[1]);return yr(t)}deserializeAsyncIteratorFactoryInstance(e){this.deserialize(e.a[0]);let t=this.deserialize(e.a[1]);return gr(t)}deserializeStreamConstructor(e){let t=this.assignIndexedValue(e.i,P()),r=e.a.length;if(r)for(let s=0;s<r;s++)this.deserialize(e.a[s]);return t}deserializeStreamNext(e){let t=this.refs.get(e.i);m(t,new S("Stream")),t.next(this.deserialize(e.f))}deserializeStreamThrow(e){let t=this.refs.get(e.i);m(t,new S("Stream")),t.throw(this.deserialize(e.f))}deserializeStreamReturn(e){let t=this.refs.get(e.i);m(t,new S("Stream")),t.return(this.deserialize(e.f))}deserializeIteratorFactory(e){this.deserialize(e.f)}deserializeAsyncIteratorFactory(e){this.deserialize(e.a[1])}deserialize(e){try{switch(e.t){case 2:return Tt[e.s];case 0:return e.s;case 1:return g(e.s);case 3:return BigInt(e.s);case 4:return this.refs.get(e.i);case 18:return this.deserializeReference(e);case 9:return this.deserializeArray(e);case 10:case 11:return this.deserializeObject(e);case 5:return this.deserializeDate(e);case 6:return this.deserializeRegExp(e);case 7:return this.deserializeSet(e);case 8:return this.deserializeMap(e);case 19:return this.deserializeArrayBuffer(e);case 16:case 15:return this.deserializeTypedArray(e);case 20:return this.deserializeDataView(e);case 14:return this.deserializeAggregateError(e);case 13:return this.deserializeError(e);case 12:return this.deserializePromise(e);case 17:return Ft[e.s];case 21:return this.deserializeBoxed(e);case 25:return this.deserializePlugin(e);case 22:return this.deserializePromiseConstructor(e);case 23:return this.deserializePromiseResolve(e);case 24:return this.deserializePromiseReject(e);case 28:return this.deserializeIteratorFactoryInstance(e);case 30:return this.deserializeAsyncIteratorFactoryInstance(e);case 31:return this.deserializeStreamConstructor(e);case 32:return this.deserializeStreamNext(e);case 33:return this.deserializeStreamThrow(e);case 34:return this.deserializeStreamReturn(e);case 27:return this.deserializeIteratorFactory(e);case 29:return this.deserializeAsyncIteratorFactory(e);default:throw new Le(e)}}catch(t){throw new lr(t)}}},wr=class extends Sr{constructor(t){super(t),this.mode="vanilla",this.marked=new Set(t.markedRefs)}assignIndexedValue(t,r){return this.marked.has(t)&&this.refs.set(t,r),r}},xr=/^[$A-Z_][0-9A-Z_$]*$/i;function fe(e){let t=e[0];return(t==="$"||t==="_"||t>="A"&&t<="Z"||t>="a"&&t<="z")&&xr.test(e)}function x(e){switch(e.t){case 0:return e.s+"="+e.v;case 2:return e.s+".set("+e.k+","+e.v+")";case 1:return e.s+".add("+e.v+")";case 3:return e.s+".delete("+e.k+")"}}function Rr(e){let t=[],r=e[0];for(let s=1,i=e.length,a,n=r;s<i;s++)a=e[s],a.t===0&&a.v===n.v?r={t:0,s:a.s,k:void 0,v:x(r)}:a.t===2&&a.s===n.s?r={t:2,s:x(r),k:a.k,v:a.v}:a.t===1&&a.s===n.s?r={t:1,s:x(r),k:void 0,v:a.v}:a.t===3&&a.s===n.s?r={t:3,s:x(r),k:a.k,v:void 0}:(t.push(r),r=a),n=a;return t.push(r),t}function me(e){if(e.length){let t="",r=Rr(e);for(let s=0,i=r.length;s<i;s++)t+=x(r[s])+",";return t}}var Ar="Object.create(null)",Er="new Set",Ir="new Map",Pr="Promise.resolve",kr="Promise.reject",Fr={3:"Object.freeze",2:"Object.seal",1:"Object.preventExtensions",0:void 0},$r=class{constructor(e){this.stack=[],this.flags=[],this.assignments=[],this.plugins=e.plugins,this.features=e.features,this.marked=new Set(e.markedRefs)}createFunction(e,t){return this.features&2?(e.length===1?e[0]:"("+e.join(",")+")")+"=>"+t:"function("+e.join(",")+"){return "+t+"}"}createEffectfulFunction(e,t){return this.features&2?(e.length===1?e[0]:"("+e.join(",")+")")+"=>{"+t+"}":"function("+e.join(",")+"){"+t+"}"}markRef(e){this.marked.add(e)}isMarked(e){return this.marked.has(e)}pushObjectFlag(e,t){e!==0&&(this.markRef(t),this.flags.push({type:e,value:this.getRefParam(t)}))}resolveFlags(){let e="";for(let t=0,r=this.flags,s=r.length;t<s;t++){let i=r[t];e+=Fr[i.type]+"("+i.value+"),"}return e}resolvePatches(){let e=me(this.assignments),t=this.resolveFlags();return e?t?e+t:e:t}createAssignment(e,t){this.assignments.push({t:0,s:e,k:void 0,v:t})}createAddAssignment(e,t){this.assignments.push({t:1,s:this.getRefParam(e),k:void 0,v:t})}createSetAssignment(e,t,r){this.assignments.push({t:2,s:this.getRefParam(e),k:t,v:r})}createDeleteAssignment(e,t){this.assignments.push({t:3,s:this.getRefParam(e),k:t,v:void 0})}createArrayAssign(e,t,r){this.createAssignment(this.getRefParam(e)+"["+t+"]",r)}createObjectAssign(e,t,r){this.createAssignment(this.getRefParam(e)+"."+t,r)}isIndexedValueInStack(e){return e.t===4&&this.stack.includes(e.i)}serializeReference(e){return this.assignIndexedValue(e.i,w+'.get("'+e.s+'")')}serializeArrayItem(e,t,r){return t?this.isIndexedValueInStack(t)?(this.markRef(e),this.createArrayAssign(e,r,this.getRefParam(t.i)),""):this.serialize(t):""}serializeArray(e){let t=e.i;if(e.l){this.stack.push(t);let r=e.a,s=this.serializeArrayItem(t,r[0],0),i=s==="";for(let a=1,n=e.l,o;a<n;a++)o=this.serializeArrayItem(t,r[a],a),s+=","+o,i=o==="";return this.stack.pop(),this.pushObjectFlag(e.o,e.i),this.assignIndexedValue(t,"["+s+(i?",]":"]"))}return this.assignIndexedValue(t,"[]")}serializeProperty(e,t,r){if(typeof t=="string"){let s=Number(t),i=s>=0&&s.toString()===t||fe(t);if(this.isIndexedValueInStack(r)){let a=this.getRefParam(r.i);return this.markRef(e.i),i&&s!==s?this.createObjectAssign(e.i,t,a):this.createArrayAssign(e.i,i?t:'"'+t+'"',a),""}return(i?t:'"'+t+'"')+":"+this.serialize(r)}return"["+this.serialize(t)+"]:"+this.serialize(r)}serializeProperties(e,t){let r=t.s;if(r){let s=t.k,i=t.v;this.stack.push(e.i);let a=this.serializeProperty(e,s[0],i[0]);for(let n=1,o=a;n<r;n++)o=this.serializeProperty(e,s[n],i[n]),a+=(o&&a&&",")+o;return this.stack.pop(),"{"+a+"}"}return"{}"}serializeObject(e){return this.pushObjectFlag(e.o,e.i),this.assignIndexedValue(e.i,this.serializeProperties(e,e.p))}serializeWithObjectAssign(e,t,r){let s=this.serializeProperties(e,t);return s!=="{}"?"Object.assign("+r+","+s+")":r}serializeStringKeyAssignment(e,t,r,s){let i=this.serialize(s),a=Number(r),n=a>=0&&a.toString()===r||fe(r);if(this.isIndexedValueInStack(s))n&&a!==a?this.createObjectAssign(e.i,r,i):this.createArrayAssign(e.i,n?r:'"'+r+'"',i);else{let o=this.assignments;this.assignments=t,n&&a!==a?this.createObjectAssign(e.i,r,i):this.createArrayAssign(e.i,n?r:'"'+r+'"',i),this.assignments=o}}serializeAssignment(e,t,r,s){if(typeof r=="string")this.serializeStringKeyAssignment(e,t,r,s);else{let i=this.stack;this.stack=[];let a=this.serialize(s);this.stack=i;let n=this.assignments;this.assignments=t,this.createArrayAssign(e.i,this.serialize(r),a),this.assignments=n}}serializeAssignments(e,t){let r=t.s;if(r){let s=[],i=t.k,a=t.v;this.stack.push(e.i);for(let n=0;n<r;n++)this.serializeAssignment(e,s,i[n],a[n]);return this.stack.pop(),me(s)}}serializeDictionary(e,t){if(e.p)if(this.features&8)t=this.serializeWithObjectAssign(e,e.p,t);else{this.markRef(e.i);let r=this.serializeAssignments(e,e.p);if(r)return"("+this.assignIndexedValue(e.i,t)+","+r+this.getRefParam(e.i)+")"}return this.assignIndexedValue(e.i,t)}serializeNullConstructor(e){return this.pushObjectFlag(e.o,e.i),this.serializeDictionary(e,Ar)}serializeDate(e){return this.assignIndexedValue(e.i,'new Date("'+e.s+'")')}serializeRegExp(e){return this.assignIndexedValue(e.i,"/"+e.c+"/"+e.m)}serializeSetItem(e,t){return this.isIndexedValueInStack(t)?(this.markRef(e),this.createAddAssignment(e,this.getRefParam(t.i)),""):this.serialize(t)}serializeSet(e){let t=Er,r=e.l,s=e.i;if(r){let i=e.a;this.stack.push(s);let a=this.serializeSetItem(s,i[0]);for(let n=1,o=a;n<r;n++)o=this.serializeSetItem(s,i[n]),a+=(o&&a&&",")+o;this.stack.pop(),a&&(t+="(["+a+"])")}return this.assignIndexedValue(s,t)}serializeMapEntry(e,t,r,s){if(this.isIndexedValueInStack(t)){let i=this.getRefParam(t.i);if(this.markRef(e),this.isIndexedValueInStack(r)){let n=this.getRefParam(r.i);return this.createSetAssignment(e,i,n),""}if(r.t!==4&&r.i!=null&&this.isMarked(r.i)){let n="("+this.serialize(r)+",["+s+","+s+"])";return this.createSetAssignment(e,i,this.getRefParam(r.i)),this.createDeleteAssignment(e,s),n}let a=this.stack;return this.stack=[],this.createSetAssignment(e,i,this.serialize(r)),this.stack=a,""}if(this.isIndexedValueInStack(r)){let i=this.getRefParam(r.i);if(this.markRef(e),t.t!==4&&t.i!=null&&this.isMarked(t.i)){let n="("+this.serialize(t)+",["+s+","+s+"])";return this.createSetAssignment(e,this.getRefParam(t.i),i),this.createDeleteAssignment(e,s),n}let a=this.stack;return this.stack=[],this.createSetAssignment(e,this.serialize(t),i),this.stack=a,""}return"["+this.serialize(t)+","+this.serialize(r)+"]"}serializeMap(e){let t=Ir,r=e.e.s,s=e.i,i=e.f,a=this.getRefParam(i.i);if(r){let n=e.e.k,o=e.e.v;this.stack.push(s);let l=this.serializeMapEntry(s,n[0],o[0],a);for(let c=1,d=l;c<r;c++)d=this.serializeMapEntry(s,n[c],o[c],a),l+=(d&&l&&",")+d;this.stack.pop(),l&&(t+="(["+l+"])")}return i.t===26&&(this.markRef(i.i),t="("+this.serialize(i)+","+t+")"),this.assignIndexedValue(s,t)}serializeArrayBuffer(e){let t="new Uint8Array(",r=e.s,s=r.length;if(s){t+="["+r[0];for(let i=1;i<s;i++)t+=","+r[i];t+="]"}return this.assignIndexedValue(e.i,t+").buffer")}serializeTypedArray(e){return this.assignIndexedValue(e.i,"new "+e.c+"("+this.serialize(e.f)+","+e.b+","+e.l+")")}serializeDataView(e){return this.assignIndexedValue(e.i,"new DataView("+this.serialize(e.f)+","+e.b+","+e.l+")")}serializeAggregateError(e){let t=e.i;this.stack.push(t);let r=this.serializeDictionary(e,'new AggregateError([],"'+e.m+'")');return this.stack.pop(),r}serializeError(e){return this.serializeDictionary(e,"new "+Ne[e.s]+'("'+e.m+'")')}serializePromise(e){let t,r=e.f,s=e.i,i=e.s?Pr:kr;if(this.isIndexedValueInStack(r)){let a=this.getRefParam(r.i);t=i+(e.s?"().then("+this.createFunction([],a)+")":"().catch("+this.createEffectfulFunction([],"throw "+a)+")")}else{this.stack.push(s);let a=this.serialize(r);this.stack.pop(),t=i+"("+a+")"}return this.assignIndexedValue(s,t)}serializeWellKnownSymbol(e){return this.assignIndexedValue(e.i,kt[e.s])}serializeBoxed(e){return this.assignIndexedValue(e.i,"Object("+this.serialize(e.f)+")")}serializePlugin(e){let t=this.plugins;if(t)for(let r=0,s=t.length;r<s;r++){let i=t[r];if(i.tag===e.c)return this.assignIndexedValue(e.i,i.serialize(e.s,this,{id:e.i}))}throw new He(e.c)}getConstructor(e){let t=this.serialize(e);return t===this.getRefParam(e.i)?t:"("+t+")"}serializePromiseConstructor(e){return this.assignIndexedValue(e.i,this.getConstructor(e.f)+"()")}serializePromiseResolve(e){return this.getConstructor(e.a[0])+"("+this.getRefParam(e.i)+","+this.serialize(e.a[1])+")"}serializePromiseReject(e){return this.getConstructor(e.a[0])+"("+this.getRefParam(e.i)+","+this.serialize(e.a[1])+")"}serializeSpecialReferenceValue(e){switch(e){case 0:return"[]";case 1:return this.createFunction(["s","f","p"],"((p=new Promise("+this.createEffectfulFunction(["a","b"],"s=a,f=b")+")).s=s,p.f=f,p)");case 2:return this.createEffectfulFunction(["p","d"],'p.s(d),p.status="success",p.value=d;delete p.s;delete p.f');case 3:return this.createEffectfulFunction(["p","d"],'p.f(d),p.status="failure",p.value=d;delete p.s;delete p.f');case 4:return this.createFunction(["b","a","s","l","p","f","e","n"],"(b=[],a=!0,s=!1,l=[],p=0,f="+this.createEffectfulFunction(["v","m","x"],"for(x=0;x<p;x++)l[x]&&l[x][m](v)")+",n="+this.createEffectfulFunction(["o","x","z","c"],'for(x=0,z=b.length;x<z;x++)(c=b[x],(!a&&x===z-1)?o[s?"return":"throw"](c):o.next(c))')+",e="+this.createFunction(["o","t"],"(a&&(l[t=p++]=o),n(o),"+this.createEffectfulFunction([],"a&&(l[t]=void 0)")+")")+",{__SEROVAL_STREAM__:!0,on:"+this.createFunction(["o"],"e(o)")+",next:"+this.createEffectfulFunction(["v"],'a&&(b.push(v),f(v,"next"))')+",throw:"+this.createEffectfulFunction(["v"],'a&&(b.push(v),f(v,"throw"),a=s=!1,l.length=0)')+",return:"+this.createEffectfulFunction(["v"],'a&&(b.push(v),f(v,"return"),a=!1,s=!0,l.length=0)')+"})");default:return""}}serializeSpecialReference(e){return this.assignIndexedValue(e.i,this.serializeSpecialReferenceValue(e.s))}serializeIteratorFactory(e){let t="",r=!1;return e.f.t!==4&&(this.markRef(e.f.i),t="("+this.serialize(e.f)+",",r=!0),t+=this.assignIndexedValue(e.i,this.createFunction(["s"],this.createFunction(["i","c","d","t"],"(i=0,t={["+this.getRefParam(e.f.i)+"]:"+this.createFunction([],"t")+",next:"+this.createEffectfulFunction([],"if(i>s.d)return{done:!0,value:void 0};if(d=s.v[c=i++],c===s.t)throw d;return{done:c===s.d,value:d}")+"})"))),r&&(t+=")"),t}serializeIteratorFactoryInstance(e){return this.getConstructor(e.a[0])+"("+this.serialize(e.a[1])+")"}serializeAsyncIteratorFactory(e){let t=e.a[0],r=e.a[1],s="";t.t!==4&&(this.markRef(t.i),s+="("+this.serialize(t)),r.t!==4&&(this.markRef(r.i),s+=(s?",":"(")+this.serialize(r)),s&&(s+=",");let i=this.assignIndexedValue(e.i,this.createFunction(["s"],this.createFunction(["b","c","p","d","e","t","f"],"(b=[],c=0,p=[],d=-1,e=!1,f="+this.createEffectfulFunction(["i","l"],"for(i=0,l=p.length;i<l;i++)p[i].s({done:!0,value:void 0})")+",s.on({next:"+this.createEffectfulFunction(["v","t"],"if(t=p.shift())t.s({done:!1,value:v});b.push(v)")+",throw:"+this.createEffectfulFunction(["v","t"],"if(t=p.shift())t.f(v);f(),d=b.length,e=!0,b.push(v)")+",return:"+this.createEffectfulFunction(["v","t"],"if(t=p.shift())t.s({done:!0,value:v});f(),d=b.length,b.push(v)")+"}),t={["+this.getRefParam(r.i)+"]:"+this.createFunction([],"t")+",next:"+this.createEffectfulFunction(["i","t","v"],"if(d===-1){return((i=c++)>=b.length)?(p.push(t="+this.getRefParam(t.i)+"()),t):{done:!1,value:b[i]}}if(c>d)return{done:!0,value:void 0};if(v=b[i=c++],i!==d)return{done:!1,value:v};if(e)throw v;return{done:!0,value:v}")+"})")));return s?s+i+")":i}serializeAsyncIteratorFactoryInstance(e){return this.getConstructor(e.a[0])+"("+this.serialize(e.a[1])+")"}serializeStreamConstructor(e){let t=this.assignIndexedValue(e.i,this.getConstructor(e.f)+"()"),r=e.a.length;if(r){let s=this.serialize(e.a[0]);for(let i=1;i<r;i++)s+=","+this.serialize(e.a[i]);return"("+t+","+s+","+this.getRefParam(e.i)+")"}return t}serializeStreamNext(e){return this.getRefParam(e.i)+".next("+this.serialize(e.f)+")"}serializeStreamThrow(e){return this.getRefParam(e.i)+".throw("+this.serialize(e.f)+")"}serializeStreamReturn(e){return this.getRefParam(e.i)+".return("+this.serialize(e.f)+")"}serialize(e){try{switch(e.t){case 2:return $t[e.s];case 0:return""+e.s;case 1:return'"'+e.s+'"';case 3:return e.s+"n";case 4:return this.getRefParam(e.i);case 18:return this.serializeReference(e);case 9:return this.serializeArray(e);case 10:return this.serializeObject(e);case 11:return this.serializeNullConstructor(e);case 5:return this.serializeDate(e);case 6:return this.serializeRegExp(e);case 7:return this.serializeSet(e);case 8:return this.serializeMap(e);case 19:return this.serializeArrayBuffer(e);case 16:case 15:return this.serializeTypedArray(e);case 20:return this.serializeDataView(e);case 14:return this.serializeAggregateError(e);case 13:return this.serializeError(e);case 12:return this.serializePromise(e);case 17:return this.serializeWellKnownSymbol(e);case 21:return this.serializeBoxed(e);case 22:return this.serializePromiseConstructor(e);case 23:return this.serializePromiseResolve(e);case 24:return this.serializePromiseReject(e);case 25:return this.serializePlugin(e);case 26:return this.serializeSpecialReference(e);case 27:return this.serializeIteratorFactory(e);case 28:return this.serializeIteratorFactoryInstance(e);case 29:return this.serializeAsyncIteratorFactory(e);case 30:return this.serializeAsyncIteratorFactoryInstance(e);case 31:return this.serializeStreamConstructor(e);case 32:return this.serializeStreamNext(e);case 33:return this.serializeStreamThrow(e);case 34:return this.serializeStreamReturn(e);default:throw new Le(e)}}catch(t){throw new or(t)}}},Tr=class extends br{parseItems(t){let r=[];for(let s=0,i=t.length;s<i;s++)s in t&&(r[s]=this.parse(t[s]));return r}parseArray(t,r){return Xt(t,r,this.parseItems(r))}parseProperties(t){let r=Object.entries(t),s=[],i=[];for(let n=0,o=r.length;n<o;n++)s.push(f(r[n][0])),i.push(this.parse(r[n][1]));let a=Symbol.iterator;return a in t&&(s.push(this.parseWellKnownSymbol(a)),i.push(_e(this.parseIteratorFactory(),this.parse(We(t))))),a=Symbol.asyncIterator,a in t&&(s.push(this.parseWellKnownSymbol(a)),i.push(Me(this.parseAsyncIteratorFactory(),this.parse(P())))),a=Symbol.toStringTag,a in t&&(s.push(this.parseWellKnownSymbol(a)),i.push(X(t[a]))),a=Symbol.isConcatSpreadable,a in t&&(s.push(this.parseWellKnownSymbol(a)),i.push(t[a]?B:K)),{k:s,v:i,s:s.length}}parsePlainObject(t,r,s){return this.createObjectNode(t,r,s,this.parseProperties(r))}parseBoxed(t,r){return Gt(t,this.parse(r.valueOf()))}parseTypedArray(t,r){return Jt(t,r,this.parse(r.buffer))}parseBigIntTypedArray(t,r){return Yt(t,r,this.parse(r.buffer))}parseDataView(t,r){return Zt(t,r,this.parse(r.buffer))}parseError(t,r){let s=de(r,this.features);return Qt(t,r,s?this.parseProperties(s):void 0)}parseAggregateError(t,r){let s=de(r,this.features);return er(t,r,s?this.parseProperties(s):void 0)}parseMap(t,r){let s=[],i=[];for(let[a,n]of r.entries())s.push(this.parse(a)),i.push(this.parse(n));return this.createMapNode(t,s,i,r.size)}parseSet(t,r){let s=[];for(let i of r.keys())s.push(this.parse(i));return tr(t,r.size,s)}parsePlugin(t,r){let s=this.plugins;if(s)for(let i=0,a=s.length;i<a;i++){let n=s[i];if(n.parse.sync&&n.test(r))return Ue(t,n.tag,n.parse.sync(r,this,{id:t}))}}parseStream(t,r){return qe(t,this.parseSpecialReference(4),[])}parsePromise(t,r){return this.createPromiseConstructorNode(t)}parseObject(t,r){if(Array.isArray(r))return this.parseArray(t,r);if(mr(r))return this.parseStream(t,r);let s=this.parsePlugin(t,r);if(s)return s;let i=r.constructor;switch(i){case Object:return this.parsePlainObject(t,r,!1);case void 0:return this.parsePlainObject(t,r,!0);case Date:return Ht(t,r);case RegExp:return Wt(t,r);case Error:case EvalError:case RangeError:case ReferenceError:case SyntaxError:case TypeError:case URIError:return this.parseError(t,r);case Number:case Boolean:case String:case BigInt:return this.parseBoxed(t,r);case ArrayBuffer:return Bt(t,r);case Int8Array:case Int16Array:case Int32Array:case Uint8Array:case Uint16Array:case Uint32Array:case Uint8ClampedArray:case Float32Array:case Float64Array:return this.parseTypedArray(t,r);case DataView:return this.parseDataView(t,r);case Map:return this.parseMap(t,r);case Set:return this.parseSet(t,r)}if(i===Promise||r instanceof Promise)return this.parsePromise(t,r);let a=this.features;if(a&16)switch(i){case BigInt64Array:case BigUint64Array:return this.parseBigIntTypedArray(t,r)}if(a&1&&typeof AggregateError<"u"&&(i===AggregateError||r instanceof AggregateError))return this.parseAggregateError(t,r);if(r instanceof Error)return this.parseError(t,r);if(Symbol.iterator in r||Symbol.asyncIterator in r)return this.parsePlainObject(t,r,!!i);throw new j(r)}parse(t){try{switch(typeof t){case"boolean":return t?B:K;case"undefined":return jt;case"string":return X(t);case"number":return Mt(t);case"bigint":return qt(t);case"object":{if(t){let r=this.getReference(t);return r.type===0?this.parseObject(r.value,t):r.value}return Ct}case"symbol":return this.parseWellKnownSymbol(t);case"function":return this.parseFunction(t);default:throw new j(t)}}catch(r){throw new nr(r)}}};function ve(e,t={}){let r=Ce(t.plugins);return new wr({plugins:r,markedRefs:e.m}).deserialize(e.t)}var Or=class extends $r{constructor(t){super(t),this.mode="cross",this.scopeId=t.scopeId}getRefParam(t){return O+"["+t+"]"}assignIndexedValue(t,r){return this.getRefParam(t)+"="+r}serializeTop(t){let r=this.serialize(t),s=t.i;if(s==null)return r;let i=this.resolvePatches(),a=this.getRefParam(s),n=this.scopeId==null?"":O,o=i?r+","+i+a:r;if(n==="")return i?"("+o+")":o;let l=this.scopeId==null?"()":"("+O+'["'+f(this.scopeId)+'"])';return"("+this.createFunction([n],o)+")"+l}},jr=class extends Tr{constructor(t){super(t),this.alive=!0,this.pending=0,this.initial=!0,this.buffer=[],this.onParseCallback=t.onParse,this.onErrorCallback=t.onError,this.onDoneCallback=t.onDone}onParseInternal(t,r){try{this.onParseCallback(t,r)}catch(s){this.onError(s)}}flush(){for(let t=0,r=this.buffer.length;t<r;t++)this.onParseInternal(this.buffer[t],!1)}onParse(t){this.initial?this.buffer.push(t):this.onParseInternal(t,!1)}onError(t){if(this.onErrorCallback)this.onErrorCallback(t);else throw t}onDone(){this.onDoneCallback&&this.onDoneCallback()}pushPendingState(){this.pending++}popPendingState(){--this.pending<=0&&this.onDone()}parseProperties(t){let r=Object.entries(t),s=[],i=[];for(let n=0,o=r.length;n<o;n++)s.push(f(r[n][0])),i.push(this.parse(r[n][1]));let a=Symbol.iterator;return a in t&&(s.push(this.parseWellKnownSymbol(a)),i.push(_e(this.parseIteratorFactory(),this.parse(We(t))))),a=Symbol.asyncIterator,a in t&&(s.push(this.parseWellKnownSymbol(a)),i.push(Me(this.parseAsyncIteratorFactory(),this.parse(vr(t))))),a=Symbol.toStringTag,a in t&&(s.push(this.parseWellKnownSymbol(a)),i.push(X(t[a]))),a=Symbol.isConcatSpreadable,a in t&&(s.push(this.parseWellKnownSymbol(a)),i.push(t[a]?B:K)),{k:s,v:i,s:s.length}}parsePromise(t,r){return r.then(s=>{let i=this.parseWithError(s);i&&this.onParse({t:23,i:t,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[this.parseSpecialReference(2),i],f:void 0,b:void 0,o:void 0}),this.popPendingState()},s=>{if(this.alive){let i=this.parseWithError(s);i&&this.onParse({t:24,i:t,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[this.parseSpecialReference(3),i],f:void 0,b:void 0,o:void 0})}this.popPendingState()}),this.pushPendingState(),this.createPromiseConstructorNode(t)}parsePlugin(t,r){let s=this.plugins;if(s)for(let i=0,a=s.length;i<a;i++){let n=s[i];if(n.parse.stream&&n.test(r))return Ue(t,n.tag,n.parse.stream(r,this,{id:t}))}}parseStream(t,r){let s=qe(t,this.parseSpecialReference(4),[]);return this.pushPendingState(),r.on({next:i=>{if(this.alive){let a=this.parseWithError(i);a&&this.onParse(rr(t,a))}},throw:i=>{if(this.alive){let a=this.parseWithError(i);a&&this.onParse(sr(t,a))}this.popPendingState()},return:i=>{if(this.alive){let a=this.parseWithError(i);a&&this.onParse(ir(t,a))}this.popPendingState()}}),s}parseWithError(t){try{return this.parse(t)}catch(r){this.onError(r);return}}start(t){let r=this.parseWithError(t);r&&(this.onParseInternal(r,!0),this.initial=!1,this.flush(),this.pending<=0&&this.destroy())}destroy(){this.alive&&(this.onDone(),this.alive=!1)}isAlive(){return this.alive}},Cr=class extends jr{constructor(){super(...arguments),this.mode="cross"}};function Vr(e,t){let r=Ce(t.plugins),s=new Cr({plugins:r,refs:t.refs,disabledFeatures:t.disabledFeatures,onParse(i,a){let n=new Or({plugins:r,features:s.features,scopeId:t.scopeId,markedRefs:s.marked}),o;try{o=n.serializeTop(i)}catch(l){t.onError&&t.onError(l);return}t.onSerialize(o,a)},onError:t.onError,onDone:t.onDone});return s.start(e),()=>{s.destroy()}}function N(e){return{detail:e.detail,bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}}var Nr={tag:"seroval-plugins/web/CustomEvent",test(e){return typeof CustomEvent>"u"?!1:e instanceof CustomEvent},parse:{sync(e,t){return{type:t.parse(e.type),options:t.parse(N(e))}},async async(e,t){return{type:await t.parse(e.type),options:await t.parse(N(e))}},stream(e,t){return{type:t.parse(e.type),options:t.parse(N(e))}}},serialize(e,t){return"new CustomEvent("+t.serialize(e.type)+","+t.serialize(e.options)+")"},deserialize(e,t){return new CustomEvent(t.deserialize(e.type),t.deserialize(e.options))}},J=Nr,Dr={tag:"seroval-plugins/web/DOMException",test(e){return typeof DOMException>"u"?!1:e instanceof DOMException},parse:{sync(e,t){return{name:t.parse(e.name),message:t.parse(e.message)}},async async(e,t){return{name:await t.parse(e.name),message:await t.parse(e.message)}},stream(e,t){return{name:t.parse(e.name),message:t.parse(e.message)}}},serialize(e,t){return"new DOMException("+t.serialize(e.message)+","+t.serialize(e.name)+")"},deserialize(e,t){return new DOMException(t.deserialize(e.message),t.deserialize(e.name))}},Y=Dr;function D(e){return{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}}var Ur={tag:"seroval-plugins/web/Event",test(e){return typeof Event>"u"?!1:e instanceof Event},parse:{sync(e,t){return{type:t.parse(e.type),options:t.parse(D(e))}},async async(e,t){return{type:await t.parse(e.type),options:await t.parse(D(e))}},stream(e,t){return{type:t.parse(e.type),options:t.parse(D(e))}}},serialize(e,t){return"new Event("+t.serialize(e.type)+","+t.serialize(e.options)+")"},deserialize(e,t){return new Event(t.deserialize(e.type),t.deserialize(e.options))}},Z=Ur,_r={tag:"seroval-plugins/web/File",test(e){return typeof File>"u"?!1:e instanceof File},parse:{async async(e,t){return{name:await t.parse(e.name),options:await t.parse({type:e.type,lastModified:e.lastModified}),buffer:await t.parse(await e.arrayBuffer())}}},serialize(e,t){return"new File(["+t.serialize(e.buffer)+"],"+t.serialize(e.name)+","+t.serialize(e.options)+")"},deserialize(e,t){return new File([t.deserialize(e.buffer)],t.deserialize(e.name),t.deserialize(e.options))}},Mr=_r;function U(e){let t=[];return e.forEach((r,s)=>{t.push([s,r])}),t}var R={},qr={tag:"seroval-plugins/web/FormDataFactory",test(e){return e===R},parse:{sync(){},async async(){return await Promise.resolve(void 0)},stream(){}},serialize(e,t){return t.createEffectfulFunction(["e","f","i","s","t"],"f=new FormData;for(i=0,s=e.length;i<s;i++)f.append((t=e[i])[0],t[1]);return f")},deserialize(){return R}},Lr={tag:"seroval-plugins/web/FormData",extends:[Mr,qr],test(e){return typeof FormData>"u"?!1:e instanceof FormData},parse:{sync(e,t){return{factory:t.parse(R),entries:t.parse(U(e))}},async async(e,t){return{factory:await t.parse(R),entries:await t.parse(U(e))}},stream(e,t){return{factory:t.parse(R),entries:t.parse(U(e))}}},serialize(e,t){return"("+t.serialize(e.factory)+")("+t.serialize(e.entries)+")"},deserialize(e,t){let r=new FormData,s=t.deserialize(e.entries);for(let i=0,a=s.length;i<a;i++){let n=s[i];r.append(n[0],n[1])}return r}},Q=Lr;function _(e){let t=[];return e.forEach((r,s)=>{t.push([s,r])}),t}var Hr={tag:"seroval-plugins/web/Headers",test(e){return typeof Headers>"u"?!1:e instanceof Headers},parse:{sync(e,t){return t.parse(_(e))},async async(e,t){return await t.parse(_(e))},stream(e,t){return t.parse(_(e))}},serialize(e,t){return"new Headers("+t.serialize(e)+")"},deserialize(e,t){return new Headers(t.deserialize(e))}},E=Hr,A={},Wr={tag:"seroval-plugins/web/ReadableStreamFactory",test(e){return e===A},parse:{sync(){},async async(){return await Promise.resolve(void 0)},stream(){}},serialize(e,t){return t.createFunction(["d"],"new ReadableStream({start:"+t.createEffectfulFunction(["c"],"d.on({next:"+t.createEffectfulFunction(["v"],"c.enqueue(v)")+",throw:"+t.createEffectfulFunction(["v"],"c.error(v)")+",return:"+t.createEffectfulFunction([],"c.close()")+"})")+"})")},deserialize(){return A}};function ge(e){let t=P(),r=e.getReader();async function s(){try{let i=await r.read();i.done?t.return(i.value):(t.next(i.value),await s())}catch(i){t.throw(i)}}return s().catch(()=>{}),t}var Br={tag:"seroval/plugins/web/ReadableStream",extends:[Wr],test(e){return typeof ReadableStream>"u"?!1:e instanceof ReadableStream},parse:{sync(e,t){return{factory:t.parse(A),stream:t.parse(P())}},async async(e,t){return{factory:await t.parse(A),stream:await t.parse(ge(e))}},stream(e,t){return{factory:t.parse(A),stream:t.parse(ge(e))}}},serialize(e,t){return"("+t.serialize(e.factory)+")("+t.serialize(e.stream)+")"},deserialize(e,t){let r=t.deserialize(e.stream);return new ReadableStream({start(s){r.on({next(i){s.enqueue(i)},throw(i){s.error(i)},return(){s.close()}})}})}},I=Br;function ye(e,t){return{body:t,cache:e.cache,credentials:e.credentials,headers:e.headers,integrity:e.integrity,keepalive:e.keepalive,method:e.method,mode:e.mode,redirect:e.redirect,referrer:e.referrer,referrerPolicy:e.referrerPolicy}}var Kr={tag:"seroval-plugins/web/Request",extends:[I,E],test(e){return typeof Request>"u"?!1:e instanceof Request},parse:{async async(e,t){return{url:await t.parse(e.url),options:await t.parse(ye(e,e.body?await e.clone().arrayBuffer():null))}},stream(e,t){return{url:t.parse(e.url),options:t.parse(ye(e,e.clone().body))}}},serialize(e,t){return"new Request("+t.serialize(e.url)+","+t.serialize(e.options)+")"},deserialize(e,t){return new Request(t.deserialize(e.url),t.deserialize(e.options))}},ee=Kr;function be(e){return{headers:e.headers,status:e.status,statusText:e.statusText}}var Xr={tag:"seroval-plugins/web/Response",extends:[I,E],test(e){return typeof Response>"u"?!1:e instanceof Response},parse:{async async(e,t){return{body:await t.parse(e.body?await e.clone().arrayBuffer():null),options:await t.parse(be(e))}},stream(e,t){return{body:t.parse(e.clone().body),options:t.parse(be(e))}}},serialize(e,t){return"new Response("+t.serialize(e.body)+","+t.serialize(e.options)+")"},deserialize(e,t){return new Response(t.deserialize(e.body),t.deserialize(e.options))}},te=Xr,Gr={tag:"seroval-plugins/web/URLSearchParams",test(e){return typeof URLSearchParams>"u"?!1:e instanceof URLSearchParams},parse:{sync(e,t){return t.parse(e.toString())},async async(e,t){return await t.parse(e.toString())},stream(e,t){return t.parse(e.toString())}},serialize(e,t){return"new URLSearchParams("+t.serialize(e)+")"},deserialize(e,t){return new URLSearchParams(t.deserialize(e))}},re=Gr,Jr={tag:"seroval-plugins/web/URL",test(e){return typeof URL>"u"?!1:e instanceof URL},parse:{sync(e,t){return t.parse(e.href)},async async(e,t){return await t.parse(e.href)},stream(e,t){return t.parse(e.href)}},serialize(e,t){return"new URL("+t.serialize(e)+")"},deserialize(e,t){return new URL(t.deserialize(e))}},se=Jr;function Yr(e={}){let t,r=!1;const s=n=>{if(t&&t!==n)throw new Error("Context conflict")};let i;if(e.asyncContext){const n=e.AsyncLocalStorage||globalThis.AsyncLocalStorage;n?i=new n:console.warn("[unctx] `AsyncLocalStorage` is not provided.")}const a=()=>{if(i&&t===void 0){const n=i.getStore();if(n!==void 0)return n}return t};return{use:()=>{const n=a();if(n===void 0)throw new Error("Context is not available");return n},tryUse:()=>a(),set:(n,o)=>{o||s(n),t=n,r=!0},unset:()=>{t=void 0,r=!1},call:(n,o)=>{s(n),t=n;try{return i?i.run(n,o):o()}finally{r||(t=void 0)}},async callAsync(n,o){t=n;const l=()=>{t=n},c=()=>t===n?l:void 0;we.add(c);try{const d=i?i.run(n,o):o();return r||(t=void 0),await d}finally{we.delete(c)}}}}function Zr(e={}){const t={};return{get(r,s={}){return t[r]||(t[r]=Yr({...e,...s})),t[r],t[r]}}}const C=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:typeof window<"u"?window:{},ze="__unctx__",Qr=C[ze]||(C[ze]=Zr()),es=(e,t={})=>Qr.get(e,t),Se="__unctx_async_handlers__",we=C[Se]||(C[Se]=new Set);function ts(e){let t;const r=Ke(e),s={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(r,{...s,body:e.node.req.body}):new Request(r,{...s,get body(){return t||(t=us(e),t)}})}function rs(e){return e.web??={request:ts(e),url:Ke(e)},e.web.request}function ss(){return fs()}const Be=Symbol("$HTTPEvent");function is(e){return typeof e=="object"&&(e instanceof H||e?.[Be]instanceof H||e?.__is_event__===!0)}function h(e){return function(...t){let r=t[0];if(is(r))t[0]=r instanceof H||r.__is_event__?r:r[Be];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(r=ss(),!r)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(r)}return e(...t)}}const Ke=h(gt),as=h(lt),V=h(bt),xe=h(ct),ns=h(ut),$=h(vt),Re=h(pt),os=h(ft),Xe=h(ot),ls=h(dt),cs=h(ht),T=h(nt),us=h(yt),ds=h(mt),hs=h(rs);function ps(){return es("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:St})}function fs(){return ps().use().event}const M="Invariant Violation",{setPrototypeOf:ms=function(e,t){return e.__proto__=t,e}}=Object;class oe extends Error{framesToPop=1;name=M;constructor(t=M){super(typeof t=="number"?`${M}: ${t} (see https://github.com/apollographql/invariant-packages)`:t),ms(this,oe.prototype)}}function vs(e,t){if(!e)throw new oe(t)}const q="solidFetchEvent";function gs(e){return{request:hs(e),response:Ss(e),clientAddress:as(e),locals:{},nativeEvent:e}}function ys(e){return{...e}}function bs(e){if(!e.context[q]){const t=gs(e);e.context[q]=t}return e.context[q]}function Ae(e,t){for(const[r,s]of t.entries())Xe(e,r,s)}class zs{event;constructor(t){this.event=t}get(t){const r=Re(this.event,t);return Array.isArray(r)?r.join(", "):r||null}has(t){return this.get(t)!==void 0}set(t,r){return os(this.event,t,r)}delete(t){return ds(this.event,t)}append(t,r){Xe(this.event,t,r)}getSetCookie(){const t=Re(this.event,"Set-Cookie");return Array.isArray(t)?t:[t]}forEach(t){return Object.entries($(this.event)).forEach(([r,s])=>t(Array.isArray(s)?s.join(", "):s,r,this))}entries(){return Object.entries($(this.event)).map(([t,r])=>[t,Array.isArray(r)?r.join(", "):r])[Symbol.iterator]()}keys(){return Object.keys($(this.event))[Symbol.iterator]()}values(){return Object.values($(this.event)).map(t=>Array.isArray(t)?t.join(", "):t)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function Ss(e){return{get status(){return xe(e)},set status(t){V(e,t)},get statusText(){return ns(e)},set statusText(t){V(e,xe(e),t)},headers:new zs(e)}}const z={NORMAL:0,WILDCARD:1,PLACEHOLDER:2};function ws(e={}){const t={options:e,rootNode:Ge(),staticRoutesMap:{}},r=s=>e.strictTrailingSlash?s:s.replace(/\/$/,"")||"/";if(e.routes)for(const s in e.routes)Ee(t,r(s),e.routes[s]);return{ctx:t,lookup:s=>xs(t,r(s)),insert:(s,i)=>Ee(t,r(s),i),remove:s=>Rs(t,r(s))}}function xs(e,t){const r=e.staticRoutesMap[t];if(r)return r.data;const s=t.split("/"),i={};let a=!1,n=null,o=e.rootNode,l=null;for(let c=0;c<s.length;c++){const d=s[c];o.wildcardChildNode!==null&&(n=o.wildcardChildNode,l=s.slice(c).join("/"));const u=o.children.get(d);if(u===void 0){if(o&&o.placeholderChildren.length>1){const p=s.length-c;o=o.placeholderChildren.find(y=>y.maxDepth===p)||null}else o=o.placeholderChildren[0]||null;if(!o)break;o.paramName&&(i[o.paramName]=d),a=!0}else o=u}return(o===null||o.data===null)&&n!==null&&(o=n,i[o.paramName||"_"]=l,a=!0),o?a?{...o.data,params:a?i:void 0}:o.data:null}function Ee(e,t,r){let s=!0;const i=t.split("/");let a=e.rootNode,n=0;const o=[a];for(const l of i){let c;if(c=a.children.get(l))a=c;else{const d=As(l);c=Ge({type:d,parent:a}),a.children.set(l,c),d===z.PLACEHOLDER?(c.paramName=l==="*"?`_${n++}`:l.slice(1),a.placeholderChildren.push(c),s=!1):d===z.WILDCARD&&(a.wildcardChildNode=c,c.paramName=l.slice(3)||"_",s=!1),o.push(c),a=c}}for(const[l,c]of o.entries())c.maxDepth=Math.max(o.length-l,c.maxDepth||0);return a.data=r,s===!0&&(e.staticRoutesMap[t]=a),a}function Rs(e,t){let r=!1;const s=t.split("/");let i=e.rootNode;for(const a of s)if(i=i.children.get(a),!i)return r;if(i.data){const a=s.at(-1)||"";i.data=null,Object.keys(i.children).length===0&&i.parent&&(i.parent.children.delete(a),i.parent.wildcardChildNode=null,i.parent.placeholderChildren=[]),r=!0}return r}function Ge(e={}){return{type:e.type||z.NORMAL,maxDepth:0,parent:e.parent||null,children:new Map,data:e.data||null,paramName:e.paramName||null,wildcardChildNode:null,placeholderChildren:[]}}function As(e){return e.startsWith("**")?z.WILDCARD:e[0]===":"||e==="*"?z.PLACEHOLDER:z.NORMAL}const Je=[{page:!0,$component:{src:"src/routes/index.tsx?pick=default&pick=$css",build:()=>import("./index.mjs"),import:()=>import("./index.mjs")},path:"/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/index.tsx"},{page:!0,$component:{src:"src/routes/completion/index.tsx?pick=default&pick=$css",build:()=>import("./index2.mjs"),import:()=>import("./index2.mjs")},path:"/completion/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/completion/index.tsx"},{page:!0,$component:{src:"src/routes/use-chat-attachments/index.tsx?pick=default&pick=$css",build:()=>import("./index3.mjs"),import:()=>import("./index3.mjs")},path:"/use-chat-attachments/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/use-chat-attachments/index.tsx"},{page:!0,$component:{src:"src/routes/use-chat-request/index.tsx?pick=default&pick=$css",build:()=>import("./index4.mjs"),import:()=>import("./index4.mjs")},path:"/use-chat-request/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/use-chat-request/index.tsx"},{page:!0,$component:{src:"src/routes/use-chat-streamdata/index.tsx?pick=default&pick=$css",build:()=>import("./index5.mjs"),import:()=>import("./index5.mjs")},path:"/use-chat-streamdata/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/use-chat-streamdata/index.tsx"},{page:!0,$component:{src:"src/routes/use-chat-tools/index.tsx?pick=default&pick=$css",build:()=>import("./index6.mjs"),import:()=>import("./index6.mjs")},path:"/use-chat-tools/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/use-chat-tools/index.tsx"},{page:!0,$component:{src:"src/routes/use-chat-vision/index.tsx?pick=default&pick=$css",build:()=>import("./index7.mjs"),import:()=>import("./index7.mjs")},path:"/use-chat-vision/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/use-chat-vision/index.tsx"},{page:!0,$component:{src:"src/routes/use-object/index.tsx?pick=default&pick=$css",build:()=>import("./index8.mjs"),import:()=>import("./index8.mjs")},path:"/use-object/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/use-object/index.tsx"},{page:!1,$POST:{src:"src/routes/api/chat/index.ts?pick=POST",build:()=>import("./index9.mjs"),import:()=>import("./index9.mjs")},path:"/api/chat/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/api/chat/index.ts"},{page:!1,$POST:{src:"src/routes/api/completion/index.ts?pick=POST",build:()=>import("./index10.mjs"),import:()=>import("./index10.mjs")},path:"/api/completion/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/api/completion/index.ts"},{page:!1,$POST:{src:"src/routes/api/use-chat-request/index.ts?pick=POST",build:()=>import("./index11.mjs"),import:()=>import("./index11.mjs")},path:"/api/use-chat-request/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/api/use-chat-request/index.ts"},{page:!1,$POST:{src:"src/routes/api/use-chat-streamdata/index.ts?pick=POST",build:()=>import("./index12.mjs"),import:()=>import("./index12.mjs")},path:"/api/use-chat-streamdata/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/api/use-chat-streamdata/index.ts"},{page:!1,$POST:{src:"src/routes/api/use-chat-tools/index.ts?pick=POST",build:()=>import("./index13.mjs"),import:()=>import("./index13.mjs")},path:"/api/use-chat-tools/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/api/use-chat-tools/index.ts"},{page:!1,$POST:{src:"src/routes/api/use-chat-vision/index.ts?pick=POST",build:()=>import("./index14.mjs"),import:()=>import("./index14.mjs")},path:"/api/use-chat-vision/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/api/use-chat-vision/index.ts"},{page:!1,$POST:{src:"src/routes/api/use-object/index.ts?pick=POST",build:()=>import("./index15.mjs"),import:()=>import("./index15.mjs")},path:"/api/use-object/",filePath:"/Users/fern/projects/vercel-ai-sdk/examples/solidstart-openai/src/routes/api/use-object/index.ts"}],Es=Is(Je.filter(e=>e.page));function Is(e){function t(r,s,i,a){const n=Object.values(r).find(o=>i.startsWith(o.id+"/"));return n?(t(n.children||(n.children=[]),s,i.slice(n.id.length)),r):(r.push({...s,id:i,path:i.replace(/\/\([^)/]+\)/g,"").replace(/\([^)/]+\)/g,"")}),r)}return e.sort((r,s)=>r.path.length-s.path.length).reduce((r,s)=>t(r,s,s.path,s.path),[])}function Ps(e){return e.$HEAD||e.$GET||e.$POST||e.$PUT||e.$PATCH||e.$DELETE}ws({routes:Je.reduce((e,t)=>{if(!Ps(t))return e;let r=t.path.replace(/\/\([^)/]+\)/g,"").replace(/\([^)/]+\)/g,"").replace(/\*([^/]*)/g,(s,i)=>`**:${i}`).split("/").map(s=>s.startsWith(":")||s.startsWith("*")?s:encodeURIComponent(s)).join("/");if(/:[^/]*\?/g.test(r))throw new Error(`Optional parameters are not supported in API routes: ${r}`);if(e[r])throw new Error(`Duplicate API routes for "${r}" found at "${e[r].route.path}" and "${t.path}"`);return e[r]={route:t},e},{})});function ks(e){e.forEach(t=>{if(!t.attrs.href)return;let r=document.head.querySelector(`link[href="${t.attrs.href}"]`);r||(r=document.createElement("link"),r.setAttribute("rel","preload"),r.setAttribute("as","style"),r.setAttribute("href",t.attrs.href),document.head.appendChild(r))})}const Fs=" ",$s={style:e=>k("style",e.attrs,()=>ue(e.children),!0),link:e=>k("link",e.attrs,void 0,!0),script:e=>e.attrs.src?k("script",tt(()=>e.attrs,{get id(){return e.key}}),()=>rt(Fs),!0):null,noscript:e=>k("noscript",e.attrs,()=>ue(e.children),!0)};function Ts(e,t){let{tag:r,attrs:{key:s,...i}={key:void 0},children:a}=e;return $s[r]({attrs:{...i,nonce:t},key:s,children:a})}function Os(e,t,r,s="default"){return Qe(async()=>{{const a=(await e.import())[s],o=(await t.inputs?.[e.src].assets()).filter(c=>c.tag==="style"||c.attrs.rel==="stylesheet");return typeof window<"u"&&ks(o),{default:c=>[...o.map(d=>Ts(d)),et(a,c)]}}})}function Ye(){function e(r){return{...r,...r.$$route?r.$$route.require().route:void 0,info:{...r.$$route?r.$$route.require().route.info:{},filesystem:!0},component:r.$component&&Os(r.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:r.children?r.children.map(e):void 0}}return Es.map(e)}let Ie;const ti=it?()=>st().routes:()=>Ie||(Ie=Ye());function js(e){const t=ls(e.nativeEvent,"flash");if(t)try{let r=JSON.parse(t);if(!r||!r.result)return;const s=[...r.input.slice(0,-1),new Map(r.input[r.input.length-1])],i=r.error?new Error(r.result):r.result;return{input:s,url:r.url,pending:!1,result:r.thrown?void 0:i,error:r.thrown?i:void 0}}catch(r){console.error(r)}finally{cs(e.nativeEvent,"flash","",{maxAge:0})}}async function Cs(e){const t=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,e.response.headers.set("Content-Type","text/html"),Object.assign(e,{manifest:await t.json(),assets:[...await t.inputs[t.handler].assets()],router:{submission:js(e)},routes:Ye(),complete:!1,$islands:new Set})}const Vs=new Set([301,302,303,307,308]);function Ns(e){return e.status&&Vs.has(e.status)?e.status:302}function Ds(e){const t=new TextEncoder().encode(e),r=t.length,s=r.toString(16),i="00000000".substring(0,8-s.length)+s,a=new TextEncoder().encode(`;0x${i};`),n=new Uint8Array(12+r);return n.set(a),n.set(t,12),n}function Pe(e,t){return new ReadableStream({start(r){Vr(t,{scopeId:e,plugins:[J,Y,Z,Q,E,I,ee,te,re,se],onSerialize(s,i){r.enqueue(Ds(i?`(${At(e)},${s})`:s))},onDone(){r.close()},onError(s){r.error(s)}})}})}async function Us(e){const t=bs(e),r=t.request,s=r.headers.get("X-Server-Id"),i=r.headers.get("X-Server-Instance"),a=r.headers.has("X-Single-Flight"),n=new URL(r.url);let o,l;if(s)vs(typeof s=="string","Invalid server function"),[o,l]=s.split("#");else if(o=n.searchParams.get("id"),l=n.searchParams.get("name"),!o||!l)throw new Error("Invalid request");const c=(await globalThis.MANIFEST["server-fns"].chunks[o].import())[l];let d=[];if(!i||e.method==="GET"){const u=n.searchParams.get("args");if(u){const p=JSON.parse(u);(p.t?ve(p,{plugins:[J,Y,Z,Q,E,I,ee,te,re,se]}):p).forEach(y=>d.push(y))}}if(e.method==="POST"){const u=r.headers.get("content-type"),p=e.node.req,y=p instanceof ReadableStream,le=y&&p.locked,ce=y?p:p.body;if(u?.startsWith("multipart/form-data")||u?.startsWith("application/x-www-form-urlencoded"))d.push(await(le?r:new Request(r,{...r,body:ce})).formData());else if(u?.startsWith("application/json")){const Ze=le?r:new Request(r,{...r,body:ce});d=ve(await Ze.json(),{plugins:[J,Y,Z,Q,E,I,ee,te,re,se]})}}try{let u=await Te(t,async()=>($e.context={event:t},t.locals.serverFunctionMeta={id:o+"#"+l},c(...d)));if(a&&i&&(u=await Fe(t,u)),u instanceof Response){if(u.headers&&u.headers.has("X-Content-Raw"))return u;i&&(u.headers&&Ae(e,u.headers),u.status&&(u.status<300||u.status>=400)&&V(e,u.status),u.customBody?u=await u.customBody():u.body==null&&(u=null))}return i?(T(e,"content-type","text/javascript"),Pe(i,u)):ke(u,r,d)}catch(u){if(u instanceof Response)a&&i&&(u=await Fe(t,u)),u.headers&&Ae(e,u.headers),u.status&&(!i||u.status<300||u.status>=400)&&V(e,u.status),u.customBody?u=u.customBody():u.body==null&&(u=null),T(e,"X-Error","true");else if(i){const p=u instanceof Error?u.message:typeof u=="string"?u:"true";T(e,"X-Error",p.replace(/[\r\n]+/g,""))}else u=ke(u,r,d,!0);return i?(T(e,"content-type","text/javascript"),Pe(i,u)):u}}function ke(e,t,r,s){const i=new URL(t.url),a=e instanceof Error;let n=302,o;return e instanceof Response?(o=new Headers(e.headers),e.headers.has("Location")&&(o.set("Location",new URL(e.headers.get("Location"),i.origin+"").toString()),n=Ns(e))):o=new Headers({Location:new URL(t.headers.get("referer")).toString()}),e&&o.append("Set-Cookie",`flash=${encodeURIComponent(JSON.stringify({url:i.pathname+i.search,result:a?e.message:e,thrown:s,error:a,input:[...r.slice(0,-1),[...r[r.length-1].entries()]]}))}; Secure; HttpOnly;`),new Response(null,{status:n,headers:o})}let L;async function Fe(e,t){let r,s=new URL(e.request.headers.get("referer")).toString();t instanceof Response&&(t.headers.has("X-Revalidate")&&(r=t.headers.get("X-Revalidate").split(",")),t.headers.has("Location")&&(s=new URL(t.headers.get("Location"),new URL(e.request.url).origin+"").toString()));const i=ys(e);return i.request=new Request(s,{headers:e.request.headers}),await Te(i,async()=>{await Cs(i),L||(L=(await import("./app.mjs")).default),i.router.dataOnly=r||!0,i.router.previousUrl=e.request.headers.get("referer");try{at(()=>{$e.context.event=i,L()})}catch(o){console.log(o)}const a=i.router.data;if(!a)return t;let n=!1;for(const o in a)a[o]===void 0?delete a[o]:n=!0;return n&&(t instanceof Response?t.customBody&&(a._$value=t.customBody()):(a._$value=t,t=new Response(null,{status:200})),t.customBody=()=>a,t.headers.set("X-Single-Flight","true")),t})}const ri=zt(Us);export{ti as F,ri as h};
